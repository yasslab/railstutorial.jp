<html dir="ltr" dir="ltr">
  <head>
    <title>beginning</title>
    
    <link rel="stylesheet" href="../stylesheets/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../stylesheets/polytexnic.css" type="text/css" />
  </head>
  <body dir="ltr" dir="ltr">
    <div id="book">

<div id="top"></div>


<h1 class="chapter"><a id="sec-1" href="./beginning.html#top" class="heading"><span class="number">第1章</span> ゼロからデプロイまで</a></h1>


<p><a href="http://ruby.railstutorial.jp/ruby-on-rails-tutorial-book"><em>Ruby on Railsチュートリアル</em></a>へようこそ。本書は「<a href="http://rubyonrails.org/">Ruby on Rails</a>を使ったWeb開発を学びたいのだけれど、何から始めればよいのかを教えて欲しい」という要望に応えるために作成されました。<em>本書</em>を読み終わる頃には、自分の手でWebアプリケーションを開発するための技術のみならず、デプロイ(deploy: 本番環境でアプリを動かし、一般公開すること)を行なうための技術もすべて習得できます。Railsの教育エコシステムにはさらに高度な内容の書籍、ブログ、スクリーンキャストなどが数多くありますが、それらを読み解く力も身につきます。<em>Ruby on Railsチュートリアル</em>は最新のRails 4を使用していますので、Web開発の最前線を本書で学ぶことができます。(<em>Ruby on Railsチュートリアル</em>が最新版かどうかについては、本書の公式サイト(<a href="./">http://railstutorial.jp/</a>)でチェックすることができます。特に、本書をオフラインで読んでいる方は、本書が最新版かどうかを<a href="./book">http://railstutorial.jp/</a>にある<a href="./book">オンライン版のRailsチュートリアル</a>でご確認ください。</p>

<p>(<em>注</em>: 今皆様が読んでいるこのチュートリアルは、Rails 4.0という<em>バージョン</em>に対応しています。本書はRails 3.2からRail 4.0へのバージョンアップにともなって改定されましたが、チュートリアルとしての<em>版(エディション)</em>は更新されていないことにご注意ください。Rails 4.0に対応するために行った変更の量がわずかで、本書の版を改めるには及ばないと判断したためです。本書はWeb開発へといざなう「チュートリアル」に徹しており、Railsの高度な内容にまでは踏み込んでいません。以前のRails 3.2対応版と今回のRails4.0対応版との差分が少ないのは、このような理由によるものです。もちろん、<a class="ref" href="./beginning.html#sidebar-diffs">コラム1.1</a>でも紹介しているとおり、細かな変更は多数あります。しかし、その中で重要な変更と呼べるのは、<a class="ref" href="./sign-up.html#sec-strong_parameters">7.3.2</a>に追加した<em>Strong Parameters</em>と呼ばれるセキュリティ関係の新しい機能だけです。今後Railsで重要な変更が生じることがあれば、<em>Railsチュートリアル</em>の版を改訂するつもりです。新しい版では、<em>Turbolinks</em>、<em>Russian doll caching</em>、RSpec の新機能「<em>feature specs</em>」などについても取り上げる予定です。)</p>

<div class="label" id="sidebar-diffs"></div>


<div class="sidebar"><span class="title"><span class="header">コラム1.1</span><span class="description">第2版との違いについて</span></span>
<p><em>Ruby on Railsチュートリアル</em>の第2版と本書のバージョンとの違いを、この後のリストに示します(この中で重要な変更はStrong Parametersだけであり、それ以外の変更はさほど重要ではありません)。このリストでは、Rails 3.2向けの第2版を既に読み終わった方のために、変更された箇所だけをまとめました。Rails3.2対応版を読んだことのない方は、本コラムを読み飛ばしても構いません。</p>

<p>なお、次のリストには、変更を加えた節またはコードへのリンクが追加してあります。</p>

<ul>
<li>Rails 3.2からRails 4.0への変更 (<a class="ref" href="./beginning.html#sec-rubygems">1.2.2</a>)</li>
<li>Capybara DSLを明示的にインクルード (<a class="ref" href="./static-pages.html#code-capybara_dsl">リスト3.10</a>)</li>
<li>RSpecの<code>.should</code>を<code>expect().to</code>に変更(<a class="ref" href="./static-pages.html#sec-TDD">3.2.1</a>)</li>
<li><code>have_selector(’title’, …)</code>を<code>have_title(…)</code>に変更(<a class="ref" href="./static-pages.html#sec-testing_a_title_change">3.3.1</a>)</li>
<li>HTTP メソッドを<tt>PUT</tt>から<tt>PATCH</tt>に変更(<a class="ref" href="./static-pages.html#sidebar-get_etc">コラム3.3</a>)</li>
<li>Turbolinks用のハッシュ引数をスタイルシートとJavaScriptに追加(<a class="ref" href="./static-pages.html#code-application_layout">リスト3.26</a>)</li>
<li><code>root to: ’path’</code>を<code>root ’path’</code>に変更(<a class="ref" href="./filling-in-the-layout.html#code-root_route">リスト5.24</a>)</li>
<li><code>find_by_thing(…)</code>を<code>find_by(thing: …)</code>に変更(<a class="ref" href="./modeling-users.html#sec-finding_user_objects">6.1.4</a>)</li>
<li><code>rake db:test:prepare</code>を<code>rake test:prepare</code>に切り替え(<a class="ref" href="./modeling-users.html#sec-initial_user_tests">6.2.1</a>)</li>
<li><code>attr_accessible</code>をStrong Parametersに変更(<a class="ref" href="./sign-up.html#sec-strong_parameters">7.3.2</a>)</li>
<li>暗号化された記憶トークンに変更 (<a class="ref" href="./sign-in-sign-out.html#sec-remember_me">8.2.1</a>)</li>
<li><code>before_filter</code>を<code>before_action</code>に変更 (<a class="ref" href="./updating-showing-and-deleting-users.html#code-authorize_before_filter">リスト9.12</a>)</li>
<li>最初にマッチしたリンクをクリックするためにCapybaraの<code>match: :first</code>を使用 (<a class="ref" href="./updating-showing-and-deleting-users.html#code-delete_link_tests">リスト9.43</a>)</li>
<li><code>default_scope</code>をハッシュ引数からラムダに変更(<a class="ref" href="./user-microposts.html#code-micropost_ordering">リスト10.11</a>)</li>
<li><code>dup</code>を<code>to_a</code>に変更 (<a class="ref" href="./user-microposts.html#code-micropost_dependency_test">リスト10.12</a>)</li>
<li>XPathを使ってボタンの切り替えをテストするように変更 (<a class="ref" href="./following-users.html#sec-a_working_follow_button_the_standard_way"> 11.2.4</a>)</li>
</ul>



</div>


<p>本書の目的は、単にRailsを学ぶことでは<em>ではなく</em>、Railsを例にとって広い意味での<em>Webアプリケーション開発</em>そのものを学ぶことにあります。つまり、Railsに限らず、World Wide Web上で動くソフトウェアを開発したり改良したりするための技術を習得することを目指します。したがって、Ruby on Railsの他に、HTML、CSS、データベース、バージョン管理、テスト、デプロイなどの多くの技術についても本書で学びます。この目的を達成するため、<em>Ruby on Rails チュートリアル</em>では、統合的なアプローチを採用しています。つまり、「実際に動くサンプルアプリケーションをゼロから開発する」という例題をこなすことによって、Railsについて総合的に学ぶのです。<a href="http://sivers.org">Derek Sivers</a>が前書きで述べているように、本書は一本道のストーリーで構成されていて、最初から最後まで飛ばさずに読むことを前提としています。技術書を飛ばし読みするのが習慣になっている方にとっては少々頭の切り替えが必要になるかもしれませんが、それだけの値打ちは十分にあります。ぜひトライしてみてください。<em>Ruby on Railsチュートリアル</em>をTVゲームにたとえると、あなたは主人公であり、各章をクリアするたびにRails開発者としてレベルアップしていくと考えてください (演習は<a href="http://en.wikipedia.org/wiki/Boss_(video_gaming)#Miniboss">中ボス</a>です)。</p>

<p>第1章では、最初に必要なソフトウェアをインストールし、開発環境 (<a class="ref" href="./beginning.html#sec-up_and_running">1.2</a>) を整えて Ruby on Railsを動かす準備をします。次に<code>first_app</code>という最初の Rails アプリの作成に着手します。<em>Rails チュートリアル</em> では、実戦的なソフトウェア開発のベストプラクティスを重要視しているので、新しいRailsプロジェクトを作成した直後にGit(<a class="ref" href="./beginning.html#sec-version_control">1.3</a>) を使ったバージョン管理を行います。最後に、作成したアプリを本番 (production) 環境 (<a class="ref" href="./beginning.html#sec-deploying">1.4</a>) に<em>デプロイして一般公開する</em>ところまで実践します。</p>

<p><a class="ref" href="./a-demo-app.html#top">第2章</a>では、Railsアプリケーションの基本的な仕組みを体験してもらうために、別のプロジェクトを作成します。この<em>デモアプリ</em>(<code>demo_app</code>)を短時間で作成するために、scaffold (<a class="ref" href="./beginning.html#sidebar-scaffolding">コラム1.2</a>) を使ってコードを自動生成します。ただし、scaffoldで自動生成されたコードは、込み入っていて美しくありません。このため、<a class="ref" href="./a-demo-app.html#top">第2章</a>では自動生成されたコードについては解説せず、生成された<em>URI</em> (いわゆる <em>URL</em><sup class="footnote" id="fnref-1_1"><a href="./beginning.html#fn-1_1">1</a></sup>) がどのように動くのかをWebブラウザで確かめることに焦点を当てます。</p>

<p>第3章以降では、１つの大きな<em>サンプルアプリケーション</em> (<code>sample_app</code> )を開発します。コードは自動生成せず、ゼロからコードを書き進めます。さらに、このサンプルアプリケーションからTDD (<em>テスト駆動開発</em>) という開発手法を導入します。<a class="ref" href="./static-pages.html#top">第3章</a>では、静的ページと若干の動的コンテンツを追加するところから始めます。次の<a class="ref" href="./rails-flavored-ruby.html#top">第4章</a>では少し回り道をし、Railsを支えているRubyという言語について簡単に学びます。<a class="ref" href="./filling-in-the-layout.html#top">第5章</a>から<a class="ref" href="./updating-showing-and-deleting-users.html#top">第9章</a>にかけて、レイアウト、ユーザーのデータモデル、ユーザー登録・認証システムを順に作成し、サンプルアプリケーションの基本的な部分を実装します。最後の<a class="ref" href="./user-microposts.html#top">第10章</a>と<a class="ref" href="./following-users.html#top">第11章</a>では、マイクロブログ機能とソーシャル機能を実装し、実際に動作するWebサイトを完成させます。</p>

<p>最終的なサンプルアプリケーションは、(偶然にも、かつてはRailsで実装されていた) <a href="http://twitter.com/">某ソーシャルマイクロブログサイト</a>にとてもよく似た仕上がりになります。なお、<em>Rails チュートリアル</em>では、サンプルアプリケーションの開発を中心にして話が進められていきますが、(サンプルアプリケーションに特化した技術ではなく) Web アプリケーションの開発で必要になる一般的な技術を重点的に解説していきます。このため、本書を読み終わる事には、あなたが今後どんな Web アプリケーションを開発したいのかに関わらず、どんな開発にも通用する基礎的な力を身につけることができます。</p>

<div class="label" id="sidebar-scaffolding"></div>


<div class="sidebar"><span class="title"><span class="header">コラム1.2</span><span class="description">早くて簡単なScaffoldの甘い誘惑</span></span>
<p>Rails の作者 David Heinemer Hansson 氏による有名な動画「<a href="http://www.youtube.com/watch?v=Gzj723LkRJY">15分で作るブログ</a>」を見て頂ければわかるように、Rails は初期の頃から、明快で刺激的なフレームワークです。この動画や、これに続く関連動画を見ることは、Rails のパワーを知る最適な方法の１つなので、ぜひ一度視聴する事をお勧めします。ただし、気をつけなくてはならない点が１つあります。それは、これらの動画では「15分でブログを作る」といった離れ業を、<em>scaffold</em> という機能を利用して成し遂げている点です。このため、15分で作られた機能は、Railsの<code>generate</code>コマンドによって (まるで魔法のように) <em>自動生成されたコード</em>に強く依存しています。</p>

<p>実際、Ruby on Rails のチュートリアルを書いているとき、<a href="http://en.wikipedia.org/wiki/Dark_side_(Star_Wars)">あまりにも素早く簡単にコードが生成できる</a> (訳注: 原文の「quicker, easier, more seductive」は、スターウォーズ エピソードV のヨーダの台詞の引用) scaffold の機能を、つい使ってしまいたくなりました。しかし、自動生成されたコードは初心者にとってはあまりに量が多く、複雑です。さらに、自動生成されたコードが運よく動いたとしても、そのコードが正常に動いている理由を理解するのはかなり困難です。scaffold を使ってコードを自動生成することばかりに頼っていると、コードを自動生成する達人にはなれるかもしれませんが、Rails に関する実践的な知識はほとんど身に付きません。</p>

<p>このため、<em>Ruby on Rails チュートリアル</em>では、より実践的な知識を身につけるために、ほぼ逆のアプローチで開発を進めていきます。具体的には、<a class="ref" href="./a-demo-app.html#top">第2章</a>で作成する簡単なデモアプリではscaffoldを使いますが、<em>このチュートリアル</em>の中核である<a class="ref" href="./static-pages.html#top">第3章以降</a>のサンプルアプリケーションからは、scaffold を一切使わずに開発を進めていきます。scaffold を使わない代わりに、開発の各ステップで、手頃な<em>一口サイズ</em>のコードを書いてもらいます。この一口サイズのコードは、無理なく理解できる程度にシンプルで、かつ、ある程度の歯ごたえとやりがいを得られるように配慮してあります。各ステップで理解する必要のあるコードの量はわずかですが、こうした理解を積み重ねていくことで、最終的にRailsの知識を高いレベルで身につけられるように構成されています。この知識は、どのようなWebアプリを作成する時にも応用が効く、柔軟性の高いものです。</p>
</div>




<div class="label" id="sec-introduction"></div>


<h2><a id="sec-1_1" href="./beginning.html#sec-introduction" class="heading"><span class="number">1.1</span>はじめに</a></h2>


<p>Ruby on Railsは2004年にデビューして以来、急速に成長していきました。現在では、動的なWebアプリケーションを開発するフレームワークとして、最も有力かつ人気のあるフレームワークの１つになっています。小さなスタートアップから巨大企業まで、多くの組織が Rails を使っています。例えば、<a href="http://37signals.com/">37signals</a> や <a href="http://github.com/">GitHub</a>、<a href="http://shopify.com/">Shopify</a>、<a href="http://scribd.com/">Scribd</a>、<a href="http://twitter.com/">Twitter</a>、<a href="http://disney.com/">Disney</a>、<a href="http://hulu.com/">Hulu</a>、<a href="http://yellowpages.com/">Yellow Pages</a> など、<a href="http://rubyonrails.org/applications">Ruby on Rails を使っているサイトのリスト</a>は増える一方です。他にも、<a href="http://entp.com/">ENTP</a>や<a href="http://thoughtbot.com/">thoughtbot</a>、<a href="http://pivotallabs.com/">Pivotal Labs</a>、<a href="http://hashrocket.com/">Hashrocket</a>といった、Railsを専門的に扱う会社も数多くあります。また、Railsを専門にしたフリーランスのコンサルタントやインストラクター、開発者については数えきれません。</p>

<p>Railsがこれだけ多くに人達に使われているのはなぜでしょうか。理由の１つは、Railsが100%オープンソースで、制限の緩い<a href="http://www.opensource.org/licenses/mit-license.php">MITライセンス</a>で公開されているからです。これにより、Railsをダウンロードしたり使ったりする際のコストが一切かかりません。また、Railsの設計が簡潔で美しいことも、Railsの成功を支えている秘訣の１つです。これを実現できたのは、Railsの背後で動いている<a href="http://ruby-lang.org/">Ruby</a>言語の驚異的な柔軟性のおかげです。具体的には、Webアプリケーションの作成に特化した<a href="http://en.wikipedia.org/wiki/Domain_Specific_Language">DSL (ドメイン固有言語)</a> を Ruby言語で実装していることにより、HTMLやデータモデルの生成、URL のルーティングなど、Webプログラミングで必要な多くの作業が簡単になります。その結果、Railsを使用してアプリケーションを開発すると、コードが簡潔になり、読みやすくなります。</p>

<p>さらに、Railsは最新のWebテクノロジーやフレームワーク設計に素早く適応しています。たとえば、Rails は「REST」という設計思想の重要性をいち早く理解し、対応したフレームワークの１つです (RESTについては後で解説します)。また、他のフレームワークで何か新しい技術が成功すれば、Railsの創始者である<a href="http://loudthinking.com/">David Heinemeier Hansson</a>や<a href="http://rubyonrails.org/core">Railsのコアチーム</a>は、そうしたアイデアを常に積極的に取り入れています。印象的な例として、かつて互いにライバルの関係にあったMerbとRailsとの統合が挙げられます。この統合の結果、RailsはMerbのモジュール設計や安定した<a href="http://en.wikipedia.org/wiki/Application_programming_interface">API</a>、そしてパフォーマンスの向上など多くの恩恵を受けることができました。</p>

<p>最後に、Railsには驚くほど熱心かつ多様なコミュニティという素晴らしい財産があります。Railsコミュニティには、何百人ものオープンソース<a href="http://contributors.rubyonrails.org/">コントリビュータ</a>達や、多くの参加者で賑わう<a href="http://railsconf.com/">カンファレンス</a>、膨大な数の<a href="https://rubygems.org/">gem</a> (ページネーションや画像アップロードといった特定の問題を解決するためのgemなど)、多くの情報を発信し続けるブログ、掲示板、IRCがあります。このような熱心で多様なコミュニティのおかげで、開発中に何らかのエラーに遭遇したとしても、エラーメッセージをそのままGoogleで検索するだけで、関連するブログ記事や掲示板のスレッドをたちどころに見つけることができます。</p>

<div class="label" id="sec-comments_for_various_readers"></div>


<h3><a id="sec-1_1_1" href="./beginning.html#sec-comments_for_various_readers" class="heading"><span class="number">1.1.1</span> 読者の皆さまへ</a></h3>


<p><em>Railsチュートリアル</em>は、統合的な構成を採用しています。構成の中心となるのはもちろんRailsですが、他にもRuby言語やRSpecを使ったテスト、<a href="http://en.wikipedia.org/wiki/HTML">HTML</a>、<a href="http://en.wikipedia.org/wiki/CSS">CSS</a>、若干の<a href="http://en.wikipedia.org/wiki/JavaScript">JavaScript</a>と<a href="http://en.wikipedia.org/wiki/SQL">SQL</a>のチュートリアルが含まれています。チュートリアルが統合的に構成されていることにより、本書を最後まで完了することができれば、現時点のWeb開発の知識量に関わらず、より高度な情報源を難なく読みこなす実力が身につき、上に挙げたJavaScriptなどのRails以外のトピックについても理解しやすくなります。言い換えると、本書で扱うトピックの範囲がそれだけ<em>広い</em>ということでもあります。プログラミング経験の浅い方にとっては、その情報量の多さに圧倒されるかもしれません。そこで、読者の経験や知識に応じた、<em>Railsチュートリアル</em>を読破するためのアドバイスを用意しました。ぜひ参考にしてください。<br /></p>

<p><strong>【すべての読者へ】</strong> 「Railsを学ぶ前にRubyを勉強した方がよいでしょうか？」は定番の質問です。この質問への回答は、読者の学習スタイルやプログラミング経験次第で異なるため、一口には言えません。Web開発を最初から体系的に学びたい場合や、プログラミングの経験が全くない場合は、Rubyを最初に学ぶのがよいでしょう。Rubyを学ぶのであれば、Peter Cooperの「<a href="http://www.amazon.com/gp/product/1430223634"><em>Beginning Ruby</em></a>」がお勧めです。これからRailsで開発を始めようとする人は「とにかく<em>Webアプリケーション</em>を作りたい！」と考えていることがほとんどなので、たった1つのWebページを作成するために500ページものRuby本を読み通す気にはなれないでしょう。Rubyを急いで学びたいのであれば、Rubyを対話的に学習できるWebサービス「<a href="http://tryruby.org/">Try Ruby</a><sup class="footnote" id="fnref-1_2"><a href="./beginning.html#fn-1_2">2</a></sup>」を使ってRubyをおおまかに理解しておくことをお勧めします。必要であれば、<a href="http://railsforzombies.org/">Rails for Zombies</a><sup class="footnote" id="fnref-1_3"><a href="./beginning.html#fn-1_3">3</a></sup>に目を通してRailsの全体像を把握しておくとよいかもしれません (訳注: いずれも英語版のみ)。</p>

<p>「最初からテストを書かないといけないでしょうか？」も定番の質問です。「はじめに」で述べたように、<em>Railsチュートリアル</em>では最初からテスト駆動開発 (TDD) を採用しています。その理由は、著者の開発経験に基づき、テスト駆動開発こそがRailsアプリケーションの開発に最も適切な手法だと考えられるからです。ただし、テスト駆動開発を全面的に採用したことにより、本チュートリアルはその分複雑になり、読者の負担も増えています。Railsのコードだけでなく、テストコードも書かなくていけないからです。そこで、もしテストで行き詰まってしまった場合には、そこで長々と悩むよりも思い切って (一周目は) その箇所をスキップしてしまいましょう。よりお勧めの方法は、テストコードの完全な理解については欲張らずに後回しにし、本書のテストは自分の書いたコードが正しく動くかどうかの検証ツールと割り切って使うことです。具体的には、<em>spec</em>と呼ばれるテストファイルを作成し、そのファイルに、<em>本書で指示された通りに</em>テストコードをコピー＆ペーストするだけにしておくのです。<a class="ref" href="./filling-in-the-layout.html#top">第5章</a>で詳しく説明しますが、テストスイート (複数のテストケースを束ねたもの) を実行すると、最初はテストに失敗します (この時点では失敗するのが正しいのです)。失敗することを確認したら、チュートリアルに従って、今度はアプリケーションのコードを書きます。最後に、同じテストスイートをもう一度実行すると、今度はテストに成功するようになっています。つまり、最終的にテストが成功すれば、自分が書いたコードは正しく動いていることが確認できたことになります。<br /></p>

<p><strong>【初めてプログラミングを始める方へ】</strong> 残念ながら、<em>Railsチュートリアル</em>は、まったくのプログラミング初心者を対象にして書かれたものではありません。どれほど単純なWebアプリケーションであっても、それを作るために理解しておかなければいけないことがたくさんあり、そうした予備知識は省略できないからです。Webプログラミングをまったくしたことのない初心者の方が、この<em>Railsチュートリアル</em>を難しすぎると感じた場合は、本書を学ぶ前にまずHTMLやCSSの基礎を勉強してください。それらの基礎が身についたら、是非もう一度<em>Railsチュートリアル</em>に挑戦してください。(HTML関連ではこれといったお勧めの教材は思いつかなかったのですが、「<a href="http://headfirstlabs.com/books/hfhtml/"><em>Head First HTML</em></a>」はなかなかよさそうです。David Sawyer McFarland著「<a href="http://www.amazon.com/gp/product/0596526873"><em>CSS: The Missing Manual</em></a>」を推薦してくれた読者もいます。)Peter Cooper著「<a href="http://www.amazon.com/gp/product/1430223634"><em>Beginning Ruby</em></a>」の最初の2、3章をやってみるのもよいでしょう。同書で扱っているサンプルアプリケーションは、本格的なWebアプリケーションに比べて非常に小さいので、比較的やりやすいと思います。この節を本書に追加したのは、まったくの初心者の方々がいきなり本書でWeb開発を学ぼうとしているケースが実に多かったからです。そうした方々が本書に挑むこと自体はもちろんOKです。最も大事なのは情熱なのですから。最後に、そうした方々に特にお勧めな教材として「<a href="./screencasts"><em>Rails Tutorial</em> のスクリーンキャストのシリーズ</a><sup class="footnote" id="fnref-1_4"><a href="./beginning.html#fn-1_4">4</a></sup>」(英語のみ) をご紹介いたします。この動画版Railsチュートリアルでは、Railsを使ったソフトウェア開発の作業を、まるで「達人の肩越しに」のぞきこんでいるかのように見て学ぶことができます。<br /></p>

<p><strong>【プログラミングの経験があり、これからWeb開発を始める方へ】</strong> 既にクラスやメソッド、データ構造などの概念に馴染みがある方であれば、それらの知識は大いに役立ちます。JavaやC/C++といった言語とRuby言語では記法が異なるので、最初は少し違和感があるかもしれませんが、すぐにRuby言語の記法に慣れるでしょう。(Rubyでは行末にセミコロンを置いても置かなくても問題なく動きますので、行末にセミコロンがないとどうしても落ち着かない方はそうしてみてもよいかもしれません。お勧めはしませんが。)<em>Rails チュートリアル</em>では、覚えておく必要のあるWeb特有の概念をすべてカバーしているので、<tt>POST</tt>や<tt>PATCH</tt>の違いが分からなくても今は心配する必要はありません。<br /></p>

<p><strong>【Web開発の経験があり、これからRailsを始める方へ】</strong> PHPやPythonなどの動的言語の経験があれば、本書を楽に読み進められるはずです。特にPythonの経験は非常に有利です。本書でカバーする基本的な概念については既に知っていると思いますが、テスト駆動開発やREST構造などの概念については馴染みがない方もいるでしょう。Rubyには独特のクセがあるので、多少戸惑うこともあるかもしれません。<br /></p>

<p><strong>【Rubyプログラミングの経験があり、これからRailsを始める方へ】</strong> 最近ではRubyプログラマがRailsを使うのは当たり前になりつつあるので、純粋にRubyのみを使っている方は少ないと思います。生粋のRubyプログラマであれば、本書を楽に読み進められるでしょう。本書を読み終わった頃には、すぐにも独自のアプリケーションを開発できるでしょう。<br /></p>

<p><strong>【Railsを使った経験はあるが、まだ十分ではない方へ】</strong> 既に他のチュートリアルを読んだり、小規模なRailsアプリをいくつか作った経験がおありだと思います。読者からのフィードバックを読んだ限りでは、そのような方であっても本書から多くのことを学べるはずだと自信を持って言えます。本書には、そうした方々が初めてRailsを学んだ頃よりも新しい技術がふんだんに盛り込まれているため、本書で学ぶ技術はきっと役に立つはずです。<br /></p>

<p><strong>【Rails経験の豊富な方へ】</strong> Railsを使った開発の経験が既に十分にあるのであれば本書は必要ないはずなのですが、意外にも多くのRails開発者から「思ったよりも役に立った」との声を頂いているので、Rails開発のベテランであってもRailsを違う視点から見ることで楽しめるかもしれません。<br /></p>

<p>最後に、<em>Ruby on Railsチュートリアル</em>を読み終えた経験豊富なプログラマの方には、さらに高度な話題を扱っている「<a href="http://www.amazon.com/gp/product/1933988657"><em>The Well-Grounded Rubyist</em></a>」(David A. Black 著) または「<a href="http://www.amazon.com/Eloquent-Ruby-Addison-Wesley-Professional-Series/dp/0321584104/"><em>Eloquent Ruby</em></a>」(Russ Olsen 著) をお勧めします。あるいは、トピック別に書かれている「<a href="http://www.amazon.com/gp/product/0672328844"><em>The Ruby Way</em></a>」(Hal Fulton 著) を読んでみるのも良いでしょう。<br /></p>

<p>本書を読み終える頃には、本書を読む前の知識量の多少にかかわらず、より高度なRailsの情報源を理解できるようになっているはずです。その中でも特にお勧めのRailsの情報源を紹介します。</p>

<ul>

<li><a href="http://railscasts.com/">RailsCasts</a> (Ryan Bates) : きわめて質の高い (ほぼ) 無料のスクリーンキャスト</li>
<li><a href="http://peepcode.com/">PeepCode</a>: 質の高い商用のスクリーンキャスト</li>
<li><a href="http://www.codeschool.com/">Code School</a>: プログラミングを対話的に学習できるコース</li>
<li><a href="http://guides.rubyonrails.org/">Rails Guides</a>: トピック毎に分類された最新の Rails リファレンス</li>
<li><a href="http://railscasts.com/">RailsCasts</a> (Ryan Bates): さっきも <a href="http://railscasts.com/">RailsCasts</a> を紹介しましたっけ？そのぐらい <a href="http://railscasts.com/"><em>RailsCasts</em></a> はお勧めです。</li>


</ul>




<h3><a id="sec-1_1_2" href="./beginning.html#sec-1_1_2" class="heading"><span class="number">1.1.2</span> Railsと「スケール」について</a></h3>


<p>本節を続ける前に、一旦ここで、Railsフレームワークに対して初期の頃から 指摘され続けている「Railsはスケールアップできない」という主張について触れたいと思います。「Railsでは大量のトラフィックを捌くことができない」という主張です。この主張には、一部間違った認識があります。それは、Webサイトをスケールさせるのは<a href="http://idleprocess.wordpress.com/2009/11/24/presentation-summary-high-performance-at-massive-scale-lessons-learned-at-facebook/">あなた<em>が行わなければいけない作業であって、フレームワークがWebサイトをスケールさせるのではない</em></a>、ということです。Railsは素晴らしいフレームワークではありますが、やはりただのフレームワークでしかありません。正しい問いかけは「Railsで構築されたWebサイトをスケールできるか？」です。この問いかけに対する回答は現時点で明白です。なぜなら、世界で最もトラフィックの大きいWebサイトのいくつかはRailsで構築されており、実績が示されているからです。ただし、Webサイトをスケール<em>させる</em>ことは、Railsだけでできることではなく、Rails以外の多くの知識も必要になります。HuluやYellow Pagesなどの大量のトラフィックを日々捌いているWebアプリケーションもRailsで構築されているので、そこまで心配する必要はありません。少なくとも、<em>あなたの</em>アプリケーションがHuluやYellow Pages並みに成長するまでの間は、「Railsだからスケールできない」ということにはならないでしょう。</p>

<div class="label" id="sec-conventions"></div>


<h3><a id="sec-1_1_3" href="./beginning.html#sec-conventions" class="heading"><span class="number">1.1.3</span> この本における取り決め</a></h3>


<p>本書で使用している取り決めや表記はわかりやすいものなので、ほとんどは説明不要でしょう。一部の取り決めについては説明が必要かもしれないので本項で補足します。</p>

<p>本書の文中には内部リンク (<a class="ref" href="./beginning.html#sec-up_and_running">1.2</a>など) と外部リンク (<a href="http://rubyonrails.org/download">Ruby on Railsダウンロードページ</a>など) が多数含まれています<sup class="footnote" id="fnref-1_5"><a href="./beginning.html#fn-1_5">5</a></sup>。これは<a href="./book">HTML版</a>、<a href="./">PDF版</a>いずれの場合も同じです。</p>

<p>本書に登場する例の多くは、コマンドライン (ターミナル) のコマンドを使っています。簡素化のため、次のようなUnixスタイルのプロンプト (行の頭に &#39;$&#39; を表示するスタイル) を使用して、その例がコマンドラインであることを示しています。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;hello, world&quot;</span>
<span class="go">&quot;hello world&quot;</span>
</pre></div>
</div>


<p>なお、Windows のコマンドラインでは、$の代わりに大なり記号 (<code>&gt;</code>) がプロンプトに表示されるので、$ を &gt; に置き換えて読んでください。</p>

<div class="code"><div class="highlight"><pre><span class="go">C:\Sites&gt; echo &quot;hello, world&quot;</span>
<span class="go">&quot;hello world&quot;</span>
</pre></div>
</div>


<p>また、Unixシステム上では、いくつかのコマンドを入力する際に<code>sudo</code>コマンド (他のユーザーの権限でプログラムを実行するためのコマンド) を使わなければならない場合があります<sup class="footnote" id="fnref-1_6"><a href="./beginning.html#fn-1_6">6</a></sup>。<code>sudo</code>コマンドを使って実行されたプログラムは、通常のユーザーではアクセスできないファイルやディレクトリにアクセスできる「管理者権限」で実行されます。たとえば、<a class="ref" href="./beginning.html#sec-rubygems">1.2.2</a>では、次のような管理者権限で実行するコマンドが登場します。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> sudo ruby setup.rb</pre></div>
</div>


<p><code>sudo</code> の実行は、ほとんどのUnix/Linux/OS X のシステムで必要です。ただし、<a class="ref" href="./beginning.html#sec-install_ruby">1.2.2.3</a>で推奨されているRuby Version Manager (RVM) を使っている場合は、次の例のように管理者権限を使わずに実行できます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> ruby setup.rb</pre></div>
</div>


<p>Railsには、コマンドラインで実行できるコマンドが多数付属しています。たとえば、<a class="ref" href="./beginning.html#sec-rails_server">1.2.5</a>で使われる以下のコマンドは、開発用WebサーバーをローカルPC上で実行するコマンドです。</p>

<div class="code"><div class="highlight"><pre><span class="nv">$ </span>rails server</pre></div>
</div>


<p><em>Railsチュートリアル</em>におけるディレクトリの区切りは、コマンドラインのプロンプトと同様にUnixスタイルのスラッシュ(<code>/</code>)を使っています。サンプルアプリケーションの場所は、たとえば次のように表記されます。</p>

<div class="code"><div class="highlight"><pre>/Users/mhartl/rails_projects/sample_app</pre></div>
</div>


<p>なお、Windowsのコマンドプロンプトでは、ディレクトリの区切りは次のようにバックスラッシュまたは円マークで表示されます。</p>

<div class="code"><div class="highlight"><pre>C:\Sites\sample_app</pre></div>
</div>


<p>Railsで作成するWebアプリケーションが置かれているディレクトリのルート (root) を、<em>Railsルート</em>と呼ぶことにします。この用語は誤解されやすいようで、多くの人がRailsルートを「Railsというアプリケーションそのものがインストールされているディレクトリのルート」だと勘違いします。この点を明確にするため、<em>Railsチュートリアル</em>では、「Railsルート」については<em>(Railsで作成した)Webアプリケーションのルートディレクトリ</em>を指すものとします。また、すべてのディレクトリは、このルートディレクトリを起点とした相対パスで示します。たとえば、著者のサンプルアプリケーションの <code>config</code> ディレクトリは、次の場所にあります。</p>

<div class="code"><div class="highlight"><pre>/Users/mhartl/rails_projects/sample_app/config</pre></div>
</div>


<p>このとき、このRailsアプリケーションのルートディレクトリは、<code>config</code>ディレクトリの1つ上の階層にあります。したがって、以下の場所がルートディレクトリになります。</p>

<div class="code"><div class="highlight"><pre>/Users/mhartl/rails_projects/sample_app</pre></div>
</div>


<p>長いパスを毎回表記すると読みづらくなるので、本書では以下のようなディレクトリパスを参照する場合、</p>

<div class="code"><div class="highlight"><pre>/Users/mhartl/rails_projects/sample_app/config/routes.rb</pre></div>
</div>


<p>アプリケーションのルートパスを省略して、単純に<code>config/routes.rb</code>と表記することにします。</p>

<p><em>Railsチュートリアル</em>では、様々なプログラムの出力結果 (シェルコマンド、バージョン管理ツール、Rubyプログラムの出力結果など) をこまめに記載するようにしています。出力結果は、コンピュータシステムによって微妙に異なるので、本書の出力結果と実際の出力が正確に一致するとは限りません。しかし、細かい出力結果の差異が問題になることはないので、あまり気にする必要はありません。</p>

<p>コンピュータシステムによっては、コマンドを実行した時にエラーが発生するかもしれません。しかし本書では、あらゆる場面を想定してエラー対策をもれなく記載するような<a href="http://en.wikipedia.org/wiki/Sisyphus">不毛な作業</a>は行っていません。そのような場合は、即座にエラーメッセージをGoogleで検索してください。エラーメッセージをGoogleで検索することは、実際のソフトウェア開発でも使われている基本的なテクニックなので、よい練習にもなります。本書のチュートリアルを進めていくうちに何か問題が生じたら、<a href="./help">RailsチュートリアルのHelpページ</a>を読んでみてください。このページには問題を解決するためのリソースやヒントが記載されているので、問題を解決する手掛かりになるはずです<sup class="footnote" id="fnref-1_7"><a href="./beginning.html#fn-1_7">7</a></sup>。</p>

<div class="label" id="sec-up_and_running"></div>


<h2><a id="sec-1_2" href="./beginning.html#sec-up_and_running" class="heading"><span class="number">1.2</span> さっそく動作させる</a></h2>




<blockquote><p>本書の第1章は、さしずめロースクールで言うところの「淘汰期間」(訳注: そこで生き残れるかどうかを選別する期間) のようなものである。本章で開発環境の構築に成功できた人ならば、最後までやり通すことは難しくありません。<br /> —Bob Cavezza (<em>Railsチュートリアル</em>読者)</p>
</blockquote>


<p>それでは、Ruby on Railsの開発環境を構築し、最初のアプリを作成してみましょう。プログラミング経験のない方は多少苦労することもあると思いますが、どうか諦めずに頑張ってください。苦労するのは自分だけではありません。これはどんな開発者でも幾度となく通過する道です。ここでの苦労はいつか必ず報われることは、著者が保証いたします。</p>

<div class="label" id="sec-development_tools"></div>


<h3><a id="sec-1_2_1" href="./beginning.html#sec-development_tools" class="heading"><span class="number">1.2.1</span>開発環境</a></h3>


<p>開発環境はRailsプログラマ一人ひとりすべて異なります。開発者は慣れてくるに従い、自分の環境を徹底的にカスタマイズするものだからです。開発環境を大別すると、テキストエディタやコマンドラインを使う環境と、IDE (統合開発環境) の2つに分けられます。まずは後者から見てみましょう。</p>

<h4><a id="sec-1_2_1_1" href="./beginning.html#sec-1_2_1_1" class="heading">IDE</a></h4>


<p>Rails 用IDEとして最も有名なのは<a href="http://www.aptana.com/rails/">RadRails</a>と<a href="http://www.jetbrains.com/ruby/index.html">RubyMine</a>です。中でもRubyMineが良いという評判をよく聞きます。本書の読者の一人 (David Loeffler) は、<a href="https://github.com/perfectionist/sample_project/wiki">RailsチュートリアルでRubyMineを使用する方法</a><sup class="footnote" id="fnref-1_8"><a href="./beginning.html#fn-1_8">8</a></sup> というドキュメントまで作ってくれました。IDEでの開発を好む方は、上のリンクをチェックしてみて、自分のスタイルに合うかどうか試してみるとよいでしょう。</p>

<h4><a id="sec-1_2_1_2" href="./beginning.html#sec-1_2_1_2" class="heading">テキストエディタとコマンドライン</a></h4>


<p>著者自身は、すべてが整った強力なIDEで作業するよりも、「<em>テキストエディタ</em>でテキストを編集し、<em>コマンドライン</em>でコマンドを実行する」というシンプルな手段が好みです (<a class="ref" href="./beginning.html#fig-editor_shell">図1.1</a>)。ツールの組み合わせは各人の好みやプラットフォームによって変わってきますが、著者がお勧めするツールを以下にご紹介します。</p>

<ul>
<li><strong>テキストエディタ:</strong> 断然<a href="http://www.sublimetext.com/2">Sublime Text 2</a>をお勧めします。これは非常によくできたクロスプラットフォームのテキストエディタです。現時点ではまだベータ版であるにもかかわらず、既にベータ版とは思えないほどパワフルなエディタです<sup class="footnote" id="fnref-1_9"><a href="./beginning.html#fn-1_9">9</a></sup>。Sublime Textは<a href="http://macromates.com">TextMate</a>の影響を強く受けています。実際、スニペットやカラースキームなどの設定はTextMateと互換性があります。（TextMateはMac OS X版しかありませんが、MacユーザーにとってはTextMateは現在でも良い選択であると言えます。) 次にお勧めするテキストエディタは<a href="http://www.vim.org/">Vim</a><sup class="footnote" id="fnref-1_10"><a href="./beginning.html#fn-1_10">10</a></sup>です。Vimは多くのプラットフォーム上で動作します。Vimは無償で入手できますが、Sublime Textは有償です (訳注: ただし無料の試用期間に制限はありません)。どちらもプロの開発者が使っているエディタですが、著者の経験では、Sublime Text の方が初心者にとって<em>はるかに</em>扱いやすいエディタであると思います。</li>

<li><strong>ターミナル:</strong> OS Xの場合、<a href="http://iterm.sourceforge.net/">iTerm</a>か、OSに最初からインストールされているTerminal.appをお勧めします。Linux の場合、デフォルトのターミナルで問題ありません。Windowsの場合、Linuxが動作する仮想マシンを用意して、その仮想マシン上でRailsアプリケーションを開発することが好まれています。この場合、お勧めのコマンドラインは上記と変わりません。Windows自身にRails開発環境をインストールしたい場合、<a href="http://railsinstaller.org/">Railsインストーラ</a>付属のコマンドプロンプトを使うことをお勧めします (<a class="ref" href="./beginning.html#sec-rails_installer_windows">1.2.2.1</a>)。</li>
</ul>


<p>なお、Sublime Textを選んだ方のために、より高度な設定方法を解説した「<a href="https://github.com/mhartl/rails_tutorial_sublime_text">Railsチュートリアル: Sublime Text</a><sup class="footnote" id="fnref-1_11"><a href="./beginning.html#fn-1_11">11</a></sup>」を用意しました。ただしエディタのカスタマイズは何かと厄介でエラーも起きやすいので、この解説はあくまで上級者向けです。Sublime Textは、デフォルト設定のままでもRailsアプリケーションのエディタとして十分に機能します。</p>

<div class="label" id="fig-editor_shell"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="../images/figures/editor_shell.png" alt="editor_shell" /></span></div><div class="caption"><span class="header">図1.1</span> <span class="description">テキストエディタ/コマンドライン開発環境 (TextMate/ ITERM) <a href="../images/figures/editor_shell-full.png">(拡大)</a></span></div></div>




<h4><a id="sec-1_2_1_3" href="./beginning.html#sec-1_2_1_3" class="heading">ブラウザ</a></h4>


<p>Webブラウザの種類は豊富ですが、多くのRails 開発者はFirefox、Safari、Chromeを使っています。これらの3つのブラウザには、ページの任意の部分を右クリック (またはControlキーを押しながらクリック) して、要素を表示する機能 (Inspect element機能) が標準で組み込まれています。</p>

<h4><a id="sec-1_2_1_4" href="./beginning.html#sec-1_2_1_4" class="heading">使用するツールについて</a></h4>


<p>開発環境をあれこれ整え始めると、「すべてのツールを自在に使いこなすには<em>かなり</em>長い時間がかかりそうだ」と実感することでしょう。実際、テキストエディタやIDEを使いこなせるようになるまでには相当な時間が必要になります。たとえばSublime TextやVimにも専用のチュートリアルがあり、このようなチュートリアルを読み終えるだけでも数週間かかります。開発の経験がない方にとっては相当な驚きだと思いますが、仕事の道具である<em>開発ツールの学習に時間をかけることはいたって普通の事</em>であり、開発者であれば誰もが通る道です。「せっかく良いアイディアが浮かんだから、<em>とにかくRailsでWebアプリをさっと作ってみたいだけ</em>なのに、奇妙で古くさい Unix のエディタの使い方を覚えるだけで1週間もかかってる！」とイライラする事もあるでしょう。しかしながら、道具の使い方を覚えることが職人にとって当然の心得であるように、使用するツールについて学ぶことは大切なことです。払った努力に見合う見返りは必ずあります。</p>

<div class="label" id="sec-rubygems"></div>


<h3><a id="sec-1_2_2" href="./beginning.html#sec-rubygems" class="heading"><span class="number">1.2.2</span>Ruby、RubyGems、Rails、Git</a></h3>




<blockquote><p>実質的に世界中のあらゆるソフトウェアは、壊れているか使いにくいかのどちらかだ。人々がソフトウェアに恐怖心を抱くのは、結局これが原因なのだ。人々は何かインストールしようとしたりオンラインフォームに記入したりするたびに、それらがさっぱり動かないという事態にすっかり慣らされてしまっている。正直、<em>私は</em>何かをインストールすることが怖い。これでも私はコンピュータサイエンスの博士号を持っているのだが。<br /> —「<em>Founders at Work</em>」(Jessica Livingston著) のPaul Grahamの言葉。</p>
</blockquote>


<p>それでは、RubyとRailsをインストールしましょう。本書では可能な限り多くの環境をカバーするようにしていますが、システムが変われば手順がうまくいかないこともあります。問題が生じた場合は、エラーメッセージをGoogleで検索するか、<a href="./help">RailsチュートリアルのHelpページ</a>を参照してください。</p>

<p><strong>なお、特に断りのない限り、Railsを含むすべてのソフトウェアはチュートリアルで使用されているものと同じバージョンを使用してください。そうでないと同じ結果を得られないことがあります。</strong> バージョンが少々異なっていても同じ結果を得られることもありますが、特にRailsのバージョンに関しては必ず指定を守ってください。なお、Ruby自身のバージョンは例外的にバージョンにそれほど厳しくありません。本チュートリアル内では、Ruby 1.9.3とRuby 2.0.0は実質的に同じように動作するため、どちらを使ってもチュートリアルには影響しません。お好きな方をご使用ください。</p>

<div class="label" id="sec-rails_installer_windows"></div>


<h4><a id="sec-1_2_2_1" href="./beginning.html#sec-rails_installer_windows" class="heading">Railsインストーラ (Windows)</a></h4>


<p>最近までWindows上でのRailsのインストールは困難だったのですが、<a href="http://engineyard.com/">Engine Yard</a>のメンバー (特にDr. Nic WilliamsとWayne E. Seguin) のおかげでインストールが非常に簡単になりました。Windowsユーザーの方は<a href="http://railsinstaller.org/">Railsインストーラ</a>からインストーラをダウンロードしてください。exeファイルをダブルクリックし、指示に従ってGit、Ruby、RubyGems、そしてRails自身をインストールします (<a class="ref" href="./beginning.html#sec-install_git">1.2.2.2</a>、<a class="ref" href="./beginning.html#sec-install_ruby">1.2.2.3</a>、<a class="ref" href="./beginning.html#sec-install_rubygems">1.2.2.4</a>、<a class="ref" href="./beginning.html#sec-install_rails">1.2.2.5</a>はスキップしてください)。インストール完了後、<a class="ref" href="./beginning.html#sec-the_first_application">1.2.3</a>までスキップして最初のアプリケーション作成を開始してください。</p>

<p>注意: このRailsインストーラによってインストールされるRailsのバージョンは、<a class="ref" href="./beginning.html#sec-install_rails">1.2.2.5</a>に記載のものと異なることがあります。その場合は互換性の問題が生じることもありえます。この問題を解決するために、Railsのバージョン番号順に並んだRubyインストーラのリストを作成してもらうようNicとWayneに働きかけています。</p>

<div class="label" id="sec-install_git"></div>


<h4><a id="sec-1_2_2_2" href="./beginning.html#sec-install_git" class="heading">Gitのインストール</a></h4>


<p>Rails環境の多くの部分は、<a href="http://git-scm.com/">Git</a>という<a href="http://en.wikipedia.org/wiki/Revision_control">バージョン管理システム</a>の機能に依存します (Gitの詳細については<a class="ref" href="./beginning.html#sec-version_control">1.3</a>で解説しています)。Gitは本書で多用されているので、早めにインストールを済ませておきます。<a href="http://www.git-scm.com/book/en/Getting-Started-Installing-Git"><em>Pro Git</em>の「Gitのインストール」</a>でプラットフォーム毎の解説を行っているので参考にしてください。</p>

<div class="label" id="sec-install_ruby"></div>


<h4><a id="sec-1_2_2_3" href="./beginning.html#sec-install_ruby" class="heading">Rubyのインストール</a></h4>


<p>次にRubyをインストールします (Rubyのインストールは面倒が多く、エラーもよく発生します。正直、新しいバージョンのRubyをインストールするのが怖いのですが、仕事を進める上では避けて通れません)。</p>

<p>場合によっては、既に自分のシステムにRubyがインストール済みであることもありえます。以下を実行して、</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> ruby -v
</pre></div>
</div>


<p>バージョン情報を確認してください。Rails 4ではRuby 1.9以降が必須であり、Ruby 2.0が最適です (Rails 4はRuby 1.8.7では動作しません)。本書では、Ruby 1.9.3または2.0.0を前提としますが、Ruby 1.9.2でも動作するはずです。</p>

<p>OS X、またはLinuxを使う場合、<a href="http://rvm.io/">Ruby Version Manager (RVM)</a> または<a href="https://github.com/sstephenson/rbenv">rbenv</a>を使用してRubyをインストールすることを強くお勧めします。RVMを使うと、複数のRubyバージョンを共存させられるのでとても便利です (Windows上で動作する同様のソフトに<a href="http://github.com/vertiginous/pik">Pik</a>があります)。同じコンピュータ上で異なるバージョンのRubyやRailsを使い分けたい場合、これらのツールは特に重要です。残念ながら、RVMとrbenvは共存できませんのでご注意ください。著者は本書でRVMを使い続けているので、今回もRVMを使用します。rbenvもかなり評判がよいようなので、rbenvに慣れ親しんでいるか、rbenvに詳しい人が身近にいるのであればそちらをお使いいただいてもかまいません (訳注: 最近ではrbenvも有力です。rbenvのセットアップ方法については、こちらをご参照ください: <a href='https://gist.github.com/axross/8429061'>rbenvを使ったRailsチュートリアルの進め方</a>)。</p>

<p>Mac OS Xユーザーの場合、Xcodeという開発ツールのインストールが必要なことがあります。Xcodeはサイズが大きいので、それよりもずっとサイズの小さい<a href="https://developer.apple.com/downloads/">Command Line Tools for Xcode</a>をお勧めします<sup class="footnote" id="fnref-1_12"><a href="./beginning.html#fn-1_12">12</a></sup>。</p>

<p>Rubyをインストールする前に、以下を実行して<a href="http://rvm.io/rvm/install/">RVM</a>をインストールします。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> curl -L https://get.rvm.io | bash -s
</pre></div>
</div>


<p>(RVMがインストール済みの場合、以下を実行して</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rvm get stable
</pre></div>
</div>


<p>最新のRVMを使用するようにしてください)。</p>

<p>RVMをインストール後、以下を実行してRubyインストールのための要件を調べます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rvm requirements
</pre></div>
</div>


<p>著者の場合、以下をインストールする必要がありました (ここでは<a href="http://mxcl.github.com/homebrew/">Homebrew</a>というMac OS X用のパッケージ管理システムを使用しています)。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> brew install libtool libxslt libksba openssl
</pre></div>
</div>


<p>Linuxの場合、<code>apt-get</code>または<code>yum</code>を使用して同様にインストールできます。</p>

<p>著者の場合、<a href="https://en.wikipedia.org/wiki/YAML">YAML</a>ライブラリのインストールも必要でした。</p>

<div class="code"><div class="highlight"><pre><span class="gp">#</span> MacでHomebrewを使用している場合
<span class="gp">$</span> brew install libyaml

<span class="gp">#</span> DebianベースのLinuxシステムの場合
<span class="gp">$</span> apt-get install libyaml-dev

<span class="gp">#</span> Fedora/CentOS/RHEL Linuxシステムの場合
<span class="gp">$</span> yum install libyaml-devel
</pre></div>
</div>


<p>最後に以下を実行してRuby 2.0.0をインストールします。ここではOpenSSLの場所をRVMに知らせるオプションを追加してあります。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rvm install 2.0.0 --with-openssl-dir<span class="o">=</span><span class="nv">$HOME</span>/.rvm/usr
<span class="go">&lt;しばらく待つ&gt;</span>
</pre></div>
</div>


<p>少なくとも著者の環境では、以上の手順でRuby 2.0.0のインストールに成功しました。</p>

<p>残念ながら、RubyやRVMのインストール中に問題が生じることがよくあります。本書ではなるべく問題が生じにくいような手順を記載しましたが、すべてをカバーすることはできません。問題が生じたらネットを検索するのが早道です。</p>

<p>Rubyをインストールしたら、Railsのアプリケーションを実行するために必要な他のソフトウェア向けにシステムを構成する必要があります。通常、これは<em>gem</em>のインストールに関連します。gemとは自己完結型のRubyコードのパッケージです。バージョン番号の異なるgem同士がコンフリクトすることがあるため、一連のgemを自己完結的にまとめた<em>gemset</em>というものを作成してバージョンを使い分けるのが便利です。本書向けに、以下を実行して<code>railstutorial_rails_4_0</code>という名前のgemsetを作成しておくことをお勧めします。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rvm use 2.0.0@railstutorial_rails_4_0 --create --default
<span class="go">Using /Users/mhartl/.rvm/gems/ruby-2.0.0-p0 
with gemset railstutorial_rails_4_0</span>
</pre></div>
</div>


<p>上のコマンドを実行すると、Ruby 2.0.0に関連付けられた<code>railstutorial_rails_4_0</code>というgemsetを作成し (<tt class="verb">--create</tt>)、その場でgemsetを有効にし (<tt class="verb">use</tt>)、gemsetをデフォルトに設定 (<tt class="verb">--default</tt>) します。これにより、ターミナルウィンドウを開いたときに<code>2.0.0@railstutorial_rails_4_0</code>というRubyとgemsetの組み合わせが常に選択されるようになります。RVMにはgemset管理のためのコマンドが多数用意されています。詳細については<a href="http://rvm.io/gemsets/">http://rvm.beginrescueend.com/gemsets/</a>を参照してください。RVMがうまく動かない場合は以下を実行してヘルプを表示してください。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rvm --help
<span class="gp">$</span> rvm gemset --help
</pre></div>
</div>


<p>RVMの詳細については、「<a href="http://strandcode.com/2013/07/11/ruby-version-manager-rvm-overview-for-rails-newbs/">Rails初心者のためのRuby Version Manager (RVM) の概要</a> (英語)」という記事を参考にしてください<sup class="footnote" id="fnref-1_13"><a href="./beginning.html#fn-1_13">13</a></sup>。</p>

<div class="label" id="sec-install_rubygems"></div>


<h4><a id="sec-1_2_2_4" href="./beginning.html#sec-install_rubygems" class="heading">RubyGemsのインストール</a></h4>


<p>RubyGemsはRubyのプロジェクトのためのパッケージマネージャであり、Rubyのパッケージ (<em>gem</em>) として利用できる多くの有用なライブラリがあります。Railsもgemとしてインストールします。Rubyがインストールされていれば、RubyGemsは簡単にインストールできます。<a href="http://rvm.io/rvm/install/">RVMをインストール</a>してあれば、既にRubyGemsも同時にインストールされているはずです。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> which gem
<span class="go">/Users/mhartl/.rvm/rubies/ruby-2.0.0-p0/bin/gem</span>
</pre></div>
</div>


<p>RubyGemsがインストールされていない場合は、<a href="http://rubyforge.org/frs/?group_id=126">RubyGemsをダウンロード</a>して解凍し、作成された<code>rubygems</code>ディレクトリでセットアッププログラムを実行してください。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> ruby setup.rb
</pre></div>
</div>


<p>(アクセス権の問題が生じたら、<a class="ref" href="./beginning.html#sec-conventions">1.1.3</a>を参照してください。おそらく<code>sudo</code>コマンドを併用する必要があります。)</p>

<p>既にRubyGemsがインストールされている場合は、システムをチュートリアルで使われているバージョンに更新してください。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> gem update --system 2.0.3
</pre></div>
</div>


<p>システムを特定のバージョンに固定しておけば、今後RubyGemsが変更されたときのコンフリクトを防止できます。</p>

<p>gemをインストールすると、RubyGemsによってriとrdocという2種類のドキュメントがデフォルトで作成されます。多くのRubyやRailsの開発者はこれらのドキュメントが自動生成される時間すら惜しいと考えます (ほとんどのプログラマーはネイティブのriやrdocなど参照せず、さっさとオンラインドキュメントを見に行ってしまいます)。riやrdocの自動生成を抑制するには、<code>.gemrc</code>というファイルを<a class="ref" href="./beginning.html#code-create_gemrc">リスト1.1</a>のようにホームディレクトリに作成し、そこに<a class="ref" href="./beginning.html#code-gemrc">リスト1.2</a>の内容を追加しておきます。(チルダ“<tt class="verb">~</tt>”は「ホームディレクトリ」を表します。 <code>.gemrc</code>ファイルのようにファイル名冒頭にドット「<tt class="verb">.</tt>」を付けると隠しファイルとして扱われます。Unixの設定ファイルにはこのような名前を付けるのが習わしとなっています。)</p>

<div class="label" id="code-create_gemrc"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト1.1</span> <span class="description">gem設定ファイルを作成する。</span> </div>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> subl ~/.gemrc
</pre></div>
</div></div>


<p>冒頭の<code>subl</code>はOS XでSublime Textを起動するコマンドです。設定方法については「<a href="http://www.sublimetext.com/docs/2/osx_command_line.html">OS X コマンドライン用Sublime Text 2ドキュメント</a> (英語)」を参照してください。使用しているプラットフォームやエディタが異なる場合、sublを他のエディタコマンドに読み替えてください (エディタのアイコンをダブルクリックするか、<code>mate</code>、<code>vim</code>、<code>gvim</code>、<code>mvim</code>などのコマンドに差し替えます)。記述を簡素化するため、本書で以後<code>subl</code>と書かれている箇所はお好みのエディタに読み替えてください。</p>

<div class="label" id="code-gemrc"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト1.2</span> <span class="description"><code>.gemrc</code>にriとrdoc生成を抑制するコマンドを追加する。</span> </div>
<div class="code"><div class="highlight"><pre><span class="ss">install:</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">rdoc</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">ri</span>
<span class="ss">update:</span>  <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">rdoc</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">ri</span>
</pre></div>
</div></div>




<div class="label" id="sec-install_rails"></div>


<h4><a id="sec-1_2_2_5" href="./beginning.html#sec-install_rails" class="heading">Railsのインストール</a></h4>


<p>RubyGemsをインストールしてしまえば、Railsのインストールは簡単です。本書ではRails 4.0を使用します。以下を実行してインストールしてください。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> gem install rails --version 4.0.2
</pre></div>
</div>


<p>正しくインストールされたかどうかを確認するには、以下のコマンドを実行してバージョンを確認してください。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails -v
<span class="go">Rails 4.0.2</span>
</pre></div>
</div>


<p><em>注:</em> <a class="ref" href="./beginning.html#sec-rails_installer_windows">1.2.2.1</a>でRailsインストーラを使用してRailsをインストールした場合、Railsのバージョンが上と異なっている可能性があります。この記事の執筆時点では、このバージョンの違いは影響していません。ただし、今後Railsのバージョンが本書指定のものから離れていくにつれ、バージョンの違いによる影響が顕著になる可能性があります。特定のバージョンのRailsインストーラへのリンクを作成してもらえるよう、現在Engine Yardに働きかけています。</p>

<p>Linuxを実行している場合は、この時点で、他にもいくつかのパッケージをインストールする必要が生じる場合があります。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> sudo apt-get install libxslt-dev libxml2-dev libsqlite3-dev <span class="c"># Linuxのみ</span>
</pre></div>
</div>




<div class="label" id="sec-the_first_application"></div>


<h3><a id="sec-1_2_3" href="./beginning.html#sec-the_first_application" class="heading"><span class="number">1.2.3</span>最初のアプリケーション</a></h3>


<p>どんなRailsアプリケーションも最初の作成手順は同じです。<code>rails new</code>コマンドを実行して作成します。このコマンドを実行するだけで、指定のディレクトリにRailsアプリケーションのスケルトンを簡単に作成できます。これを行うには、まず複数のRailsプロジェクトを保存するためのディレクトリを作成し、<code>rails new</code>を実行して最初のアプリケーションを作成します (<a class="ref" href="./beginning.html#code-rails_command">リスト1.3</a>)。</p>

<div class="label" id="code-rails_command"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト1.3</span> <span class="description"><code>rails new</code>を実行してアプリケーションを新規作成する。</span> </div>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> mkdir rails_projects
<span class="gp">$</span> <span class="nb">cd </span>rails_projects
<span class="gp">$</span> rails new first_app
<span class="go">      create  </span>
<span class="go">      create  README.rdoc</span>
<span class="go">      create  Rakefile</span>
<span class="go">      create  config.ru</span>
<span class="go">      create  .gitignore</span>
<span class="go">      create  Gemfile</span>
<span class="go">      create  app</span>
<span class="go">      create  app/assets/javascripts/application.js</span>
<span class="go">      create  app/assets/stylesheets/application.css</span>
<span class="go">      create  app/controllers/application_controller.rb</span>
<span class="go">      .</span>
<span class="go">      .</span>
<span class="go">      .</span>
<span class="go">      create  test/test_helper.rb</span>
<span class="go">      create  tmp/cache</span>
<span class="go">      create  tmp/cache/assets</span>
<span class="go">      create  vendor/assets/javascripts</span>
<span class="go">      create  vendor/assets/javascripts/.keep</span>
<span class="go">      create  vendor/assets/stylesheets</span>
<span class="go">      create  vendor/assets/stylesheets/.keep</span>
<span class="go">         run  bundle install</span>
<span class="go">.</span>
<span class="go">.</span>
<span class="go">.</span>
<span class="go">Your bundle is complete!</span><span class="go">Use `bundle show [gemname]` 
to see where a bundled</span> <span class="go">gem is installed.</span>
</pre></div>
</div></div>


<p><a class="ref" href="./beginning.html#code-rails_command">リスト1.3</a>の下の方にご注目ください。<code>rails new</code>を実行すると、ファイルの作成後に<code>bundle install</code>コマンドが自動的に実行されています。もしbundle installが実行されていなくても心配はいりません。落ち着いて<a class="ref" href="./beginning.html#sec-bundler">1.2.4</a>の手順に従えば実行できます。</p>

<p><code>rails</code>コマンドによって非常に多くのファイルとディレクトリが作成されていることにご注目ください。ディレクトリとファイルの構造 (<a class="ref" href="./beginning.html#fig-directory_structure_rails">図1.2</a>) がこのように標準化されていることは数あるRailsの利点の1つであり、何もない状態から実際に動かせるアプリケーションをただちに作成することができます。さらに、この構造はすべてのRailsアプリに共通しているので、他の開発者の書いたコードの挙動を容易に推察できます。Railsがデフォルトで作成するファイルについては<a class="ref" href="./beginning.html#table-rails_directory_structure">表1.1</a>を参照してください。これらのファイルやディレクトリの目的については本書全体に渡って説明いたします。特に、<a class="ref" href="./filling-in-the-layout.html#sec-the_asset_pipeline">5.2.1</a>以降ではRails 3.1の新機能である<em>Asset Pipeline</em>の一部となる<code>app/assets</code>ディレクトリについて詳しく説明します。Asset Pipelineによって、CSS (Cascading Style Sheet) やJavaScriptファイルなどのアセットを簡単に編成したりデプロイすることができます。</p>

<div class="label" id="fig-directory_structure_rails"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="../images/figures/directory_structure_rails_4_0.png" alt="directory_structure_rails_4_0" /></span></div><div class="caption"><span class="header">図1.2</span><span class="description">新規作成されたRailsアプリケーションのディレクトリ構造。<a href="../images/figures/directory_structure_rails_4_0-full.png">(拡大)</a></span></div></div>




<div class="label" id="table-rails_directory_structure"></div>


<div class="table"><div class="center">
<table class="tabular"><tr><th class="align_left"><strong>ファイル/ディレクトリ</strong></th><th class="align_left"><strong>目的</strong></th></tr><tr class="top_bar"><td class="align_left"><code>app/</code></td><td class="align_left">モデル、ビュー、コントローラ、ヘルパーなどを含む主要なアプリケーションコード</td></tr><tr><td class="align_left"><code>app/assets</code></td><td class="align_left">アプリケーションで使用するCSS (Cascading Style Sheet)、JavaScriptファイル、画像などのアセット</td></tr><tr><td class="align_left"><code>bin/</code></td><td class="align_left">バイナリ実行可能ファイル</td></tr><tr><td class="align_left"><code>config/</code></td><td class="align_left">アプリケーションの設定</td></tr><tr><td class="align_left"><code>db/</code></td><td class="align_left">データベース関連のファイル</td></tr><tr><td class="align_left"><code>doc/</code></td><td class="align_left">マニュアルなど、アプリケーションのドキュメント</td></tr><tr><td class="align_left"><code>lib/</code></td><td class="align_left">ライブラリモジュール</td></tr><tr><td class="align_left"><code>lib/assets</code></td><td class="align_left">ライブラリで使用するCSS (Cascading Style Sheet)、JavaScriptファイル、画像などのアセット</td></tr><tr><td class="align_left"><code>log/</code></td><td class="align_left">アプリケーションのログファイル</td></tr><tr><td class="align_left"><code>public/</code></td><td class="align_left">エラーページなど、一般(Webブラウザなど)に直接公開するデータ</td></tr><tr><td class="align_left"><code>script/rails</code></td><td class="align_left">コード生成、コンソールの起動、ローカルのWebサーバーの立ち上げなどに使用するRailsスクリプト</td></tr><tr><td class="align_left"><code>test/</code></td><td class="align_left">アプリケーションのテスト (<a class="ref" href="./static-pages.html#sec-static_pages">3.1.2</a>で作成する<code>spec/</code>ディレクトリがあるため、現在は使用されていません)</td></tr><tr><td class="align_left"><code>tmp/</code></td><td class="align_left">一時ファイル</td></tr><tr><td class="align_left"><code>vendor/</code></td><td class="align_left">サードパーティのプラグインやgemなど</td></tr><tr><td class="align_left"><code>vendor/assets</code></td><td class="align_left">サードパーティのプラグインやgemで使用するCSS (Cascading Style Sheet)、JavaScriptファイル、画像などのアセット</td></tr><tr><td class="align_left"><code>README.rdoc</code></td><td class="align_left">アプリケーションの簡単な説明</td></tr><tr><td class="align_left"><code>Rakefile</code></td><td class="align_left"><code>rake</code>コマンドで使用可能なタスク</td></tr><tr><td class="align_left"><code>Gemfile</code></td><td class="align_left">このアプリケーションに必要なGemの定義ファイル</td></tr><tr><td class="align_left"><code>Gemfile.lock</code></td><td class="align_left">アプリケーションのすべてのコピーが同じgemのバージョンを使用していることを確認するために使用されるgemのリスト</td></tr><tr><td class="align_left"><code>config.ru</code></td><td class="align_left"><a href="http://rack.rubyforge.org/doc/">Rackミドルウェア</a>用の設定ファイル</td></tr><tr><td class="align_left"><code>.gitignore</code></td><td class="align_left">Gitに無視させたいファイルを指定するためのパターン</td></tr></table></div><div class="caption"><span class="header">表1.1: </span> <span class="description">デフォルトのRailsフォルダ構造まとめ。</span></div></div>




<div class="label" id="sec-bundler"></div>


<h3><a id="sec-1_2_4" href="./beginning.html#sec-bundler" class="heading"><span class="number">1.2.4</span> Bundler</a></h3>


<p>Railsアプリケーションを新規作成したら、次は<em>Bundler</em>を実行して、アプリケーションに必要なgemをインストールおよびインクルードします。<a class="ref" href="./beginning.html#sec-the_first_application">1.2.3</a>でも簡単に説明したように、Bundlerは<code>rails</code>によって自動的に実行 (この場合は<code>bundle install</code>) されます。ここではデフォルトのアプリケーションgemを変更してBundlerを再度実行してみます。そのためにまず、好みのエディタで<code>Gemfile</code>を開きます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="nb">cd </span>first_app/
<span class="gp">$</span> subl Gemfile
</pre></div>
</div>


<p>ファイルの内容は<a class="ref" href="./beginning.html#code-default_gemfile">リスト1.4</a>のようになっているはずです。Gemfileの内容はRubyのコードですが、ここでは文法を気にする必要はありません。Rubyの詳細については<a class="ref" href="./rails-flavored-ruby.html#top">第4章</a>で説明します。</p>

<div class="label" id="code-default_gemfile"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト1.4</span> <span class="description"><code>first_app</code>ディレクトリ直下にあるデフォルトの<code>Gemfile</code>。</span> </div>
<div class="code"><div class="highlight"><pre><span class="n">source</span> <span class="s1">&#39;https://rubygems.org&#39;</span>

<span class="c1"># Use sqlite3 as the database for Active Record</span>
<span class="n">gem</span> <span class="s1">&#39;sqlite3&#39;</span>

<span class="c1"># Use SCSS for stylesheets</span>
<span class="n">gem</span> <span class="s1">&#39;sass-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 4.0.1&#39;</span>

<span class="c1"># Use Uglifier as compressor for JavaScript assets</span>
<span class="n">gem</span> <span class="s1">&#39;uglifier&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;= 1.3.0&#39;</span>

<span class="c1"># Use CoffeeScript for .js.coffee assets and views</span>
<span class="n">gem</span> <span class="s1">&#39;coffee-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 4.0.1&#39;</span>

<span class="c1"># See https://github.com/sstephenson/execjs#readme 
# for more supported runtimes</span>
<span class="c1"># gem &#39;therubyracer&#39;, platforms: :ruby</span>

<span class="c1"># Use jquery as the JavaScript library</span>
<span class="n">gem</span> <span class="s1">&#39;jquery-rails&#39;</span>

<span class="c1"># Turbolinks makes following links in your web application faster.</span>
<span class="c1"># Read more: https://github.com/rails/turbolinks</span>
<span class="n">gem</span> <span class="s1">&#39;turbolinks&#39;</span>

<span class="c1"># Build JSON APIs with ease. </span><span class="c1">
# Read more: https://github.com/rails/jbuilder</span>
<span class="n">gem</span> <span class="s1">&#39;jbuilder&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 1.0.1&#39;</span>

<span class="n">group</span> <span class="ss">:doc</span> <span class="k">do</span>
  <span class="c1"># bundle exec rake doc:rails generates the API under doc/api.</span>
  <span class="n">gem</span> <span class="s1">&#39;sdoc&#39;</span><span class="p">,</span> <span class="nb">require</span><span class="p">:</span> <span class="kp">false</span>
<span class="k">end</span>

<span class="c1"># Use ActiveModel has_secure_password</span>
<span class="c1"># gem &#39;bcrypt-ruby&#39;, &#39;~&gt; 3.1.2&#39;</span>

<span class="c1"># Use unicorn as the app server</span>
<span class="c1"># gem &#39;unicorn&#39;</span>

<span class="c1"># Use Capistrano for deployment</span>
<span class="c1"># gem &#39;capistrano&#39;, group: :development</span>

<span class="c1"># Use debugger</span>
<span class="c1"># gem &#39;debugger&#39;, group: [:development, :test]</span>
</pre></div>
</div></div>


<p>ほとんどの行はハッシュシンボル <code>#</code>でコメントされています。これらの行では、よく使われているgemとBundlerの文法の例をコメント形式で紹介しています。この時点では、デフォルト以外のgemをインストールする必要はありません。</p>

<p><code>gem</code>コマンドで特定のバージョン番号を指定しない限り、Bundlerは自動的に最新バージョンのgemを取得してインストールしてくれます。残念ながらgemを更新すると小さな問題を起こすことがよくあるので、<a class="ref" href="./beginning.html#code-default_gemfile">リスト1.4</a>からコメントアウト行を除いた<a class="ref" href="./beginning.html#code-gemfile_sqlite_version">リスト1.5</a>に示したように、このチュートリアルではたいていの場合動作確認済みのバージョン番号を指定しています。</p>

<div class="label" id="code-gemfile_sqlite_version"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト1.5</span> <span class="description">Ruby gemのバージョンを指定した<code>Gemfile</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="n">source</span> <span class="s1">&#39;https://rubygems.org&#39;</span>
<span class="n">ruby</span> <span class="s1">&#39;2.0.0&#39;</span>
<span class="c1">#ruby-gemset=railstutorial_rails_4_0</span>

<span class="n">gem</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="s1">&#39;4.0.2&#39;</span>

<span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;sqlite3&#39;</span><span class="p">,</span> <span class="s1">&#39;1.3.8&#39;</span>
<span class="k">end</span>

<span class="n">gem</span> <span class="s1">&#39;sass-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;4.0.1&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;uglifier&#39;</span><span class="p">,</span> <span class="s1">&#39;2.1.1&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;coffee-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;4.0.1&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;jquery-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.0.4&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;turbolinks&#39;</span><span class="p">,</span> <span class="s1">&#39;1.1.1&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;jbuilder&#39;</span><span class="p">,</span> <span class="s1">&#39;1.0.2&#39;</span>

<span class="n">group</span> <span class="ss">:doc</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;sdoc&#39;</span><span class="p">,</span> <span class="s1">&#39;0.3.20&#39;</span><span class="p">,</span> <span class="nb">require</span><span class="p">:</span> <span class="kp">false</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p><a class="ref" href="./beginning.html#code-gemfile_sqlite_version">リスト1.5</a>には以下の行が追加されています。</p>

<div class="code"><div class="highlight"><pre><span class="n">ruby</span> <span class="s1">&#39;2.0.0&#39;</span>
<span class="c1">#ruby-gemset=railstutorial_rails_4_0</span>
</pre></div>
</div>


<p>上の行は、アプリケーションが前提とするRubyのバージョンを指定しています。この指定は、特定のRVM gemset (<a class="ref" href="./beginning.html#sec-install_ruby">1.2.2.3</a>) に合わせてアプリケーションをデプロイする (<a class="ref" href="./beginning.html#sec-deploying">1.4</a>) ときに特に便利です。上の行のうち、<code>#</code>で始まる行はRubyのコメントです。RVMを使用しない場合はこのコメント行は無視されますが、RVMを使用している場合はこの行で指定しているgemsetが使用されます (2.0.0以外のバージョンのRubyを使用する場合は、Rubyのバージョンを書き換えてください)。</p>

<p>更新された<code>Gemfile</code>では、JQueryに関する以下の行も変更します。JQueryはRailsのデフォルトのJavaScriptライブラリです。</p>

<div class="code"><div class="highlight"><pre><span class="n">gem</span> <span class="s1">&#39;jquery-rails&#39;</span>
</pre></div>
</div>


<p>上を以下のように変更します。</p>

<div class="code"><div class="highlight"><pre><span class="n">gem</span> <span class="s1">&#39;jquery-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.0.4&#39;</span>
</pre></div>
</div>


<p>他にも変更を行います。</p>

<div class="code"><div class="highlight"><pre><span class="n">gem</span> <span class="s1">&#39;sqlite3&#39;</span>
</pre></div>
</div>


<p>上を以下のように変更します。</p>

<div class="code"><div class="highlight"><pre><span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;sqlite3&#39;</span><span class="p">,</span> <span class="s1">&#39;1.3.8&#39;</span>
<span class="k">end</span>
</pre></div>
</div>


<p>この変更を行うと、Bundlerは<code>sqlite3</code> gemの<code>1.3.8</code>を強制的にインストールします。ここではさらに、SQLiteをdevelopment環境 (<a class="ref" href="./sign-up.html#sec-rails_environments">7.1.1</a>) でのみ使用するための指定も行なっていることにご注目ください。こうすることで、Heroku (<a class="ref" href="./beginning.html#sec-deploying">1.4</a>) で使用するデータベースソフトウェアと衝突する可能性を避けられます。</p>

<p><a class="ref" href="./beginning.html#code-gemfile_sqlite_version">リスト1.5</a>では他にもいくつかの変更を行なっています。</p>

<div class="code"><div class="highlight"><pre><span class="c1"># Use SCSS for stylesheets</span>
<span class="n">gem</span> <span class="s1">&#39;sass-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 4.0.1&#39;</span>

<span class="c1"># Use Uglifier as compressor for JavaScript assets</span>
<span class="n">gem</span> <span class="s1">&#39;uglifier&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;= 1.3.0&#39;</span>

<span class="c1"># Use CoffeeScript for .js.coffee assets and views</span>
<span class="n">gem</span> <span class="s1">&#39;coffee-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 4.0.1&#39;</span>
</pre></div>
</div>


<p>上を以下のように変更します。</p>

<div class="code"><div class="highlight"><pre><span class="n">gem</span> <span class="s1">&#39;sass-rails&#39;</span><span class="p">,</span>   <span class="s1">&#39;4.0.1&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;uglifier&#39;</span><span class="p">,</span> <span class="s1">&#39;2.1.1&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;coffee-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;4.0.1&#39;</span>
</pre></div>
</div>


<p>以下の構文を実行すると</p>

<div class="code"><div class="highlight"><pre><span class="n">gem</span> <span class="s1">&#39;uglifier&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;= 1.3.0&#39;</span>
</pre></div>
</div>


<p><code>uglifier</code>のバージョンが<code>1.3.0</code>以上であれば最新バージョンのgemがインストールされます。 極端に言えばバージョンが<code>7.2</code>であってもそれが最新ならインストールされます。なお、uglifierはAsset Pipelineでファイル圧縮を行うためのものです。一方、例えば、以下のコードを実行すると</p>

<div class="code"><div class="highlight"><pre><span class="n">gem</span> <span class="s1">&#39;coffee-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 4.0.0&#39;</span>
</pre></div>
</div>


<p><code>coffee-rails</code> (これもAsset Pipelineで使用するgemです) のバージョンが<code>4.0.0</code>より大きく、<code>4.1</code>より小さい場合にインストールするようになります。つまり、<tt class="verb">&gt;=</tt>と書くと<code>bundle install</code>の実行時に必ずアップグレードが行われますが、<tt class="verb">~&gt; 4.0.0</tt>と書くとマイナーなアップグレードしか行われないことになります。この場合<code>4.0.0</code>から<code>4.0.1</code>へのアップグレードは行われますが、<code>4.0</code>から<code>4.1</code>へのアップグレードは行われません。経験上、残念ながらマイナーアップグレードですら問題を引き起こすことがあります。このため、<em>Railsチュートリアル</em>では基本的にすべてのgemでバージョンをピンポイントで指定しています。ベテラン開発者であれば、<code>Gemfile</code>で<tt class="verb">~&gt;</tt>が指定されているgemも含め、基本的に最新のgemを使用しても構いません。ただし、それによって本書に記載されているのと異なる挙動を示す可能性がありますので、その場合は各自でご対応願います。</p>

<p><code>Gemfile</code>を正しく設定した後、<code>bundle update</code><sup class="footnote" id="fnref-1_14"><a href="./beginning.html#fn-1_14">14</a></sup>と<code>bundle install</code>を使用してgemをインストールします。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle update
<span class="gp">$</span> bundle install
<span class="go">Fetching source index for https://rubygems.org/</span>
<span class="go">.</span>
<span class="go">.</span>
<span class="go">.</span>
</pre></div>
</div>


<p><code>bundle install</code>コマンドの実行にはしばらく時間がかかるかもしれません。完了後、アプリケーションが実行可能になります。</p>

<div class="label" id="sec-rails_server"></div>


<h3><a id="sec-1_2_5" href="./beginning.html#sec-rails_server" class="heading"><span class="number">1.2.5</span> <tt>rails server</tt></a></h3>


<p><a class="ref" href="./beginning.html#sec-the_first_application">1.2.3</a>の<code>rails new</code>コマンドと<a class="ref" href="./beginning.html#sec-bundler">1.2.4</a>の<code>bundle install</code>コマンドを実行したことにより、実際に動かすことのできるアプリケーションが作成されました。うれしいことに、Railsには開発マシンでのみブラウズできる<em>ローカル</em>Webサーバーを起動するためのコマンドラインプログラム (<em>スクリプト</em>) が付属しているので、以下のコマンドを実行するだけで簡単に起動することができます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails server
<span class="go">=&gt; Booting WEBrick</span>
<span class="go">=&gt; Rails application starting on http://0.0.0.0:3000</span>
<span class="go">=&gt; Call with -d to detach</span>
<span class="go">=&gt; Ctrl-C to shutdown server</span>
</pre></div>
</div>


<p>(JavaScriptランタイムがインストールされていないというエラーが表示された場合は、<a href="https://github.com/sstephenson/execjs">GitHubのexecjsページ</a>にあるインストール可能なランタイムを確認してください。<a href="http://nodejs.org/">Node.js</a>が特にお勧めです)。表示されたメッセージは、RailsアプリケーションがIPアドレス<code>0.0.0.0</code>、<a href="http://en.wikipedia.org/wiki/TCP_and_UDP_port">ポート番号</a>3000<sup class="footnote" id="fnref-1_15"><a href="./beginning.html#fn-1_15">15</a></sup>で動作していることを示しています。このIPアドレスは、このマシンに設定されているすべてのIPアドレスで受信待ち (listen) するように指定しています。これにより、<code>127.0.0.1</code>(<code>localhost</code>)という特別なアドレスでアプリケーションをブラウズできます。<a class="ref" href="./beginning.html#fig-riding_rails">図1.3</a>は、<a href="http://localhost:3000/">http://localhost:3000/</a>をブラウザで表示した時の結果です。</p>

<div class="label" id="fig-riding_rails"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="../images/figures/riding_rails_4_0.png" alt="riding_rails_4_0" /></span></div><div class="caption"><span class="header">図1.3</span> <span class="description">デフォルトのRailsページ。<a href="../images/figures/riding_rails_4_0-full.png">(拡大)</a></span></div></div>


<p>この最初のアプリケーションの情報を見るには、「About your application’s environment」のリンクをクリックしてください。<a class="ref" href="./beginning.html#fig-riding_rails_environment">図1.4</a>のような画面が表示されます (<a class="ref" href="./beginning.html#fig-riding_rails_environment">図1.4</a>は著者の環境でキャプチャしたものなので、実際には若干異なる可能性があります)。</p>

<div class="label" id="fig-riding_rails_environment"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="../images/figures/riding_rails_environment_4_0.png" alt="riding_rails_environment_4_0" /></span></div><div class="caption"><span class="header">図1.4</span> <span class="description">アプリケーション環境が表示されているデフォルトページ。<a href="../images/figures/riding_rails_environment_4_0-full.png">(拡大)</a></span></div></div>


<p>もちろん、いずれデフォルトのRailsページは不要になりますが、アプリケーションが動いているのを見るのは気分のいいものです。<a class="ref" href="./filling-in-the-layout.html#sec-rails_routes">5.3.2</a>ではこのデフォルトページを削除し、カスタマイズしたホームページに置き換える予定です。</p>

<div class="label" id="sec-mvc"></div>


<h3><a id="sec-1_2_6" href="./beginning.html#sec-mvc" class="heading"><span class="number">1.2.6</span> Model-View-Controller (MVC)</a></h3>


<p>まだ始まったばかりですが、今のうちにRailsアプリケーションの全体的な仕組みを知っておくことは後々役立ちます (<a class="ref" href="./beginning.html#fig-MVC">図1.5</a>)。デフォルトのRailsアプリ構造 (<a class="ref" href="./beginning.html#fig-directory_structure_rails">図1.2</a>) を眺めてみると、<code>app/</code>というディレクトリがあり、その中に「<code>models</code>」「<code>views</code>」「<code>controllers</code>」という3つのサブディレクトリがあることに気付いた方もいると思います。ここにはRailsが<a href="http://en.wikipedia.org/wiki/Model-view-controller">MVC (model-view-controller)</a> というアーキテクチャパターンを採用していることが暗に示されています。MVCでは、ドメインロジック (ビジネスロジックともいいます) と、グラフィカルユーザーインターフェイス (GUI) と密に関連する入力/表示ロジックを分離します。Webアプリケーションの場合、「ドメインロジック」はユーザーや記事、商品などのデータモデルに相当し、ユーザーインターフェイスはWebページを指します。</p>

<p>Railsアプリと通信する際、ブラウザは一般的にWebサーバーに<em>request</em> (リクエスト) を送信し、これはリクエストを処理する役割を担っているRailsの<em>controller</em> (コントローラ) に渡されます。 コントローラは、場合によってはすぐに<em>view</em> (ビュー) を生成してHTMLをブラウザに送り返します。動的なサイトでは、一般にコントローラは (ユーザーなどの) サイトの要素を表しており、データベースとの通信を担当しているRubyのオブジェクトである<em>model</em> (モデル) と対話します。モデルを呼び出した後、コントローラは、ビューをレンダリングし、完成したWebページをHTMLとしてブラウザに返します。</p>

<div class="label" id="fig-MVC"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="../images/figures/mvc_schematic.png" alt="mvc_schematic" /></span></div><div class="caption"><span class="header">図1.5: </span> <span class="description">model-view-controller (MVC) アーキテクチャの概念図。</span></div></div>


<p>今はまだこの解説が少し抽象的に思えるかもしれませんが、この章は後に何度も参照する事になるのでご安心ください。MVCについては、<a class="ref" href="./a-demo-app.html#sec-mvc_in_action">2.2.2</a>のデモアプリケーションの説明の中でもさらに詳しく解説します。サンプルアプリケーションでは、MVCの3つの要素をすべて使用します。<a class="ref" href="./static-pages.html#sec-static_pages">3.1.2</a>ではまずコントローラとビューを使用し、モデルは<a class="ref" href="./modeling-users.html#sec-user_model">6.1</a>から使い始めます。 <a class="ref" href="./sign-up.html#sec-a_users_resource">7.1.2</a>では3つの要素が協調して動作します。</p>

<div class="label" id="sec-version_control"></div>


<h2><a id="sec-1_3" href="./beginning.html#sec-version_control" class="heading"><span class="number">1.3</span> Gitによるバージョン管理</a></h2>


<p>新しく動作するRailsアプリが完成したところで、さっそくアプリケーションのソースコードを<em>バージョン管理</em>下に置きましょう。これを行わないとアプリケーションが動かないということではありませんが、ほとんどのRails開発者はバージョン管理は開発現場において必要不可欠であると考えています。バージョン管理システムを導入しておけば、プロジェクトのコードの履歴を追ったり、うっかり削除してしまったファイルを復旧 (ロールバック) したりという作業が行えるようになります。バージョン管理システムを熟知することは、今やあらゆるソフトウェア開発者にとって必須のスキルであると言ってよいでしょう。</p>

<p>バージョン管理システムにもさまざまなものがありますが、RailsコミュニティではLinuxカーネル用にLinus Torvaldsにより開発された分散バージョン管理システムである<a href="http://git-scm.com/">Git</a>が主流になっています。Git (というよりバージョン管理) はそれだけで大きなテーマなので、すべてを説明しようとすると軽く一冊の本を超えてしまいます。本書では簡単に言及するにとどめますが、幸いネット上には無償で利用できるリソースがあふれています。その中でも特に「<a href="http://progit.org"><em>Pro Git</em></a>」Scott Chacon (Apress, 2009) をお勧めいたします (訳注: Pro Gitには素晴らしい日本語版があります: http://git-scm.com/book/ja/ )。ソースコードのバージョン管理は<em>何としても</em>導入してください。バージョン管理はRailsを使用するどんな場面でも必要になりますし、バージョン管理システムを応用して、自分の作成したコードを他の開発者と簡単に共有したり <a class="ref" href="./beginning.html#sec-github">1.3.4</a>)、最初の章で作成したアプリケーションを本番サーバーへデプロイしたりすることもできる (<a class="ref" href="./beginning.html#sec-deploying">1.4</a>) からです。</p>

<div class="label" id="sec-git_setup"></div>


<h3><a id="sec-1_3_1" href="./beginning.html#sec-git_setup" class="heading"><span class="number">1.3.1</span>インストールとセットアップ</a></h3>


<p>Gitがインストールされていない場合は、まず<a class="ref" href="./beginning.html#sec-install_git">1.2.2.2</a>に従ってGitをインストールしてください (リンク先の節でも述べているように、<a href="http://progit.org/book/ch1-4.html"><em>Pro Git</em>の「Gitのインストール</a>」の記載に従うことになります)。</p>

<h4><a id="sec-1_3_1_1" href="./beginning.html#sec-1_3_1_1" class="heading">最初のシステムセットアップ</a></h4>


<p>Gitのインストール後、最初に1回だけ行う必要のある設定があります。これは<em>system</em>セットアップと呼ばれ、使用するコンピュータ1台につき1回だけ行います。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git config --global user.name <span class="s2">&quot;あなたの名前&quot;</span>
<span class="gp">$</span> git config --global user.email your.email@example.com
</pre></div>
</div>


<p>著者の場合、<code>checkout</code> という長ったらしいコマンドの代わりに<code>co</code>という短いコマンド (エイリアス) も使えるようにしています。これを行うには以下を実行します。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git config --global alias.co checkout
</pre></div>
</div>


<p>本書では、<code>co</code>エイリアスを設定していないシステムでも動作するようにフルスペルの<code>checkout</code>を使用していますが、著者自身は実際の開発ではほとんどいつも<code>git co</code>を使ってプロジェクトをチェックアウトしています。</p>

<p>手順の最後として、Gitのコミットメッセージを入力するときに使用するエディタを設定できます。Sublime Text、TextMate、gVim、MacVimなどのGUIエディタを使用する場合、シェルから離れずシェル内で起動するようフラグを付けてください<sup class="footnote" id="fnref-1_16"><a href="./beginning.html#fn-1_16">16</a></sup>。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git config --global core.editor <span class="s2">&quot;subl -w&quot;</span>
</pre></div>
</div>


<p><code>&quot;subl -w&quot;</code> の部分は、TextMateの場合は <code>&quot;mate -w&quot;</code>、gVimの場合は<code>&quot;gvim -f&quot;</code>、MacVimの場合は<code>&quot;mvim -f&quot;</code> にそれぞれ置き換えます。</p>

<h4><a id="sec-1_3_1_2" href="./beginning.html#sec-1_3_1_2" class="heading">最初のリポジトリセットアップ</a></h4>


<p>今度は、<em>リポジトリ</em>を作成するたびに必要な作業を行います。まず、Railsアプリケーションのルートディレクトリに移動し、新しいリポジトリの初期化を行います。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git init
<span class="go">Initialized empty Git repository in /Users/mhartl/rails_projects/first_app/.git/</span>
</pre></div>
</div>


<p>次に、プロジェクトのファイルをリポジトリに追加します。ここで１つ問題があります。Gitは<em>すべての</em>ファイルの変更履歴を管理するようになっていますが、管理対象に含めたくないファイルもあります。たとえば、Railsによって作成されるログファイルは頻繁に内容が変わるので、いちいちバージョン管理に更新させたくありません。Gitにはこういったファイルを管理対象から除外する機能があります。<code>.gitignore</code>というファイルをアプリケーションのルートディレクトリに置き、除外したいファイルを指定するためのルールをそこに記載します<sup class="footnote" id="fnref-1_17"><a href="./beginning.html#fn-1_17">17</a></sup>。</p>

<p><a class="ref" href="./beginning.html#table-rails_directory_structure">表1.1</a>をもう一度見てみると、<code>rails</code>コマンドを実行した時にRailsアプリケーションのルートディレクトリに<code>.gitignore</code>ファイルが作成されています (<a class="ref" href="./beginning.html#code-default_gitignore">リスト1.6</a>)。</p>

<div class="label" id="code-default_gitignore"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト1.6</span> <span class="description"><code>rails</code>コマンドで作成されるデフォルトの<code>.gitignore</code>ファイルの内容。</span> </div>
<div class="code"><div class="highlight"><pre># See http://help.github.com/ignore-files/ for more about ignoring files.
#
# If you find yourself ignoring temporary files generated by your text editor
# or operating system, you probably want to add a global ignore instead:
#   git config --global core.excludesfile &#39;~/.gitignore_global&#39;

# Ignore bundler config.
/.bundle

# Ignore the default SQLite database.
/db/*.sqlite3
/db/*.sqlite3-journal

# Ignore all logfiles and tempfiles.
/log/*.log
/tmp
</pre></div>
</div></div>


<p><a class="ref" href="./beginning.html#code-default_gitignore">リスト1.6</a>の設定では、ログファイル、Railsの一時ファイル (<code>tmp</code>)、SQLiteデータベースなどが除外されます。(<code>log/</code>ディレクトリ以下のログファイルを除外したい場合は、<code>log/*.log</code>と指定することで、ファイル名が<code>.log</code>で終わるファイルが除外されます。これらのファイルは頻繁に更新されるため、バージョン管理に含めるのは何かと不便です。さらに、他の開発者と共同作業を行う場合にこのようなファイルをバージョン管理に含めると無用な衝突 (conflict) が発生し、関係者一同が無用のストレスにさらされることになりかねません。</p>

<p>最初のうちは<a class="ref" href="./beginning.html#code-default_gitignore">リスト1.6</a>の<code>.gitignore</code>設定でもよいでしょう。しかし、<a class="ref" href="./beginning.html#code-gitignore">リスト1.7</a>の方がさらに便利で、セキュリティ上も有利 (<a class="ref" href="./static-pages.html#code-secret_token">リスト3.2</a>) なのでお勧めです。この<code>.gitignore</code>では、Railsドキュメントファイル、VimやEmacsのスワップファイル、そしてOS Xユーザーにはお馴染みの、あのいまいましい<code>.DS_Store</code>ディレクトリ (MacのFinder操作で作成される隠しディレクトリ) も管理対象から除外されます。この拡張版除外設定を使用したい場合は、<code>.gitignore</code>を好みのテキストエディタで開き、<a class="ref" href="./beginning.html#code-gitignore">リスト1.7</a>の内容で置き換えます。</p>

<div class="label" id="code-gitignore"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト1.7</span> <span class="description">より多くのパターンを除外する<code>.gitignore</code>ファイル。</span> </div>
<div class="code"><div class="highlight"><pre># Ignore bundler config.
/.bundle

# Ignore the default SQLite database.
/db/*.sqlite3
/db/*.sqlite3-journal

# Ignore all logfiles and tempfiles.
/log/*.log
/tmp

# Ignore other unneeded files.
doc/
*.swp
*~
.project
.DS_Store
.idea
.secret
</pre></div>
</div></div>




<div class="label" id="sec-adding_and_committing"></div>


<h3><a id="sec-1_3_2" href="./beginning.html#sec-adding_and_committing" class="heading"><span class="number">1.3.2</span>追加とコミット</a></h3>


<p>最後に、新しく作成したRailsプロジェクトのファイルをGitに追加し、次にそれをコミットします。ファイルを追加する (<code>.gitignore</code>で指定されているものを除く) には、以下のコマンドを実行します。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git add .
</pre></div>
</div>


<p>ここで「<code>.</code>」は現在のディレクトリ (カレントディレクトリ) を指します。Gitは<em>再帰的に</em>ファイルを追加できるので、自動的にすべてのサブディレクトリも追加されます。このコマンドにより、プロジェクトのファイルは、コミット待ちの変更が格納されている「<em>ステージングエリア</em>」という一種の待機場所に追加されます。ステージングエリアにあるファイルのリストを表示するには、<code>status</code>コマンドを実行します<sup class="footnote" id="fnref-1_18"><a href="./beginning.html#fn-1_18">18</a></sup>。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git status
<span class="gp">#</span> On branch master
<span class="gp">#</span>
<span class="gp">#</span> Initial commit
<span class="gp">#</span>
<span class="gp">#</span> Changes to be committed:
<span class="gp">#</span>   <span class="o">(</span>use <span class="s2">&quot;git rm --cached &lt;file&gt;...&quot;</span> to unstage<span class="o">)</span>
<span class="gp">#</span>
<span class="gp">#</span>       new file:   README.rdoc
<span class="gp">#</span>       new file:   Rakefile
<span class="go">.</span>
<span class="go">.</span>
<span class="go">.</span>
</pre></div>
</div>


<p>（出力結果が長いので、省略された部分を示すために縦点を使っています。）</p>

<p>変更を保存するには、<code>commit</code>コマンドを使います。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git commit -m <span class="s2">&quot;Initialize repository&quot;</span>
<span class="go">[master (root-commit) df0a62f] Initialize repository</span>
<span class="go">42 files changed, 8461 insertions(+), 0 deletions(-)</span>
<span class="go">create mode 100644 README.rdoc</span>
<span class="go">create mode 100644 Rakefile</span>
<span class="go">.</span>
<span class="go">.</span>
<span class="go">.</span>
</pre></div>
</div>


<p><code>-m</code>フラグは、コミットメッセージ (コミット内容の覚書) をその場で追加する場合に使用します。<code>-m</code>を省略した場合、<a class="ref" href="./beginning.html#sec-git_setup">1.3.1</a>で設定されたエディタが起動され、コミットメッセージの入力を求められます。</p>

<p>ここでコミットについて少し解説しておきます。Gitにおけるコミットは、あくまで<em>ローカル</em>マシン上での操作であることにご注意ください。この点については、もう一つの有名なオープンソースバージョン管理システムであるSubversionとははっきり異なります。Gitの場合、コミットを実行してもリモート上にあるリポジトリを直接変更することはありません。Gitでは、ローカルでの変更保存 (<code>git commit</code>) と、リモート上のリポジトリへの変更反映 (<code>git push</code>) の2段階に分かれています。<a class="ref" href="./beginning.html#sec-git_commands">1.3.5</a>にはこのpushの例が記載されています。</p>

<p>ちなみに、<code>log</code>コマンドでコミットメッセージの履歴を参照できます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git log
<span class="go">commit df0a62f3f091e53ffa799309b3e32c27b0b38eb4</span>
<span class="go">Author: Michael Hartl &lt;michael@michaelhartl.com&gt;</span>
<span class="go">Date:   Thu Oct 15 11:36:21 2009 -0700</span>

<span class="go">  Initialize repository</span>
</pre></div>
</div>


<p><code>git log</code>を終了するには<code>q</code>キーを押してください。</p>

<h3><a id="sec-1_3_3" href="./beginning.html#sec-1_3_3" class="heading"><span class="number">1.3.3</span>Gitのメリット</a></h3>


<p>今の時点では、ソースコードをバージョン管理下に置かなければならない理由が今ひとつよくわからないという方がいるかもしれませんので、例を1つ紹介します (この後の章でも多くの実例を紹介します)。仮に、あなたが重要な<code>app/controllers/</code>ディレクトリを削除してしまったとしましょう。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> ls app/controllers/
<span class="go">application_controller.rb</span>
<span class="gp">$</span> rm -rf app/controllers/
<span class="gp">$</span> ls app/controllers/
<span class="go">ls: app/controllers/: No such file or directory</span>
</pre></div>
</div>


<p>ここでは、Unixコマンドの<code>ls</code>で<code>app/controllers/</code>ディレクトリの中身を表示した後、<code>rm</code>コマンドをうっかり実行してこのディレクトリを削除してしまいました。<code>-rf</code>フラグは、「recursive」(サブディレクトリやその中のファイルもすべて削除する)、「 force」(削除して良いかどうかをユーザーに確認しない) を指定するオプションです。</p>

<p>現在の状態を確認してみましょう。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git status
<span class="gp">#</span> On branch master
<span class="gp">#</span> Changed but not updated:
<span class="gp">#</span>   <span class="o">(</span>use <span class="s2">&quot;git add/rm &lt;file&gt;...&quot;</span> to update what will be committed<span class="o">)</span>
<span class="gp">#</span>   <span class="o">(</span>use <span class="s2">&quot;git checkout -- &lt;file&gt;...&quot;</span> to discard changes in working directory<span class="o">)</span>
<span class="gp">#</span>
<span class="gp">#</span>       deleted:    app/controllers/application_controller.rb
<span class="gp">#</span>
<span class="go">no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)</span>
</pre></div>
</div>


<p>ファイルがいくつか削除されましたが、この変更が行われたのは現在の「作業ツリー」内のみなので、まだコミット (保存) されていません。つまり、以前のコミットを<code>checkout</code>コマンド (と、現在までの変更を強制的に上書きして元に戻すための<code>-f</code>フラグ) でチェックアウトすれば、簡単に削除前の状態に戻すことができます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git checkout -f
<span class="gp">$</span> git status
<span class="gp">#</span> On branch master
<span class="go">nothing to commit (working directory clean)</span>
<span class="gp">$</span> ls app/controllers/
<span class="go">application_controller.rb</span>
</pre></div>
</div>


<p>削除されたディレクトリとファイルが無事復旧しました。これでひと安心です。</p>

<div class="label" id="sec-github"></div>


<h3><a id="sec-1_3_4" href="./beginning.html#sec-github" class="heading"><span class="number">1.3.4</span>GitHub</a></h3>


<p>Gitを使用してプロジェクトをバージョン管理下に置くことができたので、今度は<a href="http://github.com">GitHub</a>にソースコードをアップロードしてみましょう。GitHubは、Gitリポジトリの置き場所を提供したり (ホスティング)、リポジトリを開発者同士で共有するサービスを提供したりするWebサービスとして有名です。リポジトリをGitHubにわざわざプッシュするのには2つの理由があります。1つ目は、ソースコード (とそのすべての変更履歴) の完全なバックアップを作成することです。2つ目は、他の開発者との共同作業をより簡単に行うことです。GitHubへのプッシュは必須ではありませんが、GitHubのメンバーになっておくと、多くのオープンソースプロジェクトに参加できるようになります。</p>

<div class="label" id="fig-create_first_repository"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="../images/figures/create_first_repository_4_0.png" alt="create_first_repository_4_0" /></span></div><div class="caption"><span class="header">図1.6</span><span class="description">アカウント作成直後のGitHubページ。<a href="../images/figures/create_first_repository_4_0-full.png">(拡大)</a></span></div></div>


<p>GitHubにはさまざまな有料プランがありますが、オープンソースのコードなら無料で利用できるので、初めて利用するのであれば<a href="https://github.com/signup/free">無料のGitHubアカウント</a>を作成しましょう (念のため、<a href="http://help.github.com/key-setup-redirect">GitHubのSSHキー作成方法のチュートリアル</a>を先に読んでおいてください)。 アカウント作成後、[<a href="http://github.com/new">Create repository</a>]をクリックし、<a class="ref" href="./beginning.html#fig-create_first_repository">図1.6</a>に従ってフォームに記入します。(注意: このときに<code>README</code>ファイルを使用してリポジトリを初期化<em>しないでください</em> 。<code>rails new</code>コマンドを実行するときにこれらのファイルは自動的に作成されるからです) 。リポジトリを作成したら、以下を実行してアプリケーションをプッシュします。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git remote add origin https://github.com/&lt;username&gt;/first_app.git
<span class="gp">$</span> git push -u origin master
</pre></div>
</div>


<p>最初のコマンドは、現在のメイン (<em>master</em>) ブランチ用の &quot;origin&quot; としてGitHubに追加します。次のコマンドで実際に GitHubにプッシュします （<tt>-u</tt>フラグについては気にする必要はありません。気になるのであれば &quot;git set upstream&quot;で検索してみてください）。もちろん、<tt class="verb">&lt;username&gt;</tt>はあなたの名前に置き換えてください。たとえば、著者が実行したコマンドは以下のとおりです。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git remote add origin https://github.com/mhartl/first_app.git
</pre></div>
</div>


<p>このコマンドを実行すると、GitHubにファイル閲覧、コミット履歴の表示など多数の機能を備えたアプリケーションのリポジトリ用のページが作成されました (<a class="ref" href="./beginning.html#fig-github_repository_page">図1.7</a>)。</p>

<div class="label" id="fig-github_repository_page"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="../images/figures/github_repository_page_4_0.png" alt="github_repository_page_4_0" /></span></div><div class="caption"><span class="header">図1.7</span><span class="description">GitHubのリポジトリページ。<a href="../images/figures/github_repository_page_4_0-full.png">(拡大)</a></span></div></div>


<p>なお、GitHubにはコマンドラインインターフェイスを拡張したGUIアプリケーションもあります。 GUIアプリケーションの方が好みであれば、<a href="http://windows.github.com/">GitHub for Windows</a>や<a href="http://mac.github.com/">GitHub for Mac</a>をチェックしてみてください (GitHub for Linuxは今のところ存在しないようです)。</p>

<div class="label" id="sec-git_commands"></div>


<h3><a id="sec-1_3_5" href="./beginning.html#sec-git_commands" class="heading"><span class="number">1.3.5</span>ブランチ (branch)、変更 (edit)、 コミット (commit)、マージ (merge)</a></h3>


<p><a class="ref" href="./beginning.html#sec-github">1.3.4</a>で紹介した手順に従っていれば、GitHubは自動的にリポジトリのメインページに<code>README</code>ファイルの内容を表示していることに気付くでしょう。このチュートリアルでは、プロジェクトは<code>rails</code>コマンドによって作成されたRailsアプリケーションなので、<code>README</code>ファイルはRailsに既に含まれています (<a class="ref" href="./beginning.html#fig-rails_readme">図1.8</a>)。<code>README</code>ファイルの拡張子は<code>.rdoc</code>になっているので、GitHubでは適切なフォーマットで表示されます。しかしその内容はRailsフレームワークそのものに関するもので、そのままでは役に立ちません。この節ではREADMEの内容を編集し、プロジェクトに関する記述に置き換えます。それと同時に、Gitでbranch、edit、commit、mergeを行う際にお勧めのワークフローの実例をお見せします。</p>

<div class="label" id="fig-rails_readme"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="../images/figures/rails_readme_4_0.png" alt="rails_readme_4_0" /></span></div><div class="caption"><span class="header">図1.8</span><span class="description">GitHub上の、無用な初期の<code>README</code>ファイル。<a href="../images/figures/rails_readme_4_0-full.png">(拡大)</a></span></div></div>




<div class="label" id="sec-git_branch"></div>


<h4><a id="sec-1_3_5_1" href="./beginning.html#sec-git_branch" class="heading">ブランチ (branch)</a></h4>


<p>Gitは、ブランチ (<em>branch</em>) をきわめて簡単かつ高速に作成することができます。ブランチは基本的にはリポジトリのコピーで、ブランチ上では元のファイルを触らずに新しいコードを書くなど、自由に変更や実験を試すことができます。通常、親リポジトリは<em>マスター</em>ブランチと呼ばれ、トピックブランチ (短期間だけ使う一時的なブランチ) は<code>checkout</code>と<code>-b</code>フラグを使って作成できます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git checkout -b modify-README
<span class="go">Switched to a new branch &#39;modify-README&#39;</span>
<span class="gp">$</span> git branch
<span class="go">master</span>
<span class="go">* modify-README</span>
</pre></div>
</div>


<p>2つ目のコマンド (<code>git branch</code>) は、単にすべてのローカルブランチを一覧表示しているだけです。「<code>*</code>」はそのブランチが現在使用中であることを表します。1番目の<code>git checkout -b modify-README</code>コマンドで、ブランチの新規作成とそのブランチへの切り替えが同時に行われていることに注目してください。<code>modify-README</code>ブランチに*が付いていることで、このブランチが現在使用中であることが示されています (<a class="ref" href="./beginning.html#sec-version_control">1.3</a>で<code>co</code>エイリアスを設定した場合は、<code>git co -b modify-README</code>と入力することもできます)。</p>

<p>ブランチの真価は他の開発者と共同で作業する時に発揮されますが<sup class="footnote" id="fnref-1_19"><a href="./beginning.html#fn-1_19">19</a></sup>、このチュートリアルのように一人で作業する時にも非常に有用です。マスターブランチはトピックブランチで行った変更に影響されないので、たとえブランチ上のコードが<em>めちゃくちゃ</em>になってしまっても、マスターブランチをチェックアウトしてトピックブランチを削除すれば、いつでも変更を破棄する事ができます。具体的な方法についてはこの章の最後で説明します。</p>

<p>ちなみに、通常このような小さな変更のためにわざわざブランチを作成する必要はありませんが、ブランチがよい習慣であることに変わりはないので、少しでも練習しておきましょう。</p>

<div class="label" id="sec-git_edit"></div>


<h4><a id="sec-1_3_5_2" href="./beginning.html#sec-git_edit" class="heading">変更 (Edit)</a></h4>


<p>トピックブランチを作成後、READMEの内容をわかりやすく書き換えてみましょう。著者の場合、デフォルトのRDocを編集するときには主に<a href="http://daringfireball.net/projects/markdown/">Markdown</a>というマークアップ言語を使用しています。拡張子を<code>.md</code>にしておけば、GitHubにアップロードしたときに自動的にドキュメントがきれいに整形されます。今回はGitに付属する<code>mv</code>コマンド (注: Unixのmvコマンドではありません!) を使ってREADMEの拡張子を変更し、それからREADMEの内容を<a class="ref" href="./beginning.html#code-new_readme">リスト1.8</a>の内容に書き換えます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git mv README.rdoc README.md
<span class="gp">$</span> subl README.md
</pre></div>
</div>


<div class="label" id="code-new_readme"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト1.8</span> <span class="description">新しい<code>README</code>ファイル (<code>README.md</code>)。</span> </div>
<div class="code"><div class="highlight"><pre># Ruby on Rails チュートリアル：サンプルアプリケーション

This is the first application for the
[*Ruby on Rails Tutorial*](http://railstutorial.jp/)
by [Michael Hartl](http://michaelhartl.com/).
</pre></div>
</div></div>




<div class="label" id="sec-git_commit"></div>


<h4><a id="sec-1_3_5_3" href="./beginning.html#sec-git_commit" class="heading">コミット (commit)</a></h4>


<p>変更が終わったら、ブランチの状態を確認してみましょう。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git status
<span class="gp">#</span> On branch modify-README
<span class="gp">#</span> Changes to be committed:
<span class="gp">#</span>   <span class="o">(</span>use <span class="s2">&quot;git reset HEAD &lt;file&gt;...&quot;</span> to unstage<span class="o">)</span>
<span class="gp">#</span>
<span class="gp">#</span>       renamed:    README.rdoc -&gt; README.md
<span class="gp">#</span>
<span class="gp">#</span> Changed but not updated:
<span class="gp">#</span>   <span class="o">(</span>use <span class="s2">&quot;git add &lt;file&gt;...&quot;</span> to update what will be committed<span class="o">)</span>
<span class="gp">#</span>   <span class="o">(</span>use <span class="s2">&quot;git checkout -- &lt;file&gt;...&quot;</span> to discard changes in working directory<span class="o">)</span>
<span class="gp">#</span>
<span class="gp">#</span>       modified:   README.md
<span class="gp">#</span>
</pre></div>
</div>


<p>この時点で、<a class="ref" href="./beginning.html#sec-adding_and_committing">1.3.2</a>のように<code>git add .</code>を実行することもできますが、Gitには現存するすべてのファイル (git mvで作成したファイルも含む) への変更を一括でコミットする<code>-a</code>フラグがあります。このフラグは非常によく使われます。なお、<code>git mv</code>で作成されたファイルは、Gitによって新規ファイルではなく変更として扱われます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git commit -a -m <span class="s2">&quot;Improve the README file&quot;</span>
<span class="go">2 files changed, 5 insertions(+), 243 deletions(-)</span>
<span class="go">delete mode 100644 README.rdoc</span>
<span class="go">create mode 100644 README.md</span>
</pre></div>
</div>


<p><code>-a</code>フラグは慎重に扱ってください。最後のコミット後に新しいファイルを追加した場合は、まず<code>git add</code>を実行してバージョン管理下に置く必要があります。</p>

<p>コミットメッセージは<em>現在形</em>で書くようにしましょう。Gitのモデルは、(単一のパッチではなく) 一連のパッチとしてコミットされます。そのため、コミットメッセージを書くときには、そのコミットが「何をしたのか」と履歴スタイルで書くよりも「何を<em>する</em>」ためのものなのかを書く方が、後から見返したときにわかりやすくなります。さらに、現在形で書いておけば、Gitコマンド自身によって生成されるコミットメッセージとも時制が整合します。詳細についてはGitHubに投稿された「<a href="https://github.com/blog/926-shiny-new-commit-styles">最新のコミット方法</a> (英語)」を参照してください。</p>

<div class="label" id="sec-git_merge"></div>


<h4><a id="sec-1_3_5_4" href="./beginning.html#sec-git_merge" class="heading">マージ (merge)</a></h4>


<p>ファイルの変更が終わったので、マスターブランチにこの変更を<em>マージ (merge)</em> します。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git checkout master
<span class="go">Switched to branch &#39;master&#39;</span>
<span class="gp">$</span> git merge modify-README
<span class="go">Updating 34f06b7..2c92bef</span>
<span class="go">Fast forward</span>
<span class="go">README.rdoc     |  243 --------------------------------------------------</span>
<span class="go">README.md       |    5 +</span>
<span class="go">2 files changed, 5 insertions(+), 243 deletions(-)</span>
<span class="go">delete mode 100644 README.rdoc</span>
<span class="go">create mode 100644 README.md</span>
</pre></div>
</div>


<p>Gitの出力には<code>34f06b7</code>のような文字列が含まれていることがあります。Gitはこれらをリポジトリの内部処理に使用しています。この文字列は環境の違いにより上記のものと少し異なるかもしれませんが、他の部分はほぼ同じはずです。</p>

<p>変更をマージした後は、<code>git branch -d</code>を実行してトピックブランチを削除すれば終わりです。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git branch -d modify-README
<span class="go">Deleted branch modify-README (was 2c92bef).</span>
</pre></div>
</div>


<p>トピックブランチの削除は必須ではありません。実際、トピックブランチを削除せずにそのままにしておくことはよく行われています。トピックブランチを削除せずに残しておけば、トピックブランチとマスターブランチを交互に行き来して、きりの良い所で変更をマージする事ができます。</p>

<p>上で述べたように、<code>git branch -D</code>でトピックブランチ上の変更を破棄することもできます。</p>

<div class="code"><div class="highlight"><pre><span class="c"># これはあくまで例です。ブランチでミスをした時以外は実行しないでください。</span>
<span class="nv">$ </span>git checkout -b topic-branch
<span class="nv">$ </span>&lt;ブランチをめちゃくちゃにしてみる&gt;
<span class="nv">$ </span>git add .
<span class="nv">$ </span>git commit -a -m <span class="s2">&quot;Major screw up&quot;</span>
<span class="nv">$ </span>git checkout master
<span class="nv">$ </span>git branch -D topic-branch
</pre></div>
</div>


<p><code>-d</code>フラグと異なり、<code>-D</code>フラグは変更をマージしていなくてもブランチを削除してくれます。</p>

<div class="label" id="sec-git_push"></div>


<h4><a id="sec-1_3_5_5" href="./beginning.html#sec-git_push" class="heading">プッシュ (push)</a></h4>


<p><code>README</code>ファイルの更新が終わったので、GitHubに変更をプッシュして結果を見てみましょう。既に<a class="ref" href="./beginning.html#sec-github">1.3.4</a>で一度プッシュを行ったので、大抵のシステムでは<code>git push</code>を実行するときに<code>origin master</code>を省略できます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git push
</pre></div>
</div>


<p>先ほど説明したとおり、Markdownで記述された新しいファイルはGitHubできれいにフォーマットされます (<a class="ref" href="./beginning.html#fig-new_readme">図1.9</a>)。</p>

<div class="label" id="fig-new_readme"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="../images/figures/new_readme_4_0.png" alt="new_readme_4_0" /></span></div><div class="caption"><span class="header">図1.9</span> <span class="description">Markdownを使用してフォーマットされた改良版<code>README</code>ファイル。<a href="../images/figures/new_readme_4_0-full.png">(拡大)</a></span></div></div>




<div class="label" id="sec-deploying"></div>


<h2><a id="sec-1_4" href="./beginning.html#sec-deploying" class="heading"><span class="number">1.4</span>デプロイする</a></h2>


<p>この段階では空っぽのRailsアプリケーションしかありませんが、本番環境にデプロイしてしまいましょう。アプリケーションのデプロイは必須ではありませんが、頻繁にデプロイすることによって、開発サイクルでの問題を早い段階で見つけることができます。開発環境のテストを繰り返すばかりで、いつまでも本番環境にデプロイしないままだと、アプリケーションを公開する時に思わぬ事態に遭遇する可能性が高まります<sup class="footnote" id="fnref-1_20"><a href="./beginning.html#fn-1_20">20</a></sup>。</p>

<p>かつてはRailsアプリのデプロイは大変な作業でしたが、ここ数年急速に簡単になってきており、さまざまな本番環境を選択できるようになりました。<a href="http://www.modrails.com/">Phusion Passenger</a> (ApacheやNginx<sup class="footnote" id="fnref-1_21"><a href="./beginning.html#fn-1_21">21</a></sup>Webサーバー用のモジュール) を実行できるさまざまな共有ホストや仮想プライベートサーバー (VPS) の他に、フルサービスデプロイメントを提供する<a href="http://engineyard.com/">Engine Yard</a>や<a href="http://railsmachine.com/">Rails Machine</a>、クラウドサービスを提供する<a href="http://cloud.engineyard.com">Engine Yard Cloud</a>や<a href="http://heroku.com/">Heroku</a>などがあります。</p>

<p>著者のお気に入りはHerokuで、Railsを含むRuby Webアプリ用のホスティングプラットフォームです。Herokuは、ソースコードのバージョン管理にGitを使用していれば、Railsアプリケーションを簡単に本番環境にデプロイできます (Gitを導入したのは、まさにこのHerokuで使うためでもあります。まだGitをインストールしていない方は<a class="ref" href="./beginning.html#sec-version_control">1.3</a>を参照してください)。この章では、最初のアプリケーションをHerokuにデプロイします。</p>

<div class="label" id="sec-heroku_setup"></div>


<h3><a id="sec-1_4_1" href="./beginning.html#sec-heroku_setup" class="heading"><span class="number">1.4.1</span> Herokuのセットアップ</a></h3>


<p>Herokuでは<a href="http://www.postgresql.org/">PostgreSQL</a>データベースを使用します (ちなみに発音は “post-gres-cue-ell” で、よく“Postgres”と略されます)。そのためには、本番 (production) 環境に<tt>pg</tt> gemをインストールしてRailsがPostgreSQLと通信できるようにします。</p>

<div class="code"><div class="highlight"><pre><span class="n">group</span> <span class="ss">:production</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;pg&#39;</span><span class="p">,</span> <span class="s1">&#39;0.15.1&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;rails_12factor&#39;</span><span class="p">,</span> <span class="s1">&#39;0.0.2&#39;</span>
<span class="k">end</span>
</pre></div>
</div>


<p><tt>rails_12factor</tt> gemが追加されている点にご注目ください。これは画像やスタイルシートなどの静的なアセットを提供するためにHerokuで使用されます。</p>

<p><a class="ref" href="./beginning.html#sec-bundler">1.2.4</a>でも説明したように、アプリケーションが前提としているRubyのバージョンを明示的に指定するのはよい考えです。</p>

<div class="code"><div class="highlight"><pre><span class="n">ruby</span> <span class="s1">&#39;2.0.0&#39;</span>
<span class="c1">#ruby-gemset=railstutorial_rails_4_0</span>
</pre></div>
</div>


<p>(著者の場合、RVMのgemsetも次の行で指定しています。たとえばRuby <code>’1.9.3’</code>を使用しているのであれば、そのバージョン番号に書き換えてください。本書での指定とは若干異なることになりますが、この変更は問題ありません)。上の一連のコードを<a class="ref" href="./beginning.html#code-gemfile_sqlite_version">リスト1.5</a>の<code>Gemfile</code>に適用すると、<a class="ref" href="./beginning.html#code-gemfile_pg_gem">リスト1.9</a>のようになります。</p>

<div class="label" id="code-gemfile_pg_gem"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト1.9</span> <span class="description">Rubyのバージョンを明示的に指定した<code>Gemfile</code>。</span> </div>
<div class="code"><div class="highlight"><pre><span class="n">source</span> <span class="s1">&#39;https://rubygems.org&#39;</span>
<span class="n">ruby</span> <span class="s1">&#39;2.0.0&#39;</span>
<span class="c1">#ruby-gemset=railstutorial_rails_4_0</span>

<span class="n">gem</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="s1">&#39;4.0.2&#39;</span>

<span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;sqlite3&#39;</span><span class="p">,</span> <span class="s1">&#39;1.3.8&#39;</span>
<span class="k">end</span>

<span class="n">gem</span> <span class="s1">&#39;sass-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;4.0.1&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;uglifier&#39;</span><span class="p">,</span> <span class="s1">&#39;2.1.1&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;coffee-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;4.0.1&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;jquery-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.0.4&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;turbolinks&#39;</span><span class="p">,</span> <span class="s1">&#39;1.1.1&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;jbuilder&#39;</span><span class="p">,</span> <span class="s1">&#39;1.0.2&#39;</span>

<span class="n">group</span> <span class="ss">:doc</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;sdoc&#39;</span><span class="p">,</span> <span class="s1">&#39;0.3.20&#39;</span><span class="p">,</span> <span class="nb">require</span><span class="p">:</span> <span class="kp">false</span>
<span class="k">end</span>

<span class="n">group</span> <span class="ss">:production</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;pg&#39;</span><span class="p">,</span> <span class="s1">&#39;0.15.1&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;rails_12factor&#39;</span><span class="p">,</span> <span class="s1">&#39;0.0.2&#39;</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>インストールの際には、<code>bundle install</code>に特殊なフラグを追加します。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle install --without production
</pre></div>
</div>


<p><tt class="verb">--without production</tt>オプションを追加すると、 本番用のgem (この場合は<tt>pg</tt>と<tt>rails_12factor</tt>) はローカルの環境にはインストールされません (Bundlerで<tt>readline</tt>エラーが発生した場合は、<code>Gemfile</code>に<code>gem ’rb-readline’</code>を追加してください)。上で追加したgemは本番環境のみで使用するためのものなので、このコマンドを今実行してもgemはローカルに追加されません。このコマンドを実行するのは、後の本番環境に備えて<code>Gemfile.lock</code>を更新し、<tt>pg</tt> gemと<tt>rails_12factor</tt> gem、Rubyバージョンの指定を含めておく必要があるためです。以下を実行して変更をコミットできます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git commit -a -m <span class="s2">&quot;Update Gemfile.lock for Heroku&quot;</span>
</pre></div>
</div>


<p>次にHerokuのアカウントを新規作成して設定します。最初に<a href="http://api.heroku.com/signup">Herokuのユーザー登録</a>を行います。アカウント作成後に完了通知メールが届いたら、<a href="https://toolbelt.heroku.com/">Heroku Toolbelt</a>を使用して必要なHerokuソフトウェアをインストールします<sup class="footnote" id="fnref-1_22"><a href="./beginning.html#fn-1_22">22</a></sup>。次にターミナルで以下の<code>heroku</code>コマンドを実行します (実行前にターミナルの終了と再起動が必要なことがあります)。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> heroku login
</pre></div>
</div>


<p>最後に、元のRailsプロジェクトディレクトリに移動し、<code>heroku</code>コマンドを実行して、Herokuサーバー上にサンプルアプリケーション用の場所を作成します (<a class="ref" href="./beginning.html#code-heroku_create">リスト1.10</a>)。</p>

<div class="label" id="code-heroku_create"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト1.10</span> <span class="description">Herokuに新しいアプリケーションを作成する。</span> </div>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="nb">cd</span> ~/rails_projects/first_app
<span class="gp">$</span> heroku create
<span class="go">Created http://stormy-cloud-5881.herokuapp.com/ |</span>
<span class="go">git@heroku.com:stormy-cloud-5881.herokuapp.com</span>
<span class="go">Git remote heroku added</span>
</pre></div>
</div></div>


<p>この<code>heroku</code>コマンドを実行すると、Railsアプリケーション専用のサブドメインが作成され、ただちにブラウザで表示可能になります。今はまだ何もありませんが、すぐにデプロイしてWebページを表示させましょう。</p>

<div class="label" id="sec-heroku_step_one"></div>


<h3><a id="sec-1_4_2" href="./beginning.html#sec-heroku_step_one" class="heading"><span class="number">1.4.2</span> Herokuにデプロイする (1)</a></h3>


<p>Railsアプリケーションを実際にHerokuにデプロイするには、まずGitを使用してHerokuにリポジトリをプッシュします。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git push heroku master
</pre></div>
</div>


<h3><a id="sec-1_4_3" href="./beginning.html#sec-1_4_3" class="heading"><span class="number">1.4.3</span> Herokuにデプロイする (2)</a></h3>


<p>失礼、その2はありません。これで終わりです (<a class="ref" href="./beginning.html#fig-heroku_app">図1.10</a>)。デプロイされたアプリケーションの表示は、<code>heroku create</code> (<a class="ref" href="./beginning.html#code-heroku_create">リスト1.10</a>) を実行した際に生成されたアドレスをブラウザで開くだけです (もちろんここに出てくる著者のアドレスではなく、自分が登録したアドレスを使ってください)。<code>heroku</code>コマンドに以下の引数を与えるだけで、正しいアドレスでブラウザが起動します。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> heroku open
</pre></div>
</div>


<p>残念ながら、Rails 4.0では技術的な理由により以下のエラーページが表示されます。Rails 4.0のデフォルトページはHerokuでは表示できません。サンプルアプリケーションの一環として、<a class="ref" href="./filling-in-the-layout.html#sec-rails_routes">5.3.2</a>でルートへのルーティングを追加すればこのエラーは解消しますのでご安心ください。</p>

<div class="label" id="fig-heroku_app"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="../images/figures/heroku_app_4_0.png" alt="heroku_app_4_0" /></span></div><div class="caption"><span class="header">図1.10</span><span class="description">Heroku上で動作しているRailsチュートリアルの最初のアプリケーション。<a href="../images/figures/heroku_app_4_0-full.png">(拡大)</a></span></div></div>


<p>Herokuへのデプロイが完了した後は、以下のような美しいユーザーインターフェイスを使用してアプリケーションの管理と設定を行えます (<a class="ref" href="./beginning.html#fig-heroku_info">図1.11</a>)。</p>

<div class="label" id="fig-heroku_info"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="../images/figures/heroku_info_4_0.png" alt="heroku_info_4_0" /></span></div><div class="caption"><span class="header">図1.11</span><span class="description">見事なHerokuのインターフェイス。<a href="../images/figures/heroku_info_4_0-full.png">(拡大)</a></span></div></div>




<div class="label" id="sec-heroku_commands"></div>


<h3><a id="sec-1_4_4" href="./beginning.html#sec-heroku_commands" class="heading"><span class="number">1.4.4</span>Herokuコマンド</a></h3>


<p><a href="http://devcenter.heroku.com/heroku-command">Herokuのコマンド</a>はたくさんあるので、ここでは簡単に触れる程度にとどめますが、少しだけ使ってみましょう。アプリケーションの名前を変更してみます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> heroku rename railstutorial
</pre></div>
</div>


<p>注意: この名前は、著者のサンプルアプリケーションで既に使用していますので、他の名前を使用してください。実際は、Herokuで生成されたデフォルトのアドレスでも十分です。本当にアプリケーションの名前を変えてみたい場合は、次のようなランダムなサブドメイン名を設定し、この章の冒頭で説明したアプリケーションのセキュリティを実装してみる方法もあります。</p>

<pre class="verbatim">hwpcbmze.herokuapp.com
seyjhflo.herokuapp.com
jhyicevg.herokuapp.com</pre>


<p>このようなでたらめのサブドメイン名なら、アドレスを渡さない限りサイトがアクセスされる心配もありません。(ちなみに、Rubyの威力の一端をお見せするために、ランダムなサブドメイン名を生成するためのコンパクトなコードを以下に記します。</p>

<div class="code"><div class="highlight"><pre><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="o">.</span><span class="n">.</span><span class="s1">&#39;z&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span><span class="o">.</span><span class="n">shuffle</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">7</span><span class="o">].</span><span class="n">join</span>
</pre></div>
</div>


<p>最高ですね。)</p>

<p>Herokuでは、サブドメインの他に独自ドメインも使用できます (実を言うと、この<a href="http://railstutorial.jp">Ruby on RailsチュートリアルWebサイト</a>もHeroku上に置かれています。本書をオンラインで読んでいるのであれば、まさにHerokuにホスティングされたWebサイトを見ているということになります)。カスタムドメインや他のHeroku関連の情報については、<a href="http://devcenter.heroku.com/">Herokuドキュメント</a>を参照してください。</p>

<div class="label" id="sec-beginning_conclusion"></div>


<h2><a id="sec-1_5" href="./beginning.html#sec-beginning_conclusion" class="heading"><span class="number">1.5</span>最後に</a></h2>


<p>この章ではインストール、開発環境の設定、バージョン管理、本番環境へのデプロイなど、多くの課題を達成しました。ここまでの進捗をTwitterに投稿したりFacebookで通知するには以下のリンクからどうぞ。</p>

<div class="center"><a href="http://twitter.com/?status=RailsチュートリアルでRuby on Railsを学習中!%20http://railstutorial.jp/%20via%20@railstutorialjp">RailsチュートリアルでRuby on Railsを学習中! http://railstutorial.jp/</a></div>


<p> </p>

<p>後はRailsを実際に勉強するだけです。一緒に頑張りましょう。</p>

<div class="navigation">  <a class="next_page" href="./a-demo-app.html#top">
</a><a class="next_page" href="./a-demo-app.html#top">    <span class="number">第2章</span>デモアプリケーション»</a><a class="next_page" href="./a-demo-app.html#top">  </a>

<a class="prev_page" href="/"></a>
<a class="prev_page" href="/">
  <span class="number">トップページ</span></a>
<a class="prev_page" href="/">  </a>

</div><div class="footnotes">
<ol>
<li id="fn-1_1"><em>URI</em>はUniform Resource Identifierの略です。それよりやや一般性の低い<em>URL</em>はUniform Resource Locatorの略です。URIは、要するに「ブラウザのアドレスバーにあるあれ」と考えればだいたい合っています。<a class="arrow" href="./beginning.html#fnref-1_1">↑</a></li>
<li id="fn-1_2">http://tryruby.org/ <a class="arrow" href="./beginning.html#fnref-1_2">↑</a></li>
<li id="fn-1_3">http://railsforzombies.org/ <a class="arrow" href="./beginning.html#fnref-1_3">↑</a></li>
<li id="fn-1_4">http://railstutorial.org/screencasts <a class="arrow" href="./beginning.html#fnref-1_4">↑</a></li>
<li id="fn-1_5"><em>Railsチュートリアル</em>を読んでいて、チュートリアル内部の別セクション番号へのリンクをクリックして移動したら、なるべくすぐに元の場所に戻ることをお勧めします。Webページで読んでいる場合は、ブラウザの [戻る] ボタンで戻れます。Adobe ReaderやOS XのプレビューでPDF版を読んでいる場合でも、同様に戻る方法があります。Adobe Readerの場合は、ドキュメント画面を右クリックして [Previous View]をクリックします。OS X Previewの場合はメニューの <tt>[移動] &gt; [戻る]</tt> で戻れます。<a class="arrow" href="./beginning.html#fnref-1_5">↑</a></li>
<li id="fn-1_6"><code>sudo</code>コマンドを実行するとデフォルトでroot (スーパーユーザー) に切り替わるためか、多くの人がsudoコマンドを &quot;superuser do&quot; の略だと誤って信じています。正しくは、<code>sudo</code>は<code>su</code>コマンドと英語の “do” をつなげたものです。そして<code>su</code>コマンドは “substitute user” (ユーザーの切替) の略なのです。ターミナルで<code>man su</code>と入力すればこのことを確認できます。語源学の示すところによれば “SOO-doo” と発音しますが (“do” は “doo” と発音するので)、“SOO-doh” という発音もよく使われます。<a class="arrow" href="./beginning.html#fnref-1_6">↑</a></li>
<li id="fn-1_7">http://railstutorial.jp/help <a class="arrow" href="./beginning.html#fnref-1_7">↑</a></li>
<li id="fn-1_8">https://github.com/perfectionist/sample_project/wiki <a class="arrow" href="./beginning.html#fnref-1_8">↑</a></li>
<li id="fn-1_9">本書執筆時点では、<a href="http://www.sublimetext.com/3">Sublime Text 3</a>はベータ版どまりです。最新のSublime Textは、新しもの好きの方以外にはお勧めしません。<a class="arrow" href="./beginning.html#fnref-1_9">↑</a></li>
<li id="fn-1_10">viは、Unixで古くから使用されているコマンドベースの強力なエディタです。Vimは &quot;vi improved&quot; の略です。<a class="arrow" href="./beginning.html#fnref-1_10">↑</a></li>
<li id="fn-1_11">https://github.com/mhartl/rails_tutorial_sublime_text <a class="arrow" href="./beginning.html#fnref-1_11">↑</a></li>
<li id="fn-1_12">https://developer.apple.com/downloads/ <a class="arrow" href="./beginning.html#fnref-1_12">↑</a></li>
<li id="fn-1_13">http://strandcode.com/2013/07/11/ruby-version-manager-rvm-overview-for-rails-newbs/ <a class="arrow" href="./beginning.html#fnref-1_13">↑</a></li>
<li id="fn-1_14">この手順が必要となるのは、Rails gemのバージョンを変更した場合に限られます。おそらくRailsインストーラを使用している場合にしかこういうことは起こらないでしょう。他の場合にこの手順を実行しても大丈夫です。<a class="arrow" href="./beginning.html#fnref-1_14">↑</a></li>
<li id="fn-1_15">通常、Webサイトは80番ポートで受信待ちしますが、このポートを使用するには特別な権限が必要になることが多いので、Railsの開発用サーバーでは制限の少ない、番号の大きいポート (いわゆるハイナンバーポート) を使用します。<a class="arrow" href="./beginning.html#fnref-1_15">↑</a></li>
<li id="fn-1_16">GUIエディタの起動後もターミナルを使用し続けることはできます。ただし、Gitはデタッチ時にコミットメッセージが空のままファイルを閉じたとみなすため、コミットは中断されます。Gitのエディタオプションで<code>subl</code>や<code>gvim</code>にフラグを付けないと、このあたりの動作で頭が混乱するかもしれません (訳注: gitのエディタ設定はGUIエディタとあまり相性がよくないらしく、vimやnanoのようなコマンドベースのエディタを選択するのが無難なようです)。この注釈の意味がよくわからない場合は、無視しても構いません。<a class="arrow" href="./beginning.html#fnref-1_16">↑</a></li>
<li id="fn-1_17"><code>.gitignore</code>がディレクトリに見当たらない場合は、ファイルブラウザやエクスプローラで隠しファイルを表示するよう設定を変更する必要があるかもしれません。<a class="arrow" href="./beginning.html#fnref-1_17">↑</a></li>
<li id="fn-1_18"><code>git status</code>を実行したときに表示して欲しくないファイルがあれば、それらのファイルを<a class="ref" href="./beginning.html#code-gitignore">1.7</a>の<code>.gitignore</code>ファイルに追加してください。<a class="arrow" href="./beginning.html#fnref-1_18">↑</a></li>
<li id="fn-1_19">詳細については<a href="http://progit.org/book/ch3-0.html"><em>Pro Git</em>の「Gitのブランチ機能」</a>を参照してください。<a class="arrow" href="./beginning.html#fnref-1_19">↑</a></li>
<li id="fn-1_20"><em>Railsチュートリアル</em>のサンプルアプリケーションでは気にする必要はありません。作りかけの恥ずかしいWebアプリケーションをネットにうっかり公開してしまわないだろうかと心配する方もいらっしゃるかと思いますが、それを防ぐための方法はいくつもありますのでご安心ください。<a class="ref" href="./beginning.html#sec-heroku_commands">1.4.4</a>はその方法の1つです。<a class="arrow" href="./beginning.html#fnref-1_20">↑</a></li>
<li id="fn-1_21">“Engine X&quot; と発音します。<a class="arrow" href="./beginning.html#fnref-1_21">↑</a></li>
<li id="fn-1_22">https://toolbelt.heroku.com/ <a class="arrow" href="./beginning.html#fnref-1_22">↑</a></li>
</ol>
</div>




    </div>
  </body>
</html>
