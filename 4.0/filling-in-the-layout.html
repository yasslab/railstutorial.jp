<html dir="ltr">
  <head>
    <title>Ruby on Rails チュートリアル</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="../stylesheets/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../stylesheets/polytexnic.css" type="text/css" />
  </head>
  <body dir="ltr">
    <div id="book">

<div id="top"></div>


<h1 class="chapter"><a id="sec-5" href="./filling-in-the-layout.html#top" class="heading"><span class="number">第5章</span>レイアウトを作成する</a></h1>


<p><a class="ref" href="./rails-flavored-ruby.html#top">第4章</a>の簡単なRubyツアーの中で、サンプルアプリケーションにアプリケーションスタイルシートを含める方法を学びました。しかし、<a class="ref" href="./rails-flavored-ruby.html#sec-css_revisited">4.3.4</a>で指摘したとおり、このスタイルシートは空のままです。この章では、アプリケーションに<em>Bootstrap</em>フレームワークを組み込み、そして、カスタムスタイルを追加します<sup class="footnote" id="fnref-5_1"><a href="./filling-in-the-layout.html#fn-5_1">1</a></sup>。また<a class="ref" href="./filling-in-the-layout.html#sec-structure">5.1</a>までに、作成するページ (HomeやAboutなど) へのリンクをレイアウトに追加します。その途中で、パーシャル、Railsのルーティング、Asset Pipelineについて学び、さらにSassについても紹介します(<a class="ref" href="./filling-in-the-layout.html#sec-sass_and_the_asset_pipeline">5.2</a>)。 また、<a class="ref" href="./static-pages.html#top">第3章</a> で作成したテストを、最新のRSpecテクニックを用いてリファクタリングします。章の最後に、ユーザーをサイトにログインさせるための重要な一歩を踏み出します。</p>

<div class="label" id="sec-structure"></div>


<h2><a id="sec-5_1" href="./filling-in-the-layout.html#sec-structure" class="heading"><span class="number">5.1</span>構造を追加する</a></h2>


<p><em>Railsチュートリアル</em>はWeb開発のための本であり、Webデザインの本ではありませんが、だからといって<em>何のスタイルもない</em>寒々しい外観のアプリケーションでいつまでも作業を続けていると憂鬱になってしまいます。そこで、この章ではレイアウトにいくつかの構造とCSSを与えて最小限のスタイルを追加します。カスタムCSSルールの他に、Twitter社によるオープンソースのWebデザインフレームワークである<a href="http://getbootstrap.com/2.3.2/">Bootstrap</a>を利用します。また、<em>コード</em>そのものにもスタイルを与えます。つまり、散らかりはじめたコードレイアウトを<em>パーシャル</em>を使用して整えるということです。</p>

<p>Webアプリケーションを作成するときに、ユーザーインターフェイスの概要をできるだけ早いうちに把握しておくことがしばしば有用です。本書の残りでは、<em>モックアップ</em> (Webの文脈ではよく <em>ワイヤーフレーム</em>と呼ばれます) という、最終的なアプリケーションの外観を示す一種のラフスケッチを使用することにします<sup class="footnote" id="fnref-5_2"><a href="./filling-in-the-layout.html#fn-5_2">2</a></sup>。この章では、 主に<a class="ref" href="./static-pages.html#sec-static_pages">3.1</a>で紹介したサイトロゴ、ナビゲーションヘッダー、サイトフッターを含む静的ページを開発します。これらのページの中で最も重要な、Homeページのモックアップを<a class="ref" href="./filling-in-the-layout.html#fig-home_page_mockup">図5.1</a>に示します。モックアップに基いて作成した最終結果は<a class="ref" href="./filling-in-the-layout.html#fig-site_with_footer">図5.7</a>で確認することができます。両者を見比べると、細部が若干異なることに気が付くでしょう (たとえば、実際には最後にRailsのロゴをページに追加します)。しかしモックアップは正確である必要はありませんので、これで十分です。</p>

<div class="label" id="fig-home_page_mockup"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="../images/figures/home_page_mockup_bootstrap.png" alt="home_page_mockup_bootstrap" /></span></div><div class="caption"><span class="header">図5.1</span><span class="description">サンプルアプリケーションのHomeページのモックアップ。<a href="../images/figures/home_page_mockup_bootstrap-full.png">(拡大)</a></span></div></div>


<p>Gitでバージョン管理をしているのであれば、これまでと同様、この時点で新しいブランチを作成するのがよいでしょう。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git checkout -b filling-in-layout
</pre></div>
</div>


<div class="label" id="sec-adding_to_the_layout"></div>


<h3><a id="sec-5_1_1" href="./filling-in-the-layout.html#sec-adding_to_the_layout" class="heading"><span class="number">5.1.1</span>ナビゲーション</a></h3>


<p>第一段階として、サンプルアプリケーションにリンクとスタイルを追加するために、サイトのレイアウトファイル<code>application.html.erb</code> (<a class="ref" href="./rails-flavored-ruby.html#code-application_layout_full_title">リスト4.3</a>で登場) にHTML構造を追加し、レイアウトファイルを更新します。この更新には、領域 (divタグ) の追加、CSSクラスの追加、サイトナビゲーションの起点となる領域の追加も含まれます。完全なファイルを<a class="ref" href="./filling-in-the-layout.html#code-layout_new_structure">リスト5.1</a>に示します。続いて、これを構成している多くの部品について解説します。表示結果を今すぐ確認したいのであれば、<a class="ref" href="./filling-in-the-layout.html#fig-layout_no_logo_or_custom_css">図5.2</a>で確認できます (<em>注:</em>この時点ではわざわざ見に行くほどの仕上がりではありませんが)。</p>

<div class="label" id="code-layout_new_structure"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.1</span> <span class="description">構造を追加したWebサイトのレイアウト。</span><br /><span class="description"> <code>app/views/layouts/application.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!</span><span class="cp">DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span><span class="cp">&lt;%=</span> <span class="n">full_title</span><span class="p">(</span><span class="k">yield</span><span class="p">(</span><span class="ss">:title</span><span class="p">))</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span> <span class="s2">&quot;application&quot;</span><span class="p">,</span> <span class="ss">media:</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
                                           <span class="s2">&quot;data-turbolinks-track&quot;</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s2">&quot;application&quot;</span><span class="p">,</span> <span class="s2">&quot;data-turbolinks-track&quot;</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">csrf_meta_tags</span> <span class="cp">%&gt;</span>
    <span class="c">&lt;!--[if lt IE 9]&gt;</span>
<span class="c">    &lt;script src=&quot;http://html5shim.googlecode.com/svn/trunk/html5.js&quot;&gt;&lt;/script&gt;</span>
<span class="c">    &lt;![endif]</span><span class="c">--&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;header</span> <span class="na">class=</span><span class="s">&quot;navbar navbar-fixed-top navbar-inverse&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar-inner&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
          <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;sample app&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="s2">&quot;logo&quot;</span> <span class="cp">%&gt;</span>
          <span class="nt">&lt;nav&gt;</span>
            <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;nav pull-right&quot;</span><span class="nt">&gt;</span>
              <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Home&quot;</span><span class="p">,</span>    <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
              <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Help&quot;</span><span class="p">,</span>    <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
              <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Sign in&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
            <span class="nt">&lt;/ul&gt;</span>
          <span class="nt">&lt;/nav&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/header&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p>それでは、<a class="ref" href="./filling-in-the-layout.html#code-layout_new_structure">リスト5.1</a>の新しい要素を上から順に見ていきましょう。<a class="ref" href="./static-pages.html#sec-passing_title_tests">3.3.2</a>でも簡単に説明しましたが、Rails 4はデフォルトでHTML5を使用します (<code>&lt;!DOCTYPE html&gt;</code>というdoctypeでそのことが示されています)。HTML5は比較的新しく、一部のブラウザ (特に旧式のInternet Explorer) ではHTML5のサポートが不完全であるため、以下のようなJavaScriptコード (通称 “<a href="https://github.com/afarkas/html5shiv/">HTML5 shim</a>”) を使用してこの問題を回避します。</p>

<div class="code"><div class="highlight"><pre><span class="c">&lt;!--[if lt IE 9]&gt;</span>
<span class="c">&lt;script src=&quot;http://html5shim.googlecode.com/svn/trunk/html5.js&quot;&gt;&lt;/script&gt;</span>
<span class="c">&lt;![endif]</span><span class="c">--&gt;</span>
</pre></div>
</div>


<p>上のコードには、以下のような奇妙な構文が含まれています。</p>

<div class="code"><div class="highlight"><pre><span class="c">&lt;!--[if lt IE 9]&gt;</span>
</pre></div>
</div>


<p>これは、Microsoft Internet Explorer (IE) のバージョンが9より小さい場合 (<code>if lt IE 9</code>) にのみ、囲まれている行を実行します。この風変わりな文法<code> [if lt IE 9]</code> は、Railsの一部<em>ではありません</em>。これは実は、<a href="http://ja.wikipedia.org/wiki/%E6%9D%A1%E4%BB%B6%E4%BB%98%E3%81%8D%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88">条件付きコメント</a>と呼ばれるもので、今回のような状況のためにInternet Explorerで特別にサポートされています。これにより、Firefox、Chrome、Safariなどの他のブラウザに影響を与えずに、IEのバージョンが9未満の場合に<em>のみ</em>HTML5 shimをインクルードすることができるため、非常に好都合です。</p>

<p>それに続くセクションには、サイトのロゴを表示する<code>header</code>、(<code>div</code>タグによる) いくつかの領域、ナビゲーションリンクのリストがあります。</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;header</span> <span class="na">class=</span><span class="s">&quot;navbar navbar-fixed-top navbar-inverse&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar-inner&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;sample app&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="s2">&quot;logo&quot;</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;nav&gt;</span>
        <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;nav pull-right&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Home&quot;</span><span class="p">,</span>    <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
          <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Help&quot;</span><span class="p">,</span>    <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
          <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Sign in&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
      <span class="nt">&lt;/nav&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/header&gt;</span>
</pre></div>
</div>


<p><code>header</code>タグは、ページのトップに来るべき要素を表します。この<code>header</code>タグには、<code>navbar</code>、<code>navbar-fixed-top</code>、<code>navbar-inverse</code>という3つの<em>CSSクラス</em><sup class="footnote" id="fnref-5_3"><a href="./filling-in-the-layout.html#fn-5_3">3</a></sup>がスペース区切りで与えられています。</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;header</span> <span class="na">class=</span><span class="s">&quot;navbar navbar-fixed-top navbar-inverse&quot;</span><span class="nt">&gt;</span>
</pre></div>
</div>


<p>すべてのHTML要素には、クラスと<em>id</em>の両方を指定することができます。これらは単なるラベルで、CSSでスタイルを指定するときに便利です (<a class="ref" href="./filling-in-the-layout.html#sec-custom_css">5.1.2</a>)。クラスとIDの主な違いは、クラスはページの中で何度でも使用できるのに対し、IDは一度しか使用することができない点です。今回の場合、すべてのnavbarクラスには、<a class="ref" href="./filling-in-the-layout.html#sec-custom_css">5.1.2</a>でインストールするBootstrapフレームワークによって特別な意味が与えられます。</p>

<p><code>header</code>タグの内側には2つの<code>div</code>タグがあります。</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar-inner&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
</pre></div>
</div>


<p><code>div</code>タグは一般的な表示領域を表し、ドキュメントを別々のパーツに分ける以外のことはしません。古いスタイルのHTMLでは、<code>div</code>タグはサイトのほぼすべての領域に使用されますが、HTML5では多くのアプリケーションに共通の領域で使用する<code>header</code>要素、<code>nav</code>要素、<code>section</code>要素が追加されています。この場合、それぞれの<code>div</code>にはCSSクラスが与えられています。<code>header</code>タグのクラスと同様に、これらのクラスもBootstrapにおいて特別な意味を持っています。</p>

<p>divに続いて、埋め込みRubyコードが出現します。</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;sample app&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="s2">&quot;logo&quot;</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;nav&gt;</span>
  <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;nav pull-right&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Home&quot;</span><span class="p">,</span>    <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Help&quot;</span><span class="p">,</span>    <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Sign in&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/nav&gt;</span>
</pre></div>
</div>


<p>上のコードでは、リンク (<a class="ref" href="./static-pages.html#sec-passing_title_tests">3.3.2</a>で、アンカータグ<code>a</code>を使用して作成) を生成するために、Railsヘルパーの<code>link_to</code>を使用しています。<code>link_to</code>の第1引数はリンクテキスト、第2引数はURLです。このURIは<a class="ref" href="./filling-in-the-layout.html#sec-named_routes">5.3.3</a>で<em>名前付きルート</em>のURIに変更しますが、今はWebデザインで一般に使用されるスタブURL <code>’#’</code>にしておきます。第3引数はオプションハッシュで、この場合はサンプルアプリのリンクでCSSのid <code>logo</code>を指定しています (他の3つのリンクにはオプションハッシュが指定されていませんが、必須ではないので構いません)。Railsヘルパーは、このようにオプションのハッシュを取ることがよくあり、これによりRailsのコードから離れることなく任意のHTMLオプションを柔軟に追加することができます。</p>

<p>divの内側の2番目の要素は、<em>リストアイテム</em>タグ<code>li</code>と<em>順不同リスト</em>タグ<code>ul</code>によって作られた、ナビゲーションリンクのリストです。</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;nav&gt;</span>
  <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;nav pull-right&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Home&quot;</span><span class="p">,</span>    <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Help&quot;</span><span class="p">,</span>    <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Sign in&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/nav&gt;</span>
</pre></div>
</div>


<p>正式にはここでは不要ですが、<code>nav</code>タグはその内側がナビゲーションリンクであるという意図を伝える役割があります。<code>ul</code>タグの<code>nav</code>と<code>pull-right</code>クラスは、Bootstrapにおいて特別な意味を持ちます。Railsがこのレイアウトを処理し、埋め込みRubyを評価すると、上のリストは以下に置き換わります。</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;nav&gt;</span>
  <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;nav pull-right&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span><span class="nt">&gt;</span>Home<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span><span class="nt">&gt;</span>Help<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span><span class="nt">&gt;</span>Sign in<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/nav&gt;</span>
</pre></div>
</div>


<p>レイアウトの最後の部分は、メインコンテンツ用の<code>div</code>です。</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
  <span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>


<p>上と同様、<code>container</code>クラスもBootstrapにおいて特別な意味を持ちます。<a class="ref" href="./static-pages.html#sec-layouts">3.3.4</a>で学んだように、<code>yield</code>メソッドはWebサイトのレイアウトにページごとの内容を挿入します。</p>

<p><a class="ref" href="./filling-in-the-layout.html#sec-partials">5.1.3</a>で追加するサイトフッターを除いて、これでレイアウトは完成しました。Homeページへアクセスして表示結果を確認することができます。今後登場するスタイル要素を利用できるようにするために、<code>home.html.erb</code>ビューに特別な要素をいくつか追加します(<a class="ref" href="./filling-in-the-layout.html#code-signup_button">リスト5.2</a>)。</p>

<div class="label" id="code-signup_button"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.2</span> <span class="description">ログインページへのリンクがあるHomeページ。</span><br /><span class="description"> <code>app/views/static_pages/home.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;center hero-unit&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;h1&gt;</span>Welcome to the Sample App<span class="nt">&lt;/h1&gt;</span>

  <span class="nt">&lt;h2&gt;</span>
    This is the home page for the
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.jp/&quot;</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
    sample application.
  <span class="nt">&lt;/h2&gt;</span>

  <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Sign up now!&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="ss">class:</span> <span class="s2">&quot;btn btn-large btn-primary&quot;</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">image_tag</span><span class="p">(</span><span class="s2">&quot;rails.png&quot;</span><span class="p">,</span> <span class="ss">alt:</span> <span class="s2">&quot;Rails&quot;</span><span class="p">),</span> <span class="s1">&#39;http://rubyonrails.org/&#39;</span> <span class="cp">%&gt;</span>
</pre></div>
</div></div>


<p><a class="ref" href="./sign-up.html#top">第7章</a>でサイトにユーザーを追加するときに備えて、最初の<code>link_to</code>に仮のリンクを作成します。</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span> <span class="na">class=</span><span class="s">&quot;btn btn-large btn-primary&quot;</span><span class="nt">&gt;</span>Sign up now!<span class="nt">&lt;/a&gt;</span>
</pre></div>
</div>


<p><code>div</code>タグのCSSクラス<code>hero-unit</code>は、signupボタンの<code>btn</code>クラス、<code>btn-large</code>クラス、<code>btn-primary</code>クラスと同様、Bootstrapにおいて特別な意味を持ちます。</p>

<p>2番目の<code>link_to</code>では、引数として画像ファイルのパスと任意のオプションハッシュをとる<code>image_tag</code>ヘルパーの能力が示されています。シンボルを使用して、この場合は<code>alt</code>属性を設定しています。わかりやすくするために、このタグによって生成されるHTMLを以下に示します<sup class="footnote" id="fnref-5_4"><a href="./filling-in-the-layout.html#fn-5_4">4</a></sup>。</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;img</span> <span class="na">alt=</span><span class="s">&quot;Rails&quot;</span> <span class="na">src=</span><span class="s">&quot;/assets/rails.png&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>


<p><code>alt</code>属性は、画像がない場合に代わりに表示される文字列です。また、視覚障害のあるユーザーが使用するスクリーンリーダーでは、この属性が読み上げられてそこに画像があることが示されます。HTML標準では実際に要求されているにも関わらず、画像に<code>alt</code>属性を付けていない手抜きのWebサイトをときどき見かけます。Railsでは幸いにも、この属性を指定せずに<code>image_tag</code>を呼び出した場合は、画像ファイル名 (拡張子を除く) をデフォルトの<code>alt</code>属性として自動的に付加してくれます。なお、今回は (先頭が大文字の) &quot;Rails&quot;とするために<code>alt</code>テキストを明示的に設定しています。</p>

<p>注: 以前のバージョンのRailsでは、<code>rails.png</code>というロゴマークが自動的にすべてのRailsプロジェクトにインストールしていましたが、最新バージョンのRailsでは<code>rails new</code>による生成時にこのロゴマークを含めなくなりました。このロゴマークが必要な方は、Ruby on Rails公式ページ (<a href="http://rubyonrails.org/images/rails.png">http://rubyonrails.org/images/rails.png</a>) からダウンロードして<code>app/assets/images/</code>ディレクトリにおいてください (<code>mkdir</code>コマンドやGUIベースのファイルマネージャを使用してこのディレクトリを作成する必要があることもあります)。<a class="ref" href="./filling-in-the-layout.html#code-signup_button">リスト5.2</a>に<code>image_tag</code>ヘルパーを含めてあるので、RailsはAsset Pipeline (<a class="ref" href="./filling-in-the-layout.html#sec-sass_and_the_asset_pipeline">5.2</a>) を使用して、このディレクトリにあるすべての画像を自動的に見つけます。</p>

<p>いよいよ、ここまでの苦労の成果を確認する準備ができました (<a class="ref" href="./filling-in-the-layout.html#fig-layout_no_logo_or_custom_css">図5.2</a>)。思っていたよりもみすぼらしいでしょうか。そうかもしれません。しかし、HTML要素に実用的なクラスを与えるという良い仕事ができたのも確かです。さらに、クラスを与えたこの段階で、CSSを使用してサイトにスタイルを与えることができたのは、タイミングとして非常に適切であると思います。</p>

<div class="label" id="fig-layout_no_logo_or_custom_css"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="../images/figures/layout_no_logo_or_custom_css_bootstrap_rails_4.png" alt="layout_no_logo_or_custom_css_bootstrap_rails_4" /></span></div><div class="caption"><span class="header">図5.2</span>カスタムCSSを使用していない<span class="description">Homeページ (<a href="http://localhost:3000/static_pages/home">/static_pages/home</a>)。<a href="../images/figures/layout_no_logo_or_custom_css_bootstrap_rails_4-full.png">(拡大)</a></span></div></div>




<div class="label" id="sec-custom_css"></div>


<h3><a id="sec-5_1_2" href="./filling-in-the-layout.html#sec-custom_css" class="heading"><span class="number">5.1.2</span>BootstrapとカスタムCSS</a></h3>


<p><a class="ref" href="./filling-in-the-layout.html#sec-adding_to_the_layout">5.1.1</a>では、多くのHTML要素にCSSクラスを関連付けました。こうしておくことで、CSSベースでレイアウトを構成する際に高い柔軟性を与えてくれます。<a class="ref" href="./filling-in-the-layout.html#sec-adding_to_the_layout">5.1.1</a>で述べたように、これらのクラスの多くは、Twitterが作成したフレームワークである<a href="http://getbootstrap.com/2.3.2/">Bootstrap</a>特有のものです。Bootstrapを使用すると、洗練されたWebデザインとユーザーインターフェイス要素を簡単にHTML5アプリケーションに追加することができます。このセクションでは、サンプルアプリケーションにスタイルを追加するために、カスタムCSSルールとBootstrapを組み合わせます。
</p>

<p>最初に、<a class="ref" href="./filling-in-the-layout.html#code-bootstrap_sass">リスト5.3</a>で示しているようにBootstrapを追加しましょう。これは、<tt>bootstrap-sass</tt> gemを使用してRailsアプリケーションに導入できます (バージョンの不一致によるエラーを直すために、<a class="ref" href="./filling-in-the-layout.html#code-bootstrap_sass">リスト5.3</a>ではSprocketsのバージョンも固定しています。Sprocketsは、<a class="ref" href="./filling-in-the-layout.html#sec-sass_and_the_asset_pipeline">5.2</a>で紹介するアセットパイプラインの一部の機能です)。Bootstrapフレームワークでは、動的なスタイルシートを生成するために<a href="http://lesscss.org/">LESS CSS</a>言語を使用していますが、RailsのAsset Pipelineはデフォルトでは (LESSと非常によく似た) Sass言語をサポートします (<a class="ref" href="./filling-in-the-layout.html#sec-sass_and_the_asset_pipeline">5.2</a>)。そのため、<tt>bootstrap-sass</tt>は、LESSをSassへ変換し、必要なBootstrapファイルを現在のアプリケーションですべて利用できるようにします<sup class="footnote" id="fnref-5_5"><a href="./filling-in-the-layout.html#fn-5_5">5</a></sup>。</p>

<div class="label" id="code-bootstrap_sass"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.3</span> <span class="description"><tt>Gemfile</tt>へ<code>bootstrap-sass</code>を追加する。</span> </div>
<div class="code"><div class="highlight"><pre><span class="n">source</span> <span class="s1">&#39;https://rubygems.org&#39;</span>
<span class="n">ruby</span> <span class="s1">&#39;2.0.0&#39;</span>
<span class="c1">#ruby-gemset=railstutorial_rails_4_0</span>

<span class="n">gem</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="s1">&#39;4.0.5&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;bootstrap-sass&#39;</span><span class="p">,</span> <span class="s1">&#39;2.3.2.0&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;sprockets&#39;</span><span class="p">,</span> <span class="s1">&#39;2.11.0&#39;</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>
</pre></div>
</div></div>


<p>いつものように<code>bundle install</code>を実行して、Bootstrapをインストールします。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle install
</pre></div>
</div>


<p>次に、開発中のアプリケーションに変更を反映するために、Webサーバーを再起動します (ほとんどのシステムでは、最初に<tt>Ctrl-C</tt>を押下してサーバーを停止し、次に<code>rails server</code>コマンドを実行することでサーバーを再起動できます)。注意: Rails 4.0の場合は、最後に<a class="ref" href="./filling-in-the-layout.html#code-bootstrap_config">リスト5.4</a>に示すように<code>config/application.rb</code>に1行追加し、<tt>bootstrap-sass</tt>がAsset Pipelineと互換性を持つようにしておく必要もあります。</p>

<div class="label" id="code-bootstrap_config"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.4</span> <span class="description">Asset Pipeline互換の行を追加する。</span><br /><span class="description"> <code>config/application.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s1">&#39;../boot&#39;</span><span class="p">,</span> <span class="bp">__FILE__</span><span class="p">)</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="k">module</span> <span class="nn">SampleApp</span>
  <span class="k">class</span> <span class="nc">Application</span> <span class="o">&lt;</span> <span class="ss">Rails::Application</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="n">config</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">precompile</span> <span class="o">+=</span> <span class="sx">%w(*.png *.jpg *.jpeg *.gif)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>アプリケーションにカスタムCSSを追加するための第一段階として、カスタムCSSを格納するための以下のファイルを開きます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> subl app/assets/stylesheets/custom.css.scss
</pre></div>
</div>


<p>このディレクトリ名とファイル名は、どちらも重要です。以下のディレクトリは、</p>

<div class="code"><div class="highlight"><pre><span class="go">app/assets/stylesheets</span>
</pre></div>
</div>


<p>Asset Pipeline (<a class="ref" href="./filling-in-the-layout.html#sec-sass_and_the_asset_pipeline">5.2</a>)の一部であり、このディレクトリに置かれたスタイルシートは<code>application.css</code>の一部として自動的にWebサイトのレイアウトにインクルードされます。さらに、ファイル名の<code>custom.css.scss</code>には<code>.css</code>という拡張子も含まれているので、このファイルはCSSファイルであることが示されています。また、<code>.scss</code>という拡張子も含まれているので、 このファイルはSassを記述できるCSSファイル (Sassy CSS: Scss) であることも示されており、Asset Pipelineはこれを見てSassを処理できるようにします (Sassは<a class="ref" href="./filling-in-the-layout.html#sec-sass">5.2.2</a>まで登場しませんが、<tt>bootstrap-sass</tt> gemが動作するためのおまじないとして必要です)。</p>

<p>カスタムCSS用のファイルを作成したら、<a class="ref" href="./filling-in-the-layout.html#code-bootstrap_css">リスト5.5</a>のように<code>@import</code>を使用してBootstrapをインクルードします。</p>

<div class="label" id="code-bootstrap_css"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.5</span> <span class="description">Bootstrap CSSを追加する。</span><br /><span class="description"> <code>app/assets/stylesheets/custom.css.scss</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="k">@import</span> <span class="s2">&quot;bootstrap&quot;</span><span class="p">;</span>
</pre></div>
</div></div>


<p><a class="ref" href="./filling-in-the-layout.html#fig-sample_app_only_bootstrap">図5.3</a>の結果に示したように、このひとつの行にBootstrapフレームワーク全体が含まれます。(場合によっては、<tt>Ctrl-C</tt>を使用してローカルのWebサーバーを再起動する必要があるかもしれません。また、スクリーンショットではBootstrap 2.0を使用していますが、このチュートリアルではBootstrap 2.3を使用しているので、外観に多少の違いが生じる可能性があることをご了承ください。これらについて心配する必要はありません。) さて、テキストの配置は今ひとつで、ロゴにはスタイルもありませんが、色使いとsignupボタンはなかなかよい感じになってきました。</p>

<div class="label" id="fig-sample_app_only_bootstrap"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="../images/figures/sample_app_only_bootstrap_4_0.png" alt="sample_app_only_bootstrap_4_0" /></span></div><div class="caption"><span class="header">図5.3</span><span class="description">Bootstrap CSSとサンプルアプリケーション。<a href="../images/figures/sample_app_only_bootstrap_4_0-full.png">(拡大)</a></span></div></div>


<p>次に、<a class="ref" href="./filling-in-the-layout.html#code-universal_css">リスト5.6</a>に示したように、Webサイト全体にわたってレイアウトと個別のページにスタイルを与えるためのCSSを追加します。<a class="ref" href="./filling-in-the-layout.html#code-universal_css">リスト5.6</a>には多数の記述ルールがあります。CSSの記述ルールを把握するためには、関心のある箇所をコメントアウトして表示を確認することをお勧めします。CSSでは、<code>/* … */</code>でコメントアウトできるので、調べてみたいコードをこれで囲い、表示がどのように変わるかを確認してみてください。<a class="ref" href="./filling-in-the-layout.html#code-universal_css">リスト5.6</a>が反映された結果を<a class="ref" href="./filling-in-the-layout.html#fig-sample_app_universal">図5.4</a>に示します。</p>

<div class="label" id="code-universal_css"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.6</span> <span class="description">すべてのページに適用される共通のスタイルをCSSに追加する。</span><br /><span class="description"> <code>app/assets/stylesheets/custom.css.scss</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="k">@import</span> <span class="s2">&quot;bootstrap&quot;</span><span class="p">;</span>

<span class="cm">/* universal */</span>

<span class="nt">html</span> <span class="p">{</span>
  <span class="na">overflow-y</span><span class="o">:</span> <span class="no">scroll</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">body</span> <span class="p">{</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">60</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">section</span> <span class="p">{</span>
  <span class="na">overflow</span><span class="o">:</span> <span class="no">auto</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">textarea</span> <span class="p">{</span>
  <span class="na">resize</span><span class="o">:</span> <span class="n">vertical</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.center</span> <span class="p">{</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.center</span> <span class="nt">h1</span> <span class="p">{</span>
  <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div></div>




<div class="label" id="fig-sample_app_universal"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="../images/figures/sample_app_universal_4_0.png" alt="sample_app_universal_4_0" /></span></div><div class="caption"><span class="header">図5.4</span><span class="description">スペースや共通スタイルを追加した結果。<a href="../images/figures/sample_app_universal_4_0-full.png">(拡大)</a></span></div></div>


<p><a class="ref" href="./filling-in-the-layout.html#code-universal_css">リスト5.6</a>のCSSの形式は一貫しています。CSSルールでは一般に、クラス、id、HTMLタグ、またはそれらの組み合わせ、のいずれかを指定します。そしてその後ろにスタイリングコマンドのリストを記述します。たとえば、以下のコードでは、</p>

<div class="code"><div class="highlight"><pre><span class="nt">body</span> <span class="p">{</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">60</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>


<p>ページ上部に60ピクセルの余白を追加します。<code>header</code>タグに<code>navbar-fixed-top</code>クラスが与えられているので、これに従ってBootstrapはナビゲーションバーをページ上部に固定し、ナビゲーションバーの下に余白を置いて主要部分から分離します (デフォルトのnavbarの色は、Bootstrap 2.0から2.1に変わったときに変更されたため、現在の淡色の代わりにダークな色調にしたい場合は<code>navbar-inverse</code>クラスを使用する必要があります)。また、このルールにある以下のCSSは、</p>

<div class="code"><div class="highlight"><pre><span class="nc">.center</span> <span class="p">{</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>


<p><code>center</code>クラスに<code>text-align: center</code>プロパティを関連付けています。言い換えると、<code>.center</code>冒頭のドット<code>.</code>は、このルールがクラスに対してスタイルを適用することを示しています。(冒頭がポンド記号<code>#</code>の場合は、<a class="ref" href="./filling-in-the-layout.html#code-logo_css">リスト5.8</a>に示したように、そのルールがCSS <em>id</em>に対してスタイルを適用することを示します。この場合、<code>center</code>クラスに属している (<code>div</code>などの) タグの内側にある要素は、すべてページ中でセンタリングされることを意味しています (このクラスの例は<a class="ref" href="./filling-in-the-layout.html#code-signup_button">リスト5.2</a>で参照できます)。</p>

<p>Bootstrapには洗練されたタイポグラフィーを利用できるCSSルールがありますが、ここではさらに、<a class="ref" href="./filling-in-the-layout.html#code-typography_css">リスト5.7</a>に示したようにサイトのテキストの外観を変えるカスタムCSSルールを追加しましょう。(これらのルールはHomeページですべて適用されるとは限りませんが、サンプルアプリケーションの他の場所でも使用されるものもあります)。<a class="ref" href="./filling-in-the-layout.html#code-typography_css">リスト5.7</a>を反映した結果を<a class="ref" href="./filling-in-the-layout.html#fig-sample_app_typography">図5.5</a>で確認することができます。</p>

<div class="label" id="code-typography_css"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.7</span> <span class="description">洗練されたタイポグラフィーを利用するためのCSSを追加する。</span><br /><span class="description"> <code>app/assets/stylesheets/custom.css.scss</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="k">@import</span> <span class="s2">&quot;bootstrap&quot;</span><span class="p">;</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>

<span class="o">/*</span> <span class="nt">typography</span> <span class="o">*/</span>

<span class="nt">h1</span><span class="o">,</span> <span class="nt">h2</span><span class="o">,</span> <span class="nt">h3</span><span class="o">,</span> <span class="nt">h4</span><span class="o">,</span> <span class="nt">h5</span><span class="o">,</span> <span class="nt">h6</span> <span class="p">{</span>
  <span class="na">line-height</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">h1</span> <span class="p">{</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">3</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">letter-spacing</span><span class="o">:</span> <span class="mi">-2</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">30</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">h2</span> <span class="p">{</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.2</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">letter-spacing</span><span class="o">:</span> <span class="mi">-1</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">30</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
  <span class="na">font-weight</span><span class="o">:</span> <span class="no">normal</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#999</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">p</span> <span class="p">{</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.1</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">line-height</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.7</span><span class="kt">em</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div></div>




<div class="label" id="fig-sample_app_typography"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="../images/figures/sample_app_typography_4_0.png" alt="sample_app_typography_4_0" /></span></div><div class="caption"><span class="header">図5.5</span><span class="description">タイポグラフィースタイルを追加する。<a href="../images/figures/sample_app_typography_4_0-full.png">(拡大)</a></span></div></div>


<p>最後に、いくつかのルールをサイトロゴに追加します。このサイトロゴは「sample app」だけが表示されているシンプルなものです。<a class="ref" href="./filling-in-the-layout.html#code-logo_css">リスト5.8</a>のCSSは、テキストを大文字に変換し、サイズ、色、配置を変更します (サイトロゴがページで一度しか使用されないことを前提としてCSS idを使用していますが、代わりにクラスを使用することもできます)。</p>

<div class="label" id="code-logo_css"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.8</span> <span class="description">サイトロゴにCSSを追加する。</span><br /><span class="description"> <code>app/assets/stylesheets/custom.css.scss</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="k">@import</span> <span class="s2">&quot;bootstrap&quot;</span><span class="p">;</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>

<span class="o">/*</span> <span class="nt">header</span> <span class="o">*/</span>

<span class="nn">#logo</span> <span class="p">{</span>
  <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
  <span class="na">margin-right</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.7</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#fff</span><span class="p">;</span>
  <span class="na">text-transform</span><span class="o">:</span> <span class="no">uppercase</span><span class="p">;</span>
  <span class="na">letter-spacing</span><span class="o">:</span> <span class="mi">-1</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">9</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">font-weight</span><span class="o">:</span> <span class="no">bold</span><span class="p">;</span>
  <span class="na">line-height</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="nn">#logo</span><span class="nd">:hover</span> <span class="p">{</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#fff</span><span class="p">;</span>
  <span class="na">text-decoration</span><span class="o">:</span> <span class="no">none</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div></div>


<p>上のコードの<code>color: #fff</code>は、ロゴの色を白に変更します。HTMLの色は、16進数 (基数が16) の3つの数値の組み合わせで表現され、赤、緑、青の三原色に (この順序で) コード化することができます。このコード<code>#ffffff</code>は、3色すべてが最大に使用されており、純白になります。なお、<code>#fff</code>は、完全な<code>#ffffff</code>の短縮形です。CSS標準には、共通<a href="http://www.w3schools.com/html/html_colornames.asp">HTMLカラー</a>の別名も多数定義されています。たとえば、<code>#fff</code>を<code>white</code>と書くこともできます。<a class="ref" href="./filling-in-the-layout.html#code-logo_css">リスト5.8</a>のCSSの結果は<a class="ref" href="./filling-in-the-layout.html#fig-sample_app_logo">図5.6</a>で確認できます。</p>

<div class="label" id="fig-sample_app_logo"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="../images/figures/sample_app_logo_4_0.png" alt="sample_app_logo_4_0" /></span></div><div class="caption"><span class="header">図5.6</span><span class="description">デザインされたロゴとサンプルアプリ。<a href="../images/figures/sample_app_logo_4_0-full.png">(拡大)</a></span></div></div>




<div class="label" id="sec-partials"></div>


<h3><a id="sec-5_1_3" href="./filling-in-the-layout.html#sec-partials" class="heading"><span class="number">5.1.3</span>パーシャル (partial)</a></h3>


<p><a class="ref" href="./filling-in-the-layout.html#code-layout_new_structure">リスト5.1</a>のレイアウトはその目的を果たしていますが、少々散らかっています。HTML shimは、それだけで3行も占有し、風変わりなIE特有の文法を使用しているので、これをうまく隠すことができたらどんなによいでしょう。また、HTMLヘッダーは論理的な単位を形成するため、一箇所にまとめる必要もあります。Railsでは、<em>パーシャル (partial)</em> と呼ばれる機能を使用してこれを実現することができます。最初に、パーシャルを定義するとレイアウトがどのように変わるかを見てみましょう (<a class="ref" href="./filling-in-the-layout.html#code-layout_with_partials">リスト5.9</a>)。</p>

<div class="label" id="code-layout_with_partials"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.9</span> <span class="description">Webサイトのレイアウトにスタイルシート用とヘッダー用のパーシャルをそれぞれ追加する。</span><br /><span class="description"> <code>app/views/layouts/application.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!</span><span class="cp">DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span><span class="cp">&lt;%=</span> <span class="n">full_title</span><span class="p">(</span><span class="k">yield</span><span class="p">(</span><span class="ss">:title</span><span class="p">))</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span> <span class="s2">&quot;application&quot;</span><span class="p">,</span> <span class="ss">media:</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
                                           <span class="s2">&quot;data-turbolinks-track&quot;</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s2">&quot;application&quot;</span><span class="p">,</span> <span class="s2">&quot;data-turbolinks-track&quot;</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">csrf_meta_tags</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">&#39;layouts/shim&#39;</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">&#39;layouts/header&#39;</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p><a class="ref" href="./filling-in-the-layout.html#code-layout_with_partials">リスト5.9</a>では、以下のように<code>render</code>と呼ばれるRailsヘルパー呼び出しだけを使って、HTML shimのスタイルシート行を置換しています。</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">&#39;layouts/shim&#39;</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>この行では、<code>app/views/layouts/_shim.html.erb</code>というファイルを探してその内容を評価し、結果をビューに挿入しています<sup class="footnote" id="fnref-5_6"><a href="./filling-in-the-layout.html#fn-5_6">6</a></sup>。 (<tt class="verb">&lt;%= ... %&gt;</tt>は、テンプレート内でRubyの式を評価するための埋め込みRuby記法であることを思い出してください。評価した結果がテンプレートに挿入されます)。ファイル名<code>_shim.html.erb</code>の前のアンダースコアに注目してください。このアンダースコアは、パーシャルで使用する普遍的な命名規約であり、また、一目見ただけでディレクトリ中のすべてのパーシャルを識別することが可能になります。</p>

<p>もちろん、パーシャルが動作するためには、その中にコンテンツを記述しなければなりません。このshimパーシャルの場合は、<a class="ref" href="./filling-in-the-layout.html#code-layout_new_structure">リスト5.1</a>のわずか3行のshimコードだけです。追加した結果を<a class="ref" href="./filling-in-the-layout.html#code-stylesheets_partial">リスト5.10</a>に示します。</p>

<div class="label" id="code-stylesheets_partial"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.10</span> <span class="description">HTML shim用のパーシャル。</span><br /><span class="description"> <code>app/views/layouts/_shim.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="c">&lt;!--[if lt IE 9]&gt;</span>
<span class="c">&lt;script src=&quot;http://html5shim.googlecode.com/svn/trunk/html5.js&quot;&gt;&lt;/script&gt;</span>
<span class="c">&lt;![endif]</span><span class="c">--&gt;</span>
</pre></div>
</div></div>


<p>同様に、他のヘッダーの情報も<a class="ref" href="./filling-in-the-layout.html#code-header_partial">リスト5.11</a>のパーシャルに移動し、<code>render</code>を呼び出してレイアウトに挿入することができます。</p>

<div class="label" id="code-header_partial"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.11</span> <span class="description">サイトヘッダー用のパーシャル。</span><br /><span class="description"> <code>app/views/layouts/_header.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;header</span> <span class="na">class=</span><span class="s">&quot;navbar navbar-fixed-top navbar-inverse&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar-inner&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;sample app&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="s2">&quot;logo&quot;</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;nav&gt;</span>
        <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;nav pull-right&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Home&quot;</span><span class="p">,</span>    <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
          <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Help&quot;</span><span class="p">,</span>    <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
          <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Sign in&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
      <span class="nt">&lt;/nav&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/header&gt;</span>
</pre></div>
</div></div>


<p>これでパーシャルの作成方法がわかりましたので、今度はヘッダーに対応するフッターを同じ方法で追加しましょう。ここまでくれば、ファイル名は<code>_footer.html.erb</code>で、layoutsディレクトリ (<a class="ref" href="./filling-in-the-layout.html#code-footer_partial">リスト5.12</a>) に置けばよいということがわかると思います<sup class="footnote" id="fnref-5_7"><a href="./filling-in-the-layout.html#fn-5_7">7</a></sup>。</p>

<div class="label" id="code-footer_partial"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.12</span> <span class="description">サイトフッター用のパーシャル。</span><br /><span class="description"> <code>app/views/layouts/_footer.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;footer</span> <span class="na">class=</span><span class="s">&quot;footer&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;small&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.jp/&quot;</span><span class="nt">&gt;</span>Rails Tutorial<span class="nt">&lt;/a&gt;</span>
    by Michael Hartl
  <span class="nt">&lt;/small&gt;</span>
  <span class="nt">&lt;nav&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
      <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;About&quot;</span><span class="p">,</span>   <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
      <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Contact&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
      <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://news.railstutorial.jp/&quot;</span><span class="nt">&gt;</span>News<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;/nav&gt;</span>
<span class="nt">&lt;/footer&gt;</span>
</pre></div>
</div></div>


<p>ヘッダーの場合と同様に、フッターの中でも<code>link_to</code>メソッドを使用して、AboutページとContactページへの内部リンクを追加してあります。ひとまず、リンク先のURLは<code>’#’</code>としておきます (<code>header</code>タグと同様、<code>footer</code>タグもHTML5で新たに追加された要素です)。</p>

<p>フッターパーシャルは、スタイルシートやヘッダーパーシャルのときと同じ方法でレイアウト中に追加できます (<a class="ref" href="./filling-in-the-layout.html#code-layout_with_footer">リスト5.13</a>)。</p>

<div class="label" id="code-layout_with_footer"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.13</span> <span class="description">サイトのレイアウトにフッターパーシャルを追加する。</span><br /><span class="description"> <code>app/views/layouts/application.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!</span><span class="cp">DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span><span class="cp">&lt;%=</span> <span class="n">full_title</span><span class="p">(</span><span class="k">yield</span><span class="p">(</span><span class="ss">:title</span><span class="p">))</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span> <span class="s2">&quot;application&quot;</span><span class="p">,</span> <span class="ss">media:</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
                                           <span class="s2">&quot;data-turbolinks-track&quot;</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s2">&quot;application&quot;</span><span class="p">,</span> <span class="s2">&quot;data-turbolinks-track&quot;</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">csrf_meta_tags</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">&#39;layouts/shim&#39;</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">&#39;layouts/header&#39;</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">&#39;layouts/footer&#39;</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p>そのまま実際にフッターを表示してみるとどうにも見苦しいので、<a class="ref" href="./filling-in-the-layout.html#code-footer_css">リスト5.14</a>でスタイルを若干追加しましょう。スタイルを追加した結果を<a class="ref" href="./filling-in-the-layout.html#fig-site_with_footer">図5.7</a>に示します。</p>

<div class="label" id="code-footer_css"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.14.</span> <span class="description">サイトのフッター用CSSを追加する。</span><br /><span class="description"> <code>app/assets/stylesheets/custom.css.scss</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>

<span class="o">/*</span> <span class="nt">footer</span> <span class="o">*/</span>

<span class="nt">footer</span> <span class="p">{</span>
  <span class="na">margin-top</span><span class="o">:</span> <span class="mi">45</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">border-top</span><span class="o">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="no">solid</span> <span class="mh">#eaeaea</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#999</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">footer</span> <span class="nt">a</span> <span class="p">{</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#555</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">footer</span> <span class="nt">a</span><span class="nd">:hover</span> <span class="p">{</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#222</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">footer</span> <span class="nt">small</span> <span class="p">{</span>
  <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">footer</span> <span class="nt">ul</span> <span class="p">{</span>
  <span class="na">float</span><span class="o">:</span> <span class="no">right</span><span class="p">;</span>
  <span class="na">list-style</span><span class="o">:</span> <span class="no">none</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">footer</span> <span class="nt">ul</span> <span class="nt">li</span> <span class="p">{</span>
  <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
  <span class="na">margin-left</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div></div>




<div class="label" id="fig-site_with_footer"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="../images/figures/site_with_footer_bootstrap_4_0.png" alt="site_with_footer_bootstrap_4_0" /></span></div><div class="caption"><span class="header">図5.7</span><span class="description">Homeページ (<a href="http://localhost:3000/static_pages/home">/static_pages/home</a>) にフッターを追加する。<a href="../images/figures/site_with_footer_bootstrap_4_0-full.png">(拡大)</a></span></div></div>




<div class="label" id="sec-sass_and_the_asset_pipeline"></div>


<h2><a id="sec-5_2" href="./filling-in-the-layout.html#sec-sass_and_the_asset_pipeline" class="heading"><span class="number">5.2</span>SassとAsset Pipeline</a></h2>


<p>最近のRailsに追加された機能の中で最も特筆すべき機能のひとつは、CSS、JavaScript、画像などの静的コンテンツの生産性と管理を大幅に強化する「Asset Pipeline」です。この節では、Asset Pipelineの高度な概要と、Asset Pipelineの一部としてデフォルトで含まれている、<em>Sass</em>と呼ばれる素晴らしいCSS生成ツールの使い方について説明します。</p>

<div class="label" id="sec-the_asset_pipeline"></div>


<h3><a id="sec-5_2_1" href="./filling-in-the-layout.html#sec-the_asset_pipeline" class="heading"><span class="number">5.2.1</span>Asset Pipeline</a></h3>


<p>Asset Pipelineは、Railsの流儀を守りながら多大な変化をもたらしますが、一般的なRails開発者の視点からは、アセットディレクトリ、マニフェストファイル、プリプロセッサエンジンという、3つの主要な機能が理解の対象となります<sup class="footnote" id="fnref-5_8"><a href="./filling-in-the-layout.html#fn-5_8">8</a></sup>。では、それぞれを順に見ていきましょう。</p>

<h4><a id="sec-5_2_1_1" href="./filling-in-the-layout.html#sec-5_2_1_1" class="heading">アセットディレクトリ</a></h4>


<p>Rails 3.0以前のバージョンでは、静的ファイルは<code>public/</code>以下の次のディレクトリに置かれていました。</p>

<ul>
<li><code>public/stylesheets</code></li>
<li><code>public/javascripts</code></li>
<li><code>public/images</code></li>
</ul>


<p>これらのディレクトリ中のファイルは、http://example.com/stylesheetsのようなリクエストによって自動的に配信されます。これは3.0以降も同様です。</p>

<p>Rails 3.1以降では、静的ファイルを目的別に分類する、標準的な<em>3つの</em>ディレクトリが使用されるようになりました。Rails 4.0でも同様です。</p>

<ul>
<li><code>app/assets</code>: 現在のアプリケーション固有のアセット</li>
<li><code>lib/assets</code>: あなたの開発チームによって作成されたライブラリ用のアセット</li>
<li><code>vendor/assets</code>: サードパーティのアセット</li>
</ul>


<p>これらのディレクトリには、それぞれのアセットクラス用のサブディレクトリがあります。たとえば、app/assetsには次のようなサブディレクトリがあります。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> ls app/assets/
<span class="go">images      javascripts stylesheets</span>
</pre></div>
</div>


<p>上記の説明から、<a class="ref" href="./filling-in-the-layout.html#sec-custom_css">5.1.2</a>で取り上げた<code>custom.css.scss</code>が配置された場所と、その理由について理解することができると思います。<code>custom.css.scss</code>は、サンプルアプリケーション固有のアセットなので、<code>app/assets/stylesheets</code>に配置されているのです。</p>

<h4><a id="sec-5_2_1_2" href="./filling-in-the-layout.html#sec-5_2_1_2" class="heading">マニフェストファイル</a></h4>


<p>アセットを上記の論理的な場所へ配置すれば、<em>マニフェストファイル</em>を使用して、それらをどのように1つのファイルにまとめるのかをRailsに指示することができます。なお、実際にまとめるのは<a href="https://github.com/sstephenson/sprockets">Sprockets</a> gemが行います。(マニフェストファイルはCSSとJavaScriptには適用されますが、画像ファイルには適用されません) 。1つの例として、アプリケーションスタイルシート用のマニフェストファイルを見てみましょう (<a class="ref" href="./filling-in-the-layout.html#code-app_css_manifest">リスト5.15</a>)。</p>

<div class="label" id="code-app_css_manifest"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.15</span> <span class="description">アプリ固有のCSS用マニフェストファイル。</span><br /><span class="description"> <code>app/assets/stylesheets/application.css</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * This is a manifest file that&#39;ll automatically include all the stylesheets</span>
<span class="cm"> * available in this directory and any sub-directories. </span><span class="cm">You&#39;re free to add</span>
<span class="cm"> * application-wide styles to this file and they&#39;ll appear at the top of the</span>
<span class="cm"> * compiled file, but it&#39;s generally better to create a new file per style</span>
<span class="cm"> * scope.</span>
<span class="cm"> *= require_self</span>
<span class="cm"> *= require_tree .</span>
<span class="cm">*/</span>
</pre></div>
</div></div>


<p>上の行で重要な部分は実はCSSコメントの中にあります。以下の行は、適切なファイルをインクルードするためにSprocketsによって使用されます。</p>

<div class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> .</span>
<span class="cm"> .</span>
<span class="cm"> .</span>
<span class="cm"> *= require_self</span>
<span class="cm"> *= require_tree .</span>
<span class="cm">*/</span>
</pre></div>
</div>


<p>以下の行は、</p>

<div class="code"><div class="highlight"><pre><span class="go">*= require_tree .</span>
</pre></div>
</div>


<p><code>app/assets/stylesheets</code>ディレクトリ (サブディレクトリを含む) のすべてのCSSファイルをアプリケーションCSSにインクルードするようにします (このドットも必要です)。以下の行は、</p>

<div class="code"><div class="highlight"><pre><span class="go">*= require_self</span>
</pre></div>
</div>


<p>CSSの読み込みシーケンスの中で、<code>application.css</code>自身もインクルードすることを指定しています。</p>

<p>Railsには実用的なデフォルトのマニフェストファイルが付属しているので、<em>Railsチュートリアル</em>では変更を加える必要がありませんが、もし必要な場合は、Railsガイドの「<a href="http://railsguides.jp/asset_pipeline.html">アセットパイプライン</a>」で詳細な情報を参照できます。</p>

<h4><a id="sec-5_2_1_3" href="./filling-in-the-layout.html#sec-5_2_1_3" class="heading">プリプロセッサエンジン</a></h4>


<p>必要なアセットをディレクトリに配置してまとめた後、Railsはさまざまなプリプロセッサエンジンを介してそれらを実行し、ブラウザに配信できるようにそれらをマニフェストファイルを用いて結合し、サイトテンプレート用に準備します。Railsは、どのプリプロセッサを使用するかを、ファイル名の拡張子を使用して判断します。最も一般的な拡張子は、Sass用の<code>.scss</code>、CoffeeScript用の<code>.coffee</code>、埋め込みRuby (ERb) 用の<code>.erb</code>です。<a class="ref" href="./static-pages.html#sec-embedded_ruby">3.3.3</a>では最初にERbを、<a class="ref" href="./filling-in-the-layout.html#sec-sass">5.2.2</a>ではSassをそれぞれ扱いました。 なお本書では扱いませんが、CoffeeScriptはエレガントで簡潔な言語で、JavaScriptにコンパイルして実行します (興味のある方は、RailsCastの「<a href="http://railscasts.com/episodes/267-coffeescript-basics">CoffeeScriptの基礎</a> (英語)」から始めると良いでしょう)。</p>

<p>プリプロセッサエンジンはつなげて実行する (chain) ことができます。</p>

<p><code>foobar.js.coffee</code></p>

<p>上の拡張子の場合、CoffeeScriptプロセッサ経由で実行されます。</p>

<p><code>foobar.js.erb.coffee</code></p>

<p>上の拡張子の場合は、CoffeeScriptとERbの両方で実行されます (コードは右から左へと実行されますので、この例ではCoffeeScriptが最初に実行されます)。</p>

<h4><a id="sec-5_2_1_4" href="./filling-in-the-layout.html#sec-5_2_1_4" class="heading">本番環境での効率性</a></h4>


<p>Asset Pipelineの最大のメリットの1つは、本番のアプリケーションで効率的になるように最適化されたアセットも自動的に生成されることです。従来は、CSSとJavaScriptを整理するために、機能を個別のファイルに分割し、(インデントを多用して) 読みやすいフォーマットに整えていました。これは、プログラマにとっては便利な方法ですが、本番環境にとっては非効率です。それというのも、最小化されていないCSSやJavaScriptファイルを多数インクルードすると、ページの読み込み時間が著しく遅くなるからです (読み込み時間は、ユーザー体験の質に影響を与える重要な指標の1つです)。一方、Asset Pipelineでは、本番環境に最適化するために、すべてのスタイルシートを1つのCSSファイル (<code>application.css</code>) にまとめ、すべてのJavaScriptファイルを1つのJSファイル (<code>javascripts.js</code>) にまとめてくれます。さらに、それらのファイルすべてに対して (<code>lib/assets</code>や<code>vendor/assets</code>のファイルも含め) 不要な空白を取り除く処理を行い、ファイルサイズを<em>最小化</em>してくれます。これにより、Asset Pipelineは、2つの異なった状況に対してそれぞれ最高の環境を提供してくれます。つまり、プログラマーに対しては見やすく分割されたフォーマットのファイルを提供し、本番環境に対しては最適化された1つのファイルを提供してくれます。</p>

<div class="label" id="sec-sass"></div>


<h3><a id="sec-5_2_2" href="./filling-in-the-layout.html#sec-sass" class="heading"><span class="number">5.2.2</span>素晴らしい構文を備えたスタイルシート</a></h3>


<p><em>Sass</em> は、スタイルシートを記述するための言語であり、CSSに比べて多くの点が強化されています。この節では、Sassが提供する2つの重要な機能、<em>ネスト</em>と<em>変数</em>について説明します。(3つ目の重要な機能である<em>ミックスイン</em>については、<a class="ref" href="./sign-up.html#sec-rails_environments">7.1.1</a>で紹介します)。</p>

<p><a class="ref" href="./filling-in-the-layout.html#sec-custom_css">5.1.2</a>でも簡単に説明しましたが、SassはSCSSというフォーマットに対応しています (<code>.scss</code>という拡張子はSCSSであることを表します)。SCSSは、厳密な意味で、CSS本体を抽象化したフォーマットです。具体的には、SCSS は CSS に新しい機能を<em>追加</em>しただけで、全く新しい構文を定義したようなものではありません<sup class="footnote" id="fnref-5_9"><a href="./filling-in-the-layout.html#fn-5_9">9</a></sup>。本書の例では、Bootstrapの恩恵を得るために、私達は最初からSCSSを使用しています。RailsのAsset Pipelineは、<code>.scss</code>という拡張子を持つファイルをSassを使って自動的に処理してくれます。このため、<code>custom.css.scss</code>ファイルはSassプリプロセッサによって前処理され、その後ブラウザへの配信に備えてパッケージ化されます。</p>

<h4><a id="sec-5_2_2_1" href="./filling-in-the-layout.html#sec-5_2_2_1" class="heading">ネスト</a></h4>


<p>スタイルシート内に共通のパターンがある場合は、要素をネストさせることができます。たとえば、<a class="ref" href="./filling-in-the-layout.html#code-universal_css">リスト 5.6</a>では、以下のように<code>.center</code>と<code>.center h1</code>の両方に対してルールがあります。</p>

<div class="code"><div class="highlight"><pre><span class="nc">.center</span> <span class="p">{</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.center</span> <span class="nt">h1</span> <span class="p">{</span>
  <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>


<p>上のルールは、Sassを使用して以下のように書き換えることができます。</p>

<div class="code"><div class="highlight"><pre><span class="nc">.center</span> <span class="p">{</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
  <span class="nt">h1</span> <span class="p">{</span>
    <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>


<p>上の例では、ネストの内側にある<code>h1</code>というルールは、<code>.center</code>のルールを継承しています。</p>

<p>今度は、もう少し異なるルールに対してネスト機能を使う例を見てみましょう。<a class="ref" href="./filling-in-the-layout.html#code-logo_css">リスト 5.8</a>には以下のコードがあります。</p>

<div class="code"><div class="highlight"><pre><span class="nn">#logo</span> <span class="p">{</span>
  <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
  <span class="na">margin-right</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.7</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#fff</span><span class="p">;</span>
  <span class="na">text-transform</span><span class="o">:</span> <span class="no">uppercase</span><span class="p">;</span>
  <span class="na">letter-spacing</span><span class="o">:</span> <span class="mi">-1</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">9</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">font-weight</span><span class="o">:</span> <span class="no">bold</span><span class="p">;</span>
  <span class="na">line-height</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="nn">#logo</span><span class="nd">:hover</span> <span class="p">{</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#fff</span><span class="p">;</span>
  <span class="na">text-decoration</span><span class="o">:</span> <span class="no">none</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>


<p>上のコードには<code>#logo</code>というidが2回使用されています。1回目はロゴ自身を定義するために、2回目は<code>hover</code>属性を定義するために使用されています (なおhover属性は、該当する要素の上にマウスポインタをかざしたときの表示を定義します)。2つ目のルールをネストするためには、親属性である<code>#logo</code>を参照する必要があります。このような場合、SCSSでは以下のようにアンパーサンド<code>&amp;</code>を使って実現できます。</p>

<div class="code"><div class="highlight"><pre><span class="nn">#logo</span> <span class="p">{</span>
  <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
  <span class="na">margin-right</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.7</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#fff</span><span class="p">;</span>
  <span class="na">text-transform</span><span class="o">:</span> <span class="no">uppercase</span><span class="p">;</span>
  <span class="na">letter-spacing</span><span class="o">:</span> <span class="mi">-1</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">9</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">font-weight</span><span class="o">:</span> <span class="no">bold</span><span class="p">;</span>
  <span class="na">line-height</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">&amp;</span><span class="nd">:hover</span> <span class="p">{</span>
    <span class="na">color</span><span class="o">:</span> <span class="mh">#fff</span><span class="p">;</span>
    <span class="na">text-decoration</span><span class="o">:</span> <span class="no">none</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>


<p>Sassは、SCSSをCSSに変換する際に、<code>&amp;:hover</code>を <code>#logo:hover</code>に置換します。</p>

<p>これらのネスト機能は、フッターのCSSでも使用できます。<a class="ref" href="./filling-in-the-layout.html#code-footer_css">リスト5.14</a>のコードは、SCSSを使用して以下のように書き換えることができます。</p>

<div class="code"><div class="highlight"><pre><span class="nt">footer</span> <span class="p">{</span>
  <span class="na">margin-top</span><span class="o">:</span> <span class="mi">45</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">border-top</span><span class="o">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="no">solid</span> <span class="mh">#eaeaea</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#999</span><span class="p">;</span>
  <span class="nt">a</span> <span class="p">{</span>
    <span class="na">color</span><span class="o">:</span> <span class="mh">#555</span><span class="p">;</span>
    <span class="k">&amp;</span><span class="nd">:hover</span> <span class="p">{</span>
      <span class="na">color</span><span class="o">:</span> <span class="mh">#222</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nt">small</span> <span class="p">{</span>
    <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nt">ul</span> <span class="p">{</span>
    <span class="na">float</span><span class="o">:</span> <span class="no">right</span><span class="p">;</span>
    <span class="na">list-style</span><span class="o">:</span> <span class="no">none</span><span class="p">;</span>
    <span class="nt">li</span> <span class="p">{</span>
      <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
      <span class="na">margin-left</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>


<p><a class="ref" href="./filling-in-the-layout.html#code-footer_css">リスト 5.14</a>を手作業で変換してみることは、良い演習になります。変換後にもCSSが適切に動作していることを確認してみましょう。</p>

<h4><a id="sec-5_2_2_2" href="./filling-in-the-layout.html#sec-5_2_2_2" class="heading">変数</a></h4>


<p>Sassでは、冗長なコードを削除し、より自由な表現を可能にするために、<em>変数</em>が定義できるようになっています。たとえば、<a class="ref" href="./filling-in-the-layout.html#code-typography_css">リスト 5.7</a>や<a class="ref" href="./filling-in-the-layout.html#code-footer_css">リスト 5.14</a>を見てみると、同じ色を繰り返し参照している箇所があります。</p>

<div class="code"><div class="highlight"><pre><span class="nt">h2</span> <span class="p">{</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#999</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nt">footer</span> <span class="p">{</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#999</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>


<p>上のコードの<code>#999</code>は薄い灰色を指しています。Sassでは、このような値を変数として定義し、以下のように変数名を与えることができます。</p>

<div class="code"><div class="highlight"><pre><span class="nv">$lightGray</span><span class="o">:</span> <span class="mh">#999</span><span class="p">;</span>
</pre></div>
</div>


<p>この機能を使用して、SCSSを以下のように書き直すことができます。</p>

<div class="code"><div class="highlight"><pre><span class="nv">$lightGray</span><span class="o">:</span> <span class="mh">#999</span><span class="p">;</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nt">h2</span> <span class="p">{</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">color</span><span class="o">:</span> <span class="nv">$lightGray</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nt">footer</span> <span class="p">{</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">color</span><span class="o">:</span> <span class="nv">$lightGray</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>


<p><code>$lightGray</code>のような変数名は、<code>#999</code> のような値よりもわかりやすいので、たとえその変数が繰り返し使われないとしても、変数名を与えることは多くの場合有用です。実際、Bootstrapフレームワークでは、多くの色に対して変数名を定義しています。定義されている変数はBootstrapページの「<a href="http://bootstrapdocs.com/v2.0.4/docs/less.html">LESS変数一覧</a>」で参照することができます。このWebサイトでは、SassではなくLESSを使って変数が定義されていますが、<tt>bootstrap-sass</tt>というgemを使用すれば、Sassでも同様の変数が使えるようになります。LESSとSass の違いを想像するのはそれほど難しくありません。たとえば、LESSではアットマーク<code>@</code>を使用しているのに対して、Sassはドルマーク<code>$</code>を使っていることはすぐにわかります。話を戻して、Bootstrapの変数の一覧表を見ると、薄い灰色に対して以下の変数名が与えられることに気が付きます。</p>

<div class="code"><div class="highlight"><pre> <span class="k">@grayLight</span><span class="nd">:</span> <span class="nn">#999</span><span class="o">;</span>
</pre></div>
</div>


<p>これは、<tt>bootstrap-sass</tt>というgemを使えば、SCSSでも同様に<code>$grayLight</code>という変数が使えることを意味しています。先ほど定義した<code>$lightGray</code>というカスタム変数に代わりに、用意された変数を使ってみましょう。</p>

<div class="code"><div class="highlight"><pre><span class="nt">h2</span> <span class="p">{</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">color</span><span class="o">:</span> <span class="nv">$grayLight</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nt">footer</span> <span class="p">{</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">color</span><span class="o">:</span> <span class="nv">$grayLight</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>


<p>今回取り上げたSassのネスト機能や変数機能を使ってSCSSファイルを全面的に書き直すと、<a class="ref" href="./filling-in-the-layout.html#code-refactored_scss">リスト 5.16</a>のようになります。このリストでは、Sassの変数 (詳しくはBootstrap LESSの変数一覧を参考にしてください) や、組み込みの色変数 (たとえば<code>#fff</code>には<code>white</code> という変数) を使っています。<code>footer</code>タグのルールが、劇的に向上していることを確認してみてください。</p>

<div class="label" id="code-refactored_scss"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.16</span> <span class="description">ネストや変数を使って初期のSCSSファイルを書き直した結果。</span><br /><span class="description"> <code>app/assets/stylesheets/custom.css.scss</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="k">@import</span> <span class="s2">&quot;bootstrap&quot;</span><span class="p">;</span>

<span class="cm">/* mixins, variables, etc. */</span>

<span class="nv">$grayMediumLight</span><span class="o">:</span> <span class="mh">#eaeaea</span><span class="p">;</span>

<span class="cm">/* universal */</span>

<span class="nt">html</span> <span class="p">{</span>
  <span class="na">overflow-y</span><span class="o">:</span> <span class="no">scroll</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">body</span> <span class="p">{</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">60</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">section</span> <span class="p">{</span>
  <span class="na">overflow</span><span class="o">:</span> <span class="no">auto</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">textarea</span> <span class="p">{</span>
  <span class="na">resize</span><span class="o">:</span> <span class="n">vertical</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.center</span> <span class="p">{</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
  <span class="nt">h1</span> <span class="p">{</span>
    <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* typography */</span>

<span class="nt">h1</span><span class="o">,</span> <span class="nt">h2</span><span class="o">,</span> <span class="nt">h3</span><span class="o">,</span> <span class="nt">h4</span><span class="o">,</span> <span class="nt">h5</span><span class="o">,</span> <span class="nt">h6</span> <span class="p">{</span>
  <span class="na">line-height</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">h1</span> <span class="p">{</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">3</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">letter-spacing</span><span class="o">:</span> <span class="mi">-2</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">30</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">h2</span> <span class="p">{</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.2</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">letter-spacing</span><span class="o">:</span> <span class="mi">-1</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">30</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
  <span class="na">font-weight</span><span class="o">:</span> <span class="no">normal</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="nv">$grayLight</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">p</span> <span class="p">{</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.1</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">line-height</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.7</span><span class="kt">em</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/* header */</span>

<span class="nn">#logo</span> <span class="p">{</span>
  <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
  <span class="na">margin-right</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.7</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="nb">white</span><span class="p">;</span>
  <span class="na">text-transform</span><span class="o">:</span> <span class="no">uppercase</span><span class="p">;</span>
  <span class="na">letter-spacing</span><span class="o">:</span> <span class="mi">-1</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">9</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">font-weight</span><span class="o">:</span> <span class="no">bold</span><span class="p">;</span>
  <span class="na">line-height</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">&amp;</span><span class="nd">:hover</span> <span class="p">{</span>
    <span class="na">color</span><span class="o">:</span> <span class="nb">white</span><span class="p">;</span>
    <span class="na">text-decoration</span><span class="o">:</span> <span class="no">none</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* footer */</span>

<span class="nt">footer</span> <span class="p">{</span>
  <span class="na">margin-top</span><span class="o">:</span> <span class="mi">45</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">border-top</span><span class="o">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="no">solid</span> <span class="nv">$grayMediumLight</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="nv">$grayLight</span><span class="p">;</span>
  <span class="nt">a</span> <span class="p">{</span>
    <span class="na">color</span><span class="o">:</span> <span class="nv">$gray</span><span class="p">;</span>
    <span class="k">&amp;</span><span class="nd">:hover</span> <span class="p">{</span>
      <span class="na">color</span><span class="o">:</span> <span class="nv">$grayDarker</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nt">small</span> <span class="p">{</span>
    <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nt">ul</span> <span class="p">{</span>
    <span class="na">float</span><span class="o">:</span> <span class="no">right</span><span class="p">;</span>
    <span class="na">list-style</span><span class="o">:</span> <span class="no">none</span><span class="p">;</span>
    <span class="nt">li</span> <span class="p">{</span>
      <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
      <span class="na">margin-left</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div></div>


<p>Sassを使ってスタイルシートをより簡単にする方法は他にもありますが、今回はその中でも最も重要な機能を使って<a class="ref" href="./filling-in-the-layout.html#code-refactored_scss">リスト 5.16</a>を書き直しました。Sassを使うことによって、素晴らしいスタートを切ることができました。Sassの詳細については、<a href="http://sass-lang.com/">Sass の公式サイト</a> (英語) を参照してください。</p>

<div class="label" id="sec-layout_links"></div>


<h2><a id="sec-5_3" href="./filling-in-the-layout.html#sec-layout_links" class="heading"><span class="number">5.3</span>レイアウトのリンク</a></h2>


<p>サイトのレイアウトが美しく仕上がりましたので、今度は<code>’#’</code>で代用していたリンクを書き換えてみましょう。もちろん、以下のようにリンクを直接記述することもできます。</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/static_pages/about&quot;</span><span class="nt">&gt;</span>About<span class="nt">&lt;/a&gt;</span>
</pre></div>
</div>


<p>しかし、上の記法はRails流ではありません。まず、aboutページへのURLは/static_pages/aboutよりも/aboutの方がよいでしょう。さらに、Railsでは以下のようなコードでは<em>名前付きルート</em>を使用するのが慣例となっています。</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;About&quot;</span><span class="p">,</span> <span class="n">about_path</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>上のようにすることでコードの意味がわかりやすくなり、<code>about_path</code>の定義を変えれば<code>about_path</code>が使用されているすべてのURLを変更できるため、柔軟性が高まります。</p>

<p>今後使用する計画のあるすべてのリンクのリストを、URLとルート (route) のマッピングと共に<a class="ref" href="./filling-in-the-layout.html#table-url_mapping">表5.1</a>に示します。この章の終わりまでに、最後のリンク以外のすべてを実装します。(最後のリンクは<a class="ref" href="./sign-in-sign-out.html#top">第8章</a>で作成します。)</p>

<div class="label" id="table-url_mapping"></div>


<div class="table"><div class="center">
<table class="tabular"><tr><th class="align_left"><strong>ページ</strong></th><th class="align_left"><strong>URL</strong></th><th class="align_right"><strong>名前付きルート</strong></th></tr><tr class="top_bar"><td class="align_left">Home</td><td class="align_left">/</td><td class="align_right"><code>root_path</code></td></tr><tr><td class="align_left">About</td><td class="align_left">/about</td><td class="align_right"><code>about_path</code></td></tr><tr><td class="align_left">Help</td><td class="align_left">/help</td><td class="align_right"><code>help_path</code></td></tr><tr><td class="align_left">Contact</td><td class="align_left">/contact</td><td class="align_right"><code>contact_path</code></td></tr><tr><td class="align_left">Sign up</td><td class="align_left">/signup</td><td class="align_right"><code>signup_path</code></td></tr><tr><td class="align_left">Sign in</td><td class="align_left">/signin</td><td class="align_right"><code>signin_path</code></td></tr></table></div><div class="caption"><span class="header">表 5.1</span><span class="description">サイトリンクのルート (routing) とURLのマッピング。</span></div></div>


<p>先に進む前にContactページを追加しましょう (これは<a class="ref" href="./static-pages.html#top">第3章</a>の演習の積み残しです)。Contactページのテストを<a class="ref" href="./filling-in-the-layout.html#code-contact_page_test">リスト5.17</a>に示します。これは単に<a class="ref" href="./static-pages.html#code-pages_controller_spec_title">リスト3.19</a>で使用されているテストのパターンに従ったものです。</p>

<div class="label" id="code-contact_page_test"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.17</span> <span class="description">Contactページのテスト。</span><br /><span class="description"> <code>spec/requests/static_pages_spec.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="s2">&quot;Static pages&quot;</span> <span class="k">do</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="n">describe</span> <span class="s2">&quot;Contact page&quot;</span> <span class="k">do</span>

    <span class="n">it</span> <span class="s2">&quot;should have the content &#39;Contact&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="s1">&#39;/static_pages/contact&#39;</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_content</span><span class="p">(</span><span class="s1">&#39;Contact&#39;</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the title &#39;Contact&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="s1">&#39;/static_pages/contact&#39;</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_title</span><span class="p">(</span><span class="s2">&quot;Ruby on Rails Tutorial Sample App | Contact&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>以下のテストは失敗するはずです。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/static_pages_spec.rb
</pre></div>
</div>


<p>アプリケーションコードは、<a class="ref" href="./static-pages.html#sec-adding_a_page">3.2.2</a>のAboutページへの追加と良く似ています。最初にルート (<a class="ref" href="./filling-in-the-layout.html#code-contact_route">リスト5.18</a>) を更新します。次に<code>contact</code>アクションをStaticPagesコントローラ (<a class="ref" href="./filling-in-the-layout.html#code-contact_action">リスト5.19</a>) に追加します。最後にContactビュー (<a class="ref" href="./filling-in-the-layout.html#code-contact_view">リスト5.20</a>) を作成します。</p>

<div class="label" id="code-contact_route"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.18</span> <span class="description">Contactページ用のルートを追加する。</span><br /><span class="description"> <code>config/routes.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="ss">SampleApp::Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s2">&quot;static_pages/home&quot;</span>
  <span class="n">get</span> <span class="s2">&quot;static_pages/help&quot;</span>
  <span class="n">get</span> <span class="s2">&quot;static_pages/about&quot;</span>
  <span class="n">get</span> <span class="s2">&quot;static_pages/contact&quot;</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code-contact_action"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.19</span> <span class="description">Contactページ用のアクションを追加する。</span><br /><span class="description"> <code>app/controllers/static_pages_controller.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">StaticPagesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="k">def</span> <span class="nf">contact</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code-contact_view"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.20</span> <span class="description">Contactページのビュー。</span><br /><span class="description"> <code>app/views/static_pages/contact.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="n">provide</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="s1">&#39;Contact&#39;</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;h1&gt;</span>Contact<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>
  Contact Ruby on Rails Tutorial about the sample app at the
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.jp/contact&quot;</span><span class="nt">&gt;</span>contact page<span class="nt">&lt;/a&gt;</span>.
<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>


<p>今度はテストが成功することを確認してください。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/static_pages_spec.rb
</pre></div>
</div>




<div class="label" id="sec-route_tests"></div>


<h3><a id="sec-5_3_1" href="./filling-in-the-layout.html#sec-route_tests" class="heading"><span class="number">5.3.1</span> ルートのテスト</a></h3>


<p>静的ページの結合テストを書いておいたので、ルートに対するテストはシンプルです。コードに直接書かれているアドレスを<a class="ref" href="./filling-in-the-layout.html#table-url_mapping">表5.1</a>にある名前付きルートにそれぞれ置き換えるだけです。つまり、以下のコードの場合、</p>

<div class="code"><div class="highlight"><pre><span class="n">visit</span> <span class="s1">&#39;/static_pages/about&#39;</span>
</pre></div>
</div>


<p>上を以下のように変更します。</p>

<div class="code"><div class="highlight"><pre><span class="n">visit</span> <span class="n">about_path</span>
</pre></div>
</div>


<p>他のページについても同様に変更します。変更の結果を<a class="ref" href="./filling-in-the-layout.html#code-route_tests">リスト5.21</a>に示します。</p>

<div class="label" id="code-route_tests"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.21</span> <span class="description">名前付きルートのテスト。</span><br /><span class="description"> <code>spec/requests/static_pages_spec.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="s2">&quot;Static pages&quot;</span> <span class="k">do</span>

  <span class="n">describe</span> <span class="s2">&quot;Home page&quot;</span> <span class="k">do</span>

    <span class="n">it</span> <span class="s2">&quot;should have the h1 &#39;Sample App&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="n">root_path</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_content</span><span class="p">(</span><span class="s1">&#39;Sample App&#39;</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the base title&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="n">root_path</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_title</span><span class="p">(</span><span class="s2">&quot;Ruby on Rails Tutorial Sample App&quot;</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should not have a custom page title&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="n">root_path</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span> <span class="n">have_title</span><span class="p">(</span><span class="s1">&#39;| Home&#39;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;Help page&quot;</span> <span class="k">do</span>

    <span class="n">it</span> <span class="s2">&quot;should have the h1 &#39;Help&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="n">help_path</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_content</span><span class="p">(</span><span class="s1">&#39;Help&#39;</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the title &#39;Help&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="n">help_path</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_title</span><span class="p">(</span><span class="s2">&quot;Ruby on Rails Tutorial Sample App | Help&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;About page&quot;</span> <span class="k">do</span>

    <span class="n">it</span> <span class="s2">&quot;should have the h1 &#39;About Us&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="n">about_path</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_content</span><span class="p">(</span><span class="s1">&#39;About Us&#39;</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the title &#39;About Us&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="n">about_path</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_title</span><span class="p">(</span><span class="s2">&quot;Ruby on Rails Tutorial Sample App | About Us&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;Contact page&quot;</span> <span class="k">do</span>

    <span class="n">it</span> <span class="s2">&quot;should have the content &#39;Contact&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="n">contact_path</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_content</span><span class="p">(</span><span class="s1">&#39;Contact&#39;</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the title &#39;Contact&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="n">contact_path</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_title</span><span class="p">(</span><span class="s2">&quot;Ruby on Rails Tutorial Sample App | Contact&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>いつもと同様に、今度のテストは赤色 (失敗) になるはずです。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/static_pages_spec.rb
</pre></div>
</div>


<p>ところで、もし<a class="ref" href="./filling-in-the-layout.html#code-route_tests">リスト5.21</a>が繰り返しが多く冗長だと感じたなら、それはあなただけではありません。この乱雑な状態を<a class="ref" href="./filling-in-the-layout.html#sec-pretty_rspec">5.3.4</a>で美しい宝石へとリファクタリングする予定です。</p>

<div class="label" id="sec-rails_routes"></div>


<h3><a id="sec-5_3_2" href="./filling-in-the-layout.html#sec-rails_routes" class="heading"><span class="number">5.3.2</span> Railsのルート</a></h3>


<p>URLに対するテストができあがったので、それらを実際に利用できるようにしましょう。<a class="ref" href="./static-pages.html#sec-static_pages">3.1.2</a>で説明したとおり、RailsがURLマッピングに使用するファイルは<code>config/routes.rb</code>です。デフォルトのルートファイルの内容を見てみると、かなり乱雑になっています。しかし、それらはすべてコメントアウトされたルートマッピングの例であり、必要な乱雑さです。時間のあるときにこのルートマッピングを読んでみることをお勧めします。また、より詳細なルーティングの扱いについてはRailsガイドの「<a href="http://railsguides.jp/routing.html">Rails ルーティング</a>」を参照することをお勧めします。</p>

<p>名前付きルートを定義するため、以下のようなルールを置き換えます。</p>

<div class="code"><div class="highlight"><pre><span class="n">get</span> <span class="s1">&#39;static_pages/help&#39;</span>
</pre></div>
</div>


<p>上のルーティングを下記のように置き換えます。</p>

<div class="code"><div class="highlight"><pre><span class="n">match</span> <span class="s1">&#39;/help&#39;</span><span class="p">,</span> <span class="ss">to:</span> <span class="s1">&#39;static_pages#help&#39;</span><span class="p">,</span> <span class="ss">via:</span> <span class="s1">&#39;get&#39;</span>
</pre></div>
</div>


<p>このルーティングは、<code>/help</code> (<tt>GET</tt>リクエストに応答する) で有効なページと、そのページへのパスを返す<code>help_path</code>という名前の名前付きルートの両方を準備します (実際には、<code>match</code>の箇所に<code>get</code>を使用しても同じ名前付きルートになりますが、<code>match</code>を利用する方がよりRailsの慣例に従っています)。</p>

<p>このパターンを他の静的ページに適用すると、<a class="ref" href="./filling-in-the-layout.html#code-static_page_routes">リスト5.22</a>になります。唯一の例外は、<a class="ref" href="./filling-in-the-layout.html#code-root_route">リスト5.24</a>で取り扱うHomeページです。</p>

<div class="label" id="code-static_page_routes"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.22</span> <span class="description">静的ページのルート。</span><br /><span class="description"> <code>config/routes.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="ss">SampleApp::Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">match</span> <span class="s1">&#39;/help&#39;</span><span class="p">,</span>    <span class="ss">to:</span> <span class="s1">&#39;static_pages#help&#39;</span><span class="p">,</span>    <span class="ss">via:</span> <span class="s1">&#39;get&#39;</span>
  <span class="n">match</span> <span class="s1">&#39;/about&#39;</span><span class="p">,</span>   <span class="ss">to:</span> <span class="s1">&#39;static_pages#about&#39;</span><span class="p">,</span>   <span class="ss">via:</span> <span class="s1">&#39;get&#39;</span>
  <span class="n">match</span> <span class="s1">&#39;/contact&#39;</span><span class="p">,</span> <span class="ss">to:</span> <span class="s1">&#39;static_pages#contact&#39;</span><span class="p">,</span> <span class="ss">via:</span> <span class="s1">&#39;get&#39;</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p><a class="ref" href="./filling-in-the-layout.html#code-static_page_routes">リスト5.22</a>コードを注意深く読むことで、このコードの動作を理解できるでしょう。たとえば以下のコードの場合について説明します。</p>

<div class="code"><div class="highlight"><pre><span class="n">match</span> <span class="s1">&#39;/about&#39;</span><span class="p">,</span> <span class="ss">to:</span> <span class="s1">&#39;static_pages#about&#39;</span><span class="p">,</span>  <span class="ss">via:</span> <span class="s1">&#39;get&#39;</span>
</pre></div>
</div>


<p>上のコードは、<code>’/about’</code>への<tt>GET</tt>リクエストにマッチします。次にStaticPagesコントローラの<code>about</code>アクションにルーティングされます。変更前の以下のコードは、より明示的でした。</p>

<div class="code"><div class="highlight"><pre><span class="n">get</span> <span class="s1">&#39;static_pages/about&#39;</span>
</pre></div>
</div>


<p>このコードも同じページへたどり着きますが、<code>/about</code>の方が簡潔です。さらに前述したように、<code>match ’/about’</code>というコードは自動的にコントローラとビューで使用する<em>名前付きルート</em>を生成します。</p>

<div class="code"><div class="highlight"><pre><span class="n">about_path</span> <span class="o">-&gt;</span> <span class="s1">&#39;/about&#39;</span>
<span class="n">about_url</span>  <span class="o">-&gt;</span> <span class="s1">&#39;http://localhost:3000/about&#39;</span>
</pre></div>
</div>


<p><code>about_url</code>は<em>フル</em>URL http://localhost:3000/about であることに注目してください (なお、<code>localhost:3000</code>は本番環境で<code>example.com</code>のようなドメイン名へ置き換えられます)。<a class="ref" href="./filling-in-the-layout.html#sec-layout_links">5.3</a>で説明したように、/about のみを取得する場合は <code>about_path</code>を使います。なお、<em>Railsチュートリアル</em>では、<code>path</code>書式を使用する一般的な規約に従い、リダイレクトの場合のみ<code>url</code>書式を使用します。これは、HTTP標準では技術的にリダイレクト後にフルURLが要求されるためです。ただし、ほとんどのブラウザではどちらの方法でも動作します。</p>

<p>ルーティングが定義されたので、Help、About、Contactページのテストはパスするはずです。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/static_pages_spec.rb
</pre></div>
</div>


<p>これで、失敗するテストはHomeページを残すだけとなりました。</p>

<p>Homeページへのルートマッピングを作成する際に、以下のようなコードを使用<em>することも一応可能です</em>。</p>

<div class="code"><div class="highlight"><pre><span class="n">match</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="ss">to:</span> <span class="s1">&#39;static_pages#home&#39;</span><span class="p">,</span> <span class="ss">via:</span> <span class="s1">&#39;get&#39;</span>
</pre></div>
</div>


<p>しかし、実際にはルート (root) については上のように書く必要はありません。Railsでは、routesファイル (<a class="ref" href="./filling-in-the-layout.html#code-root_route_hint">リスト5.23</a>) の下の方のコメント内に、ルート(root) URL / (“スラッシュ”) 用の特別な記法が書かれています。</p>

<div class="label" id="code-root_route_hint"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.23</span> <span class="description">ルート (root) へのルーティングを定義する、コメント内のヒント。</span><br /><span class="description"> <code>config/routes.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="ss">SampleApp::Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="c1"># You can have the root of your site routed with &quot;root&quot;</span>
  <span class="c1"># root &#39;welcome#index&#39;</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p><a class="ref" href="./filling-in-the-layout.html#code-root_route_hint">リスト5.23</a>のコメントを参考に、<a class="ref" href="./filling-in-the-layout.html#code-root_route">リスト5.24</a>のようにルート (root) URL / をHomeページへルーティングします。</p>

<div class="label" id="code-root_route"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.24</span> <span class="description">ルート (root) へのルーティングのためのマッピングを追加する。</span><br /><span class="description"> <code>config/routes.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="ss">SampleApp::Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">root</span>  <span class="s1">&#39;static_pages#home&#39;</span>
  <span class="n">match</span> <span class="s1">&#39;/help&#39;</span><span class="p">,</span>    <span class="ss">to:</span> <span class="s1">&#39;static_pages#help&#39;</span><span class="p">,</span>    <span class="ss">via:</span> <span class="s1">&#39;get&#39;</span>
  <span class="n">match</span> <span class="s1">&#39;/about&#39;</span><span class="p">,</span>   <span class="ss">to:</span> <span class="s1">&#39;static_pages#about&#39;</span><span class="p">,</span>   <span class="ss">via:</span> <span class="s1">&#39;get&#39;</span>
  <span class="n">match</span> <span class="s1">&#39;/contact&#39;</span><span class="p">,</span> <span class="ss">to:</span> <span class="s1">&#39;static_pages#contact&#39;</span><span class="p">,</span> <span class="ss">via:</span> <span class="s1">&#39;get&#39;</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>上のコードは、ルート (root) URLである / を /static_pages/home に割り当てています。これにより、<a href="http://localhost:3000/">http://localhost:3000/</a>の表示が<a class="ref" href="./beginning.html#fig-riding_rails">図1.3</a>のデフォルトのRailsページから変更されます。また、URLヘルパーに以下の設定を与えます。</p>

<div class="code"><div class="highlight"><pre><span class="n">root_path</span> <span class="o">=&gt;</span> <span class="s1">&#39;/&#39;</span>
<span class="n">root_url</span>  <span class="o">=&gt;</span> <span class="s1">&#39;http://localhost:3000/&#39;</span>
</pre></div>
</div>


<p>これで静的ページへのルートがすべて動作し、テストもすべてパスするはずです。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/static_pages_spec.rb
</pre></div>
</div>


<p>後は、レイアウトのリンクをこれらの名前付きルートで埋めればよいのです。</p>

<div class="label" id="sec-named_routes"></div>


<h3><a id="sec-5_3_3" href="./filling-in-the-layout.html#sec-named_routes" class="heading"><span class="number">5.3.3</span>名前付きルート</a></h3>


<p>レイアウトのリンクを有効にするために、<a class="ref" href="./filling-in-the-layout.html#sec-rails_routes">5.3.2</a>で作成した名前付きルートを記入しましょう。そのためには、<code>link_to</code>メソッドの2番目の引数に適切な名前付きルートを指定する必要があります。たとえば以下のコードの場合、</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;About&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>上を以下のように変更します。</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;About&quot;</span><span class="p">,</span> <span class="n">about_path</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p></p>

<p>最初に、HomeページとHelpページへのリンクを持つヘッダーパーシャル<code>_header.html.erb</code> (<a class="ref" href="./filling-in-the-layout.html#code-header_partial_links">リスト5.25</a>) から取りかかります。ヘッダーパーシャルでは、Web共通の慣習に従って、ロゴにもHomeページへのリンクを追加します。</p>

<div class="label" id="code-header_partial_links"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.25</span> <span class="description">ヘッダーパーシャルにリンクを追加する。</span><br /><span class="description"> <code>app/views/layouts/_header.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;header</span> <span class="na">class=</span><span class="s">&quot;navbar navbar-fixed-top navbar-inverse&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar-inner&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;sample app&quot;</span><span class="p">,</span> <span class="n">root_path</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="s2">&quot;logo&quot;</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;nav&gt;</span>
        <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;nav pull-right&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Home&quot;</span><span class="p">,</span>    <span class="n">root_path</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
          <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Help&quot;</span><span class="p">,</span>    <span class="n">help_path</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
          <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Sign in&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
      <span class="nt">&lt;/nav&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/header&gt;</span>
</pre></div>
</div></div>


<p>[Sign in] リンクの名前付きルートは<a class="ref" href="./sign-in-sign-out.html#top">第8章</a>で作成するため、今の段階では<code>’#’</code>のままにしておきます。</p>

<p>フッターパーシャル<code>_footer.html.erb</code>にもリンクがあります。これらはAboutページとContactページへのリンクです (<a class="ref" href="./filling-in-the-layout.html#code-footer_partial_links">リスト5.26</a>)。</p>

<div class="label" id="code-footer_partial_links"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.26</span> <span class="description">フッターパーシャルにリンクを追加する。</span><br /><span class="description"> <code>app/views/layouts/_footer.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;footer</span> <span class="na">class=</span><span class="s">&quot;footer&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;small&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.jp/&quot;</span><span class="nt">&gt;</span>Rails Tutorial<span class="nt">&lt;/a&gt;</span>
    by Michael Hartl
  <span class="nt">&lt;/small&gt;</span>
  <span class="nt">&lt;nav&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
      <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;About&quot;</span><span class="p">,</span>   <span class="n">about_path</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
      <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Contact&quot;</span><span class="p">,</span> <span class="n">contact_path</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
      <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://news.railstutorial.jp/&quot;</span><span class="nt">&gt;</span>News<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;/nav&gt;</span>
<span class="nt">&lt;/footer&gt;</span>
</pre></div>
</div></div>


<p>これで、レイアウトに<a class="ref" href="./static-pages.html#top">第3章</a>で作成したすべての静的ページへのリンクができました。たとえば<a href="http://localhost:3000/about">/about</a>の場合はAboutページ (<a class="ref" href="./filling-in-the-layout.html#fig-about_page">図5.8</a>) に移動します。</p>

<p>ところで、実際にレイアウト上にリンクが存在するかどうかをまだテストしていませんが、テスト方法のヒントとして、名前付きルートが定義されていなければテストは失敗するということに注目してください。このことは、<a class="ref" href="./filling-in-the-layout.html#code-static_page_routes">リスト5.22</a>のルーティング定義をコメントアウトし、テストスイートを実行することで確認できます。リンクが実際に正しい場所を指していることを確認するテストの手法については、<a class="ref" href="./filling-in-the-layout.html#sec-layout_exercises">5.6</a>で説明します。</p>

<div class="label" id="fig-about_page"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="../images/figures/about_page_styled.png" alt="about_page_styled" /></span></div><div class="caption"><span class="header">図5.8</span><span class="description"><a href="http://localhost:3000/about">/about</a>で表示されるAboutページ。<a href="../images/figures/about_page_styled-full.png">(拡大)</a></span></div></div>




<div class="label" id="sec-pretty_rspec"></div>


<h3><a id="sec-5_3_4" href="./filling-in-the-layout.html#sec-pretty_rspec" class="heading"><span class="number">5.3.4</span>RSpecを洗練させる</a></h3>


<p><a class="ref" href="./filling-in-the-layout.html#sec-route_tests">5.3.1</a>で、静的ページのテストが冗長で繰り返しが多くなってきたことを指摘しました (<a class="ref" href="./filling-in-the-layout.html#code-route_tests">リスト5.21</a>)。この節では、RSpecの最新の機能を使い、テストをより簡潔で洗練されたものにします。</p>

<p>テストの改善方法について、いくつかの例を見てみましょう。</p>

<div class="code"><div class="highlight"><pre><span class="n">describe</span> <span class="s2">&quot;Home page&quot;</span> <span class="k">do</span>

  <span class="n">it</span> <span class="s2">&quot;should have the content &#39;Sample App&#39;&quot;</span> <span class="k">do</span>
    <span class="n">visit</span> <span class="n">root_path</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_content</span><span class="p">(</span><span class="s1">&#39;Sample App&#39;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">&quot;should have the base title&quot;</span> <span class="k">do</span>
    <span class="n">visit</span> <span class="n">root_path</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_title</span><span class="p">(</span><span class="s2">&quot;Ruby on Rails Tutorial Sample App&quot;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">&quot;should not have a custom page title&quot;</span> <span class="k">do</span>
    <span class="n">visit</span> <span class="n">root_path</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span> <span class="n">have_title</span><span class="p">(</span><span class="s1">&#39;| Home&#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>


<p>まず、上の3つの例はいずれもルートへのアクセスを含んでいることに気付きます。<code>before</code>ブロックを使用することでこの冗長箇所を除くことができます。</p>

<div class="code"><div class="highlight"><pre><span class="n">describe</span> <span class="s2">&quot;Home page&quot;</span> <span class="k">do</span>
  <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">root_path</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s2">&quot;should have the content &#39;Sample App&#39;&quot;</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_content</span><span class="p">(</span><span class="s1">&#39;Sample App&#39;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">&quot;should have the base title&quot;</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_title</span><span class="p">(</span><span class="s2">&quot;Ruby on Rails Tutorial Sample App&quot;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">&quot;should not have a custom page title&quot;</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span> <span class="n">have_title</span><span class="p">(</span><span class="s1">&#39;| Home&#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>


<p>上のコードでは以下を使用しました。</p>

<div class="code"><div class="highlight"><pre><span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">root_path</span> <span class="p">}</span>
</pre></div>
</div>


<p>これにより、それぞれの例の前にルートパスへのアクセスを実行します (<code>before</code>メソッドは、別名でもある<code>before(:each)</code>で呼ぶこともできます)。</p>

<p>冗長性の原因は他にもあります。</p>

<div class="code"><div class="highlight"><pre><span class="n">it</span> <span class="s2">&quot;should have the content &#39;Sample App&#39;&quot;</span> <span class="k">do</span>
</pre></div>
</div>


<p>上と以下はどちらも本質的には同じ内容です。</p>

<div class="code"><div class="highlight"><pre><span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_content</span><span class="p">(</span><span class="s1">&#39;Sample App&#39;</span><span class="p">)</span>
</pre></div>
</div>


<p>さらに、どちらの例も<code>page</code>変数を参照しています。以下のように、<code>page</code>はテストの<em>主題 (subject) </em>であることをRSpecに伝えることにより、冗長の原因を排除できます。</p>

<div class="code"><div class="highlight"><pre><span class="n">subject</span> <span class="p">{</span> <span class="n">page</span> <span class="p">}</span>
</pre></div>
</div>


<p>次に、以下のように<code>it</code>メソッドの変種を使用することにより、コードと記述を1行に収めます。</p>

<div class="code"><div class="highlight"><pre><span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_content</span><span class="p">(</span><span class="s1">&#39;Sample App&#39;</span><span class="p">)</span> <span class="p">}</span>
</pre></div>
</div>


<p><code>subject { page }</code>と記述したことにより、<code>should</code>の呼び出しは自動的に、Capybara (<a class="ref" href="./static-pages.html#sec-TDD">3.2.1</a>)により提供される<code>page</code>変数を使用します。</p>

<p>これらの変更を加えることでHomeページのテストはより簡潔になります。</p>

<div class="code"><div class="highlight"><pre>  <span class="n">subject</span> <span class="p">{</span> <span class="n">page</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s2">&quot;Home page&quot;</span> <span class="k">do</span>
    <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">root_path</span> <span class="p">}</span>

    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_content</span><span class="p">(</span><span class="s1">&#39;Sample App&#39;</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_title</span><span class="p">(</span><span class="s2">&quot;Ruby on Rails Tutorial Sample App&quot;</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should_not</span> <span class="n">have_title</span><span class="p">(</span><span class="s1">&#39;| Home&#39;</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>
</pre></div>
</div>


<p>上のコードは以前より良くなりましたが、まだタイトルのテストが少し長すぎます。確かに、<a class="ref" href="./filling-in-the-layout.html#code-route_tests">リスト5.21</a>にあるほとんどのタイトルのテストで以下の長いテキストが使用されています。</p>

<div class="code"><div class="highlight"><pre><span class="s2">&quot;Ruby on Rails Tutorial Sample App | About&quot;</span>
</pre></div>
</div>


<p><a class="ref" href="./static-pages.html#sec-static_pages_exercises">3.5</a>の演習では、<code>base_title</code>変数を定義し、式展開を使用することでこの冗長性を排除することを提案しました (<a class="ref" href="./static-pages.html#code-pages_controller_spec_exercise">リスト3.31</a>)。<a class="ref" href="./rails-flavored-ruby.html#code-title_helper">リスト4.2</a>の<code>full_title</code>ヘルパーと同様の<code>full_title</code>を定義することで、さらに改良することができます。これを行うには、RSpecユーティリティで使用する<code>spec/support</code>ディレクトリと<code>utilities.rb</code>ファイルを作成します (<a class="ref" href="./filling-in-the-layout.html#code-rspec_utilities">リスト5.27</a>)。</p>

<div class="label" id="code-rspec_utilities"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.27</span> <span class="description"><code>full_title</code>メソッドを持つRSpecユーティリティ用ファイル。</span><br /><span class="description"> <code>spec/support/utilities.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">full_title</span><span class="p">(</span><span class="n">page_title</span><span class="p">)</span>
  <span class="n">base_title</span> <span class="o">=</span> <span class="s2">&quot;Ruby on Rails Tutorial Sample App&quot;</span>
  <span class="k">if</span> <span class="n">page_title</span><span class="o">.</span><span class="n">empty?</span>
    <span class="n">base_title</span>
  <span class="k">else</span>
    <span class="s2">&quot;</span><span class="si">#{</span><span class="n">base_title</span><span class="si">}</span><span class="s2"> | </span><span class="si">#{</span><span class="n">page_title</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>もちろんこれは、基本的に<a class="ref" href="./rails-flavored-ruby.html#code-title_helper">リスト4.2</a>のヘルパーの複製です。しかし、2つの独立したメソッドがあることで基本タイトルのタイプミスを検出することができます。ヘルパーのコードとテストコードがまったく同じになっているというのは、やや疑問の残る設計であり、演習 (<a class="ref" href="./filling-in-the-layout.html#sec-layout_exercises">5.6</a>) ではもっと良い (少しだけ高度な) アプローチとして、オリジナルの<code>full_title</code>ヘルパーを直接テストします。</p>

<p><code>spec/support</code>ディレクトリはRSpecによって自動的に読み込まれるため、Homeテストは以下のように書くことができます。</p>

<div class="code"><div class="highlight"><pre>  <span class="n">subject</span> <span class="p">{</span> <span class="n">page</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s2">&quot;Home page&quot;</span> <span class="k">do</span>
    <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">root_path</span> <span class="p">}</span>

    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_content</span><span class="p">(</span><span class="s1">&#39;Sample App&#39;</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_title</span><span class="p">(</span><span class="n">full_title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">))</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should_not</span> <span class="n">have_title</span><span class="p">(</span><span class="s1">&#39;| Home&#39;</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>
</pre></div>
</div>


<p>Homeページで使用したのと同じ方法で、Help、About、Contactページのテストも単純化することができます。変更の結果を<a class="ref" href="./filling-in-the-layout.html#code-pretty_page_tests">リスト5.28</a>に示します。</p>

<div class="label" id="code-pretty_page_tests"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.28</span> <span class="description">整えられた静的ページ用テスト。</span><br /><span class="description"> <code>spec/requests/static_pages_spec.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="s2">&quot;Static pages&quot;</span> <span class="k">do</span>

  <span class="n">subject</span> <span class="p">{</span> <span class="n">page</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s2">&quot;Home page&quot;</span> <span class="k">do</span>
    <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">root_path</span> <span class="p">}</span>

    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_content</span><span class="p">(</span><span class="s1">&#39;Sample App&#39;</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_title</span><span class="p">(</span><span class="n">full_title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">))</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should_not</span> <span class="n">have_title</span><span class="p">(</span><span class="s1">&#39;| Home&#39;</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;Help page&quot;</span> <span class="k">do</span>
    <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">help_path</span> <span class="p">}</span>

    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_content</span><span class="p">(</span><span class="s1">&#39;Help&#39;</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_title</span><span class="p">(</span><span class="n">full_title</span><span class="p">(</span><span class="s1">&#39;Help&#39;</span><span class="p">))</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;About page&quot;</span> <span class="k">do</span>
    <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">about_path</span> <span class="p">}</span>

    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_content</span><span class="p">(</span><span class="s1">&#39;About&#39;</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_title</span><span class="p">(</span><span class="n">full_title</span><span class="p">(</span><span class="s1">&#39;About Us&#39;</span><span class="p">))</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;Contact page&quot;</span> <span class="k">do</span>
    <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">contact_path</span> <span class="p">}</span>

    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_content</span><span class="p">(</span><span class="s1">&#39;Contact&#39;</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_title</span><span class="p">(</span><span class="n">full_title</span><span class="p">(</span><span class="s1">&#39;Contact&#39;</span><span class="p">))</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>テストは今度もパスするはずです。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/static_pages_spec.rb
</pre></div>
</div>


<p><a class="ref" href="./filling-in-the-layout.html#code-pretty_page_tests">リスト5.28</a>のRSpecスタイルは、<a class="ref" href="./filling-in-the-layout.html#code-route_tests">リスト5.21</a>のスタイルよりもずっと簡潔でわかりやすくなっています。実は、さらに簡潔でわかりやすくすることが可能です (<a class="ref" href="./filling-in-the-layout.html#sec-layout_exercises">5.6</a>)。サンプルアプリケーションの今後の開発では、そのさらに簡潔なスタイルを可能な限り使用することにします。</p>

<div class="label" id="sec-user_signup"></div>


<h2><a id="sec-5_4" href="./filling-in-the-layout.html#sec-user_signup" class="heading"><span class="number">5.4</span>ユーザー登録: 最初のステップ</a></h2>


<p>この節では、レイアウトとルーティングの取り組みにおける頂点として、ユーザー登録ページへのルーティングを作成します。そのために2番目のコントローラを作成することになります。これは、Webサイトでユーザー登録を行えるようにするための最初の重要な一歩となります。次の一歩であるユーザーのモデリングは<a class="ref" href="./modeling-users.html#top">第6章</a>で行い、<a class="ref" href="./sign-up.html#top">第7章</a>でユーザー登録が完成します。</p>

<div class="label" id="sec-users_controller"></div>


<h3><a id="sec-5_4_1" href="./filling-in-the-layout.html#sec-users_controller" class="heading"><span class="number">5.4.1</span>Usersコントローラ</a></h3>


<p><a class="ref" href="./static-pages.html#sec-static_pages">3.1</a>で最初のコントローラであるStaticPagesコントローラを作成してからしばらく経ちました。今度は2番目のコントローラであるUsersコントローラを作成しましょう。1番目のときと同様、<code>generate</code>を実行して、現時点での要求である新規ユーザー用のユーザー登録ページ (スタブ) を持つ、最も簡単なコントローラを作成します。Railsで好まれている<a href="http://ja.wikipedia.org/wiki/REST">RESTアーキテクチャ</a>の規約に従い、新規ユーザー用のアクションを<code>new</code>にすることに決め、<code>generate controller</code>の引数として渡して自動的にアクションを作成します (<a class="ref" href="./filling-in-the-layout.html#code-generate_users_controller">リスト5.29</a>)。</p>

<div class="label" id="code-generate_users_controller"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.29</span> <span class="description">Usersコントローラの生成 (<code>new</code>アクションを追加)。</span> </div>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate controller Users new --no-test-framework
<span class="go">      create  app/controllers/users_controller.rb</span>
<span class="go">       route  get &quot;users/new&quot;</span>
<span class="go">      invoke  erb</span>
<span class="go">      create    app/views/users</span>
<span class="go">      create    app/views/users/new.html.erb</span>
<span class="go">      invoke  helper</span>
<span class="go">      create    app/helpers/users_helper.rb</span>
<span class="go">      invoke  assets</span>
<span class="go">      invoke    coffee</span>
<span class="go">      create      app/assets/javascripts/users.js.coffee</span>
<span class="go">      invoke    scss</span>
<span class="go">      create      app/assets/stylesheets/users.css.scss</span>
</pre></div>
</div></div>


<p>上のコマンドにより、<code>new</code>アクションを持つUsersコントローラ(<a class="ref" href="./filling-in-the-layout.html#code-initial_users_controller">リスト5.30</a>)と、スタブのユーザービューを作成します(<a class="ref" href="./filling-in-the-layout.html#code-initial_new_action">リスト5.31</a>)。</p>

<div class="label" id="code-initial_users_controller"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.30</span> <span class="description"><code>new</code>アクションを持つ最初のUsersコントローラ。</span><br /><span class="description"> <code>app/controllers/users_controller.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">new</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code-initial_new_action"></div>


<div class="codelisting">
<div class="listing"><span class="header">5.31</span> <span class="description">Users用の最初の<code>new</code>アクション。</span><br /><span class="description"> <code>app/views/users/new.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>Users#new<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>Find me in app/views/users/new.html.erb<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>




<div class="label" id="sec-signup_url"></div>


<h3><a id="sec-5_4_2" href="./filling-in-the-layout.html#sec-signup_url" class="heading"><span class="number">5.4.2</span> ユーザー登録用URL</a></h3>


<p><a class="ref" href="./filling-in-the-layout.html#sec-users_controller">5.4.1</a>のコードにより、新規ユーザー用の動作するページが/users/new にできました。ここで<a class="ref" href="./filling-in-the-layout.html#table-url_mapping">表5.1</a>を思い出していただきたいのですが、URLは/users/newではなく表のとおりに/signupにしたいと思います。<a class="ref" href="./filling-in-the-layout.html#sec-layout_links">5.3</a>のときと同様、最初にいくつかの結合テストを作成しましょう。以下を実行してテスト用ファイルを生成します。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate integration_test user_pages
</pre></div>
</div>


<p>次に、<a class="ref" href="./filling-in-the-layout.html#code-pretty_page_tests">リスト5.28</a>の静的ページspecのひな形に従い、 <a class="ref" href="./filling-in-the-layout.html#code-user_pages_spec">リスト5.32</a>に示すように、ユーザーページの<code>h1</code>と<code>title</code>タグの内容をテストするコードを記入します。</p>

<div class="label" id="code-user_pages_spec"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.32</span> <span class="description">ユーザー登録ページへのテストを含む、ユーザー用の最初のspec。</span><br /><span class="description"> <code>spec/requests/user_pages_spec.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="s2">&quot;User pages&quot;</span> <span class="k">do</span>

  <span class="n">subject</span> <span class="p">{</span> <span class="n">page</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s2">&quot;signup page&quot;</span> <span class="k">do</span>
    <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">signup_path</span> <span class="p">}</span>

    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_content</span><span class="p">(</span><span class="s1">&#39;Sign up&#39;</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_title</span><span class="p">(</span><span class="n">full_title</span><span class="p">(</span><span class="s1">&#39;Sign up&#39;</span><span class="p">))</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>いつもと同様、これらのテストを以下のように<code>rspec</code>コマンドで実行できます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/user_pages_spec.rb
</pre></div>
</div>


<p>上のように特定のファイルを1つ渡す代わりに、以下のようにrequestsディレクトリ全体を渡すと、すべてのリクエストspecのテストを実行できることを覚えておくと良いでしょう。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/
</pre></div>
</div>


<p>上のパターンから、それ以外のディレクトリを含む<em>すべて</em>のspecを実行する以下の方法も容易に想像がつくと思います。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/
</pre></div>
</div>


<p>完全を期して、今後はチュートリアルの最後まで基本的に上の方法を使用してテストをフル実行します。なお、Rakeタスクで<code>spec</code>のテストスイートを実行できることも覚えておくとよいでしょう (他の開発者が使っているのを見たことがあるかもしれません)。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rake spec
</pre></div>
</div>


<p>(実際には<code>rake</code>とタイプするだけで済みます。<code>rake</code>のデフォルトの動作はテストスイートの実行です)。注意: 現在のサンプルアプリケーションに対して、<code>rake</code>を使用してこのテストを実行するとエラーが発生します。これはテスト環境用データベースが正しく設定されていないためです。これについては<a class="ref" href="./modeling-users.html#sec-initial_user_tests">6.2.1</a>で対応します。</p>

<p>Usersコントローラは、作成時に既に<code>new</code>アクションを持っているため、後はテストをパスさせるために正しいルートとビューの中身を作成すればよいのです。<a class="ref" href="./filling-in-the-layout.html#code-static_page_routes">リスト5.22</a>の例に従い、ユーザー登録URL用に<code>match ’/signup’</code>のルールを追加します。(<a class="ref" href="./filling-in-the-layout.html#code-signup_route">リスト5.33</a>)。</p>

<div class="label" id="code-signup_route"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.33</span> <span class="description">ユーザー登録ページへのルート。</span><br /><span class="description"> <code>config/routes.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="ss">SampleApp::Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s2">&quot;users/new&quot;</span>

  <span class="n">root</span>  <span class="s1">&#39;static_pages#home&#39;</span>
  <span class="n">match</span> <span class="s1">&#39;/signup&#39;</span><span class="p">,</span>  <span class="ss">to:</span> <span class="s1">&#39;users#new&#39;</span><span class="p">,</span>            <span class="ss">via:</span> <span class="s1">&#39;get&#39;</span>
  <span class="n">match</span> <span class="s1">&#39;/help&#39;</span><span class="p">,</span>    <span class="ss">to:</span> <span class="s1">&#39;static_pages#help&#39;</span><span class="p">,</span>    <span class="ss">via:</span> <span class="s1">&#39;get&#39;</span>
  <span class="n">match</span> <span class="s1">&#39;/about&#39;</span><span class="p">,</span>   <span class="ss">to:</span> <span class="s1">&#39;static_pages#about&#39;</span><span class="p">,</span>   <span class="ss">via:</span> <span class="s1">&#39;get&#39;</span>
  <span class="n">match</span> <span class="s1">&#39;/contact&#39;</span><span class="p">,</span> <span class="ss">to:</span> <span class="s1">&#39;static_pages#contact&#39;</span><span class="p">,</span> <span class="ss">via:</span> <span class="s1">&#39;get&#39;</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p><a class="ref" href="./filling-in-the-layout.html#code-generate_users_controller">リスト5.29</a>では、Usersコントローラを生成したときに自動的に生成された<code>get &quot;users/new&quot;</code>のルールはそのままにしてあることに注目してください。現時点では、このルールは<code>’users/new’</code>のルーティングが動作するために必要ですが、適切なREST規約 (<a class="ref" href="./a-demo-app.html#table-demo_RESTful_users">表2.2</a>) に従っていません。これは<a class="ref" href="./sign-up.html#sec-a_users_resource">7.1.2</a>で取り除きます。</p>

<p>テストをパスさせるために今必要なのは、“Sign up” のタイトルとヘッダーがあるビューです (<a class="ref" href="./filling-in-the-layout.html#code-initial_signup_page">リスト5.34</a>)。</p>

<div class="label" id="code-initial_signup_page"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.34</span> <span class="description">最初のユーザー登録ページ (スタブ)。</span><br /><span class="description"> <code>app/views/users/new.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="n">provide</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="s1">&#39;Sign up&#39;</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;h1&gt;</span>Sign up<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>Find me in app/views/users/new.html.erb<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>


<p>この時点で、<a class="ref" href="./filling-in-the-layout.html#code-user_pages_spec">リスト5.32</a>のテストはパスするはずです。残っている作業は、Homeページのボタンに適切なリンクを追加することです。他のルートと同様、<code>match ’/signup’</code>と記述したことで<code>signup_path</code>という名前付きルートができ、それを<a class="ref" href="./filling-in-the-layout.html#code-home_page_signup_link">リスト5.35</a>で使用します。</p>

<div class="label" id="code-home_page_signup_link"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.35</span> <span class="description">ボタンをユーザー登録ページにリンクする。</span><br /><span class="description"> <code>app/views/static_pages/home.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;center hero-unit&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;h1&gt;</span>Welcome to the Sample App<span class="nt">&lt;/h1&gt;</span>

  <span class="nt">&lt;h2&gt;</span>
    This is the home page for the
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.jp/&quot;</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
    sample application.
  <span class="nt">&lt;/h2&gt;</span>

  <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Sign up now!&quot;</span><span class="p">,</span> <span class="n">signup_path</span><span class="p">,</span> <span class="ss">class:</span> <span class="s2">&quot;btn btn-large btn-primary&quot;</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">image_tag</span><span class="p">(</span><span class="s2">&quot;rails.png&quot;</span><span class="p">,</span> <span class="ss">alt:</span> <span class="s2">&quot;Rails&quot;</span><span class="p">),</span> <span class="s1">&#39;http://rubyonrails.org/&#39;</span> <span class="cp">%&gt;</span>
</pre></div>
</div></div>


<p>これで、少なくともサインインのルートを追加するまでの間、リンクと名前付きルートが完成しました(<a class="ref" href="./sign-in-sign-out.html#top">第8章</a>)。結果を<a class="ref" href="./filling-in-the-layout.html#fig-new_signup_page">図5.9</a>の新規ユーザーのページ (URI /signup) に示します。</p>

<div class="label" id="fig-new_signup_page"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="../images/figures/new_signup_page_bootstrap.png" alt="new_signup_page_bootstrap" /></span></div><div class="caption"><span class="header">図5.9</span><span class="description"><a href="http://localhost:3000/signup">/signup</a>で表示される新しいユーザー登録ページ 。<a href="../images/figures/new_signup_page_bootstrap-full.png">(拡大)</a></span></div></div>


<p>この時点で、テストはパスするはずです。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/
</pre></div>
</div>




<div class="label" id="sec-layout_conclusion"></div>


<h2><a id="sec-5_5" href="./filling-in-the-layout.html#sec-layout_conclusion" class="heading"><span class="number">5.5</span>最後に</a></h2>


<p>この章では、アプリケーションのレイアウトを形にし、ルーティングを洗練させました。本書では、以後サンプルアプリケーションを肉付けすることに専念します。最初に、ユーザー登録、サインイン、サインアウトできるユーザーを追加します。次に、マイクロポストを追加します。最後に、他のユーザーをフォローできるようにします。</p>

<p>Gitを使っている方は、この時点でmasterブランチに変更をマージしてください。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git add .
<span class="gp">$</span> git commit -m <span class="s2">&quot;Finish layout and routes&quot;</span>
<span class="gp">$</span> git checkout master
<span class="gp">$</span> git merge filling-in-layout
</pre></div>
</div>


<p>続いてGitHubにプッシュしても構いません。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git push
</pre></div>
</div>


<p>最後にHerokuへデプロイすることもできます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git push heroku
</pre></div>
</div>


<p>これで、本番環境のサーバーでサンプルアプリケーションが動作しているはずです。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> heroku open
</pre></div>
</div>


<p>不具合が発生した場合は、以下のコマンドを試してみてください。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> heroku logs
</pre></div>
</div>


<p>上のコマンドを使用してHerokuのログファイルを参照し、エラーをデバッグしてください。</p>

<div class="label" id="sec-layout_exercises"></div>


<h2><a id="sec-5_6" href="./filling-in-the-layout.html#sec-layout_exercises" class="heading"><span class="number">5.6</span>演習</a></h2>




<ol>

<li><a class="ref" href="./filling-in-the-layout.html#code-pretty_page_tests">リスト5.28</a>の静的ページのテストコードは簡潔ですが、まだ繰り返しが残っています。RSpecには、冗長性を排除するための<em>Shared Examples</em>と呼ばれる機能があります。<a class="ref" href="./filling-in-the-layout.html#code-static_pages_spec_shared_example">リスト5.36</a>の例に従い、Help、AboutとContactページで不足しているテストを補ってください。<a class="ref" href="./static-pages.html#code-pages_controller_spec_exercise">リスト3.31</a>で簡単に紹介した<code>let</code>コマンドは、要求 (変数が使用されるときなど) に応じて与えられた値を持つ「ローカル変数」を作成することに注意してください。対照的にインスタンス変数は、要素代入 (assignment) されたときに作成されます。</li>

<li>既にお気付きの方もいると思いますが、これまで行なってきた、レイアウト上のリンクのルーティングテストは、そのリンクが実際に正しいページへのリンクになっているかどうかをチェックしていません。このようなテストを実装する方法のひとつは、RSpecの結合テスト内で<code>visit</code>と<code>click_link</code>を使用することです。レイアウトのリンクが正しく定義されていることを確認するコードを追加して、<a class="ref" href="./filling-in-the-layout.html#code-layout_links_test">リスト5.37</a>を補ってください。</li>

<li><a class="ref" href="./filling-in-the-layout.html#code-full_title_helper_tests">リスト5.38</a>に示すように、元のヘルパーメソッドに対するテストを書き、それによって<a class="ref" href="./filling-in-the-layout.html#code-rspec_utilities">リスト5.27</a>の<code>full_title</code>テストヘルパーへの依存を解消してください。(<code>spec/helpers</code>ディレクトリと<code>application_helper_spec.rb</code>ファイルの両方を作成する必要があるでしょう)。次に、<a class="ref" href="./filling-in-the-layout.html#code-rspec_utilities_simplified">リスト5.39</a>のコードを使用して、それをテストへ<code>include</code>してください。テストスイートを実行して、新しいコードに問題がないことを確認してください。<em>注意</em>: <a class="ref" href="./filling-in-the-layout.html#code-full_title_helper_tests">リスト5.38</a>では、<a class="ref" href="./modeling-users.html#sec-format_validation">6.2.4</a>で学ぶ<em>正規表現</em>を使用しています (この演習を提案し、コードを提供してくれた<a href="http://alexchaffee.com/">Alex Chaffee</a>に感謝します)。</li>

</ol>




<div class="label" id="code-static_pages_spec_shared_example"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.36</span> <span class="description">RSpecのShared Exampleを使用してテストの冗長性を排除する。</span><br /><span class="description"> <code>spec/requests/static_pages_spec.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="s2">&quot;Static pages&quot;</span> <span class="k">do</span>

  <span class="n">subject</span> <span class="p">{</span> <span class="n">page</span> <span class="p">}</span>

  <span class="n">shared_examples_for</span> <span class="s2">&quot;all static pages&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_content</span><span class="p">(</span><span class="n">heading</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_title</span><span class="p">(</span><span class="n">full_title</span><span class="p">(</span><span class="n">page_title</span><span class="p">))</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;Home page&quot;</span> <span class="k">do</span>
    <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">root_path</span> <span class="p">}</span>
    <span class="n">let</span><span class="p">(</span><span class="ss">:heading</span><span class="p">)</span>    <span class="p">{</span> <span class="s1">&#39;Sample App&#39;</span> <span class="p">}</span>
    <span class="n">let</span><span class="p">(</span><span class="ss">:page_title</span><span class="p">)</span> <span class="p">{</span> <span class="s1">&#39;&#39;</span> <span class="p">}</span>

    <span class="n">it_should_behave_like</span> <span class="s2">&quot;all static pages&quot;</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should_not</span> <span class="n">have_title</span><span class="p">(</span><span class="s1">&#39;| Home&#39;</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;Help page&quot;</span> <span class="k">do</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;About page&quot;</span> <span class="k">do</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;Contact page&quot;</span> <span class="k">do</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code-layout_links_test"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.37</span> <span class="description">レイアウトのリンクをテストする。</span><br /><span class="description"> <code>spec/requests/static_pages_spec.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="s2">&quot;Static pages&quot;</span> <span class="k">do</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="n">it</span> <span class="s2">&quot;should have the right links on the layout&quot;</span> <span class="k">do</span>
    <span class="n">visit</span> <span class="n">root_path</span>
    <span class="n">click_link</span> <span class="s2">&quot;About&quot;</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_title</span><span class="p">(</span><span class="n">full_title</span><span class="p">(</span><span class="s1">&#39;About Us&#39;</span><span class="p">))</span>
    <span class="n">click_link</span> <span class="s2">&quot;Help&quot;</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="c1"># ここにコードを記入</span>
    <span class="n">click_link</span> <span class="s2">&quot;Contact&quot;</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="c1"># ここにコードを記入</span>
    <span class="n">click_link</span> <span class="s2">&quot;Home&quot;</span>
    <span class="n">click_link</span> <span class="s2">&quot;Sign up now!&quot;</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="c1"># ここにコードを記入</span>
    <span class="n">click_link</span> <span class="s2">&quot;sample app&quot;</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="c1"># ここにコードを記入</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code-full_title_helper_tests"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.38</span> <span class="description"><code>full_title</code>ヘルパーに対するテスト。</span><br /><span class="description"> <code>spec/helpers/application_helper_spec.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="no">ApplicationHelper</span> <span class="k">do</span>

  <span class="n">describe</span> <span class="s2">&quot;full_title&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;should include the page title&quot;</span> <span class="k">do</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">full_title</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">to</span> <span class="n">match</span><span class="p">(</span><span class="sr">/foo/</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should include the base title&quot;</span> <span class="k">do</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">full_title</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">to</span> <span class="n">match</span><span class="p">(</span><span class="sr">/^Ruby on Rails Tutorial Sample App/</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should not include a bar for the home page&quot;</span> <span class="k">do</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">full_title</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">not_to</span> <span class="n">match</span><span class="p">(</span><span class="sr">/\|/</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code-rspec_utilities_simplified"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.39</span> <span class="description"><code>full_title</code>テストヘルパーを単純に <code>include</code>で置換する。</span><br /><span class="description"> <code>spec/support/utilities.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="kp">include</span> <span class="no">ApplicationHelper</span>
</pre></div>
</div></div>




<div class="navigation">  <a class="prev_page" href="./rails-flavored-ruby.html#top">
</a><a class="prev_page" href="./rails-flavored-ruby.html#top">    « <span class="number">第4章</span>Rails風味のRuby
</a><a class="prev_page" href="./rails-flavored-ruby.html#top">  </a>
  <a class="next_page" href="./modeling-users.html#top">
</a><a class="next_page" href="./modeling-users.html#top">    <span class="number">第6章</span>ユーザーのモデルを作成する »
</a><a class="next_page" href="./modeling-users.html#top">  </a>
</div><div class="footnotes">
<ol>
<li id="fn-5_1">サンプルアプリケーションでBootstrapを使用するための変換作業で、目覚ましい活躍を見せて助けてくれた読者の<a href="https://twitter.com/colmtuite">Colm Tuite</a>に感謝します。<a class="arrow" href="./filling-in-the-layout.html#fnref-5_1">↑</a></li>
<li id="fn-5_2"><em>Ruby on Railsチュートリアル</em>のモックアップは、<a href="https://gomockingbird.com/">Mockingbird</a>というオンラインモックアップアプリケーションで作成しています。<a class="arrow" href="./filling-in-the-layout.html#fnref-5_2">↑</a></li>
<li id="fn-5_3">CSSクラスは、Rubyのクラスとはまったく関係がありません。<a class="arrow" href="./filling-in-the-layout.html#fnref-5_3">↑</a></li>
<li id="fn-5_4">既にお気付きだと思いますが、<code>img</code>タグは<tt class="verb">&lt;img&gt;...&lt;/img&gt;</tt>ではなく<tt class="verb">&lt;img ... </tt><tt class="verb">/&gt;</tt>と書きます。この書式に従うタグは <em>閉じタグ</em>として知られています。 <a class="arrow" href="./filling-in-the-layout.html#fnref-5_4">↑</a></li>
<li id="fn-5_5">Asset PipelineでLESSを使うこともできます。詳細は<a href="http://rubygems.org/gems/less-rails-bootstrap"><tt>less-rails-bootstrap</tt> gem</a>を参照してください。<a class="arrow" href="./filling-in-the-layout.html#fnref-5_5">↑</a></li>
<li id="fn-5_6">多くのRails開発者は、異なるビューの間で共通に使用するパーシャルを保存するディレクトリとして、<code>shared</code>ディレクトリを使用します。著者は、複数のビューで共有するユーティリティパーシャルについては<code>shared</code>フォルダに保存し、文字どおり全ページ (サイトレイアウトの一部として) 共通のパーシャルについては<code>layouts</code>ディレクトリへ保存することを好んでいます (<code>shared</code>ディレクトリは<a class="ref" href="./sign-up.html#top">第7章</a>で作成します)。著者はこのように分割保存するのが論理的であると考えますが、<code>shared</code>フォルダにすべて保存しても問題なく動作します。<a class="arrow" href="./filling-in-the-layout.html#fnref-5_6">↑</a></li>
<li id="fn-5_7"><code>footer</code>タグと<code>.footer</code>クラスを両方使用していることについて疑問に思う方がいるかもしれません。その理由は、footerタグとする方が読み手にとって意味が明確であるのと、.footerクラスはBootstrapで使用するためです。<code>footer</code>を<code>div</code>に置き換えても動作は変わりません。<a class="arrow" href="./filling-in-the-layout.html#fnref-5_7">↑</a></li>
<li id="fn-5_8">このチュートリアル構成は、Michael Erasmusによる素晴らしいブログ記事「<a href="http://2beards.net/2011/11/the-rails-3-asset-pipeline-in-about-5-minutes/">5分でわかるRails 3のAsset Pipeline</a> (英語)」をもとにしています。詳細についてはRailsガイドの「<a href="http://railsguides.jp/asset_pipeline.html">アセットパイプライン</a>」の項を参照してください。<a class="arrow" href="./filling-in-the-layout.html#fnref-5_8">↑</a></li>
<li id="fn-5_9">Sassでもサポートされている古い<code>.sass</code>というフォーマットでは、冗長性の少ない (括弧の少ない)  新しい言語を定義しますが、既存のプロジェクトには若干不便であり、既にCSSに慣れ親しんだ人にとっては学習が面倒でもあります。<a class="arrow" href="./filling-in-the-layout.html#fnref-5_9">↑</a></li>
</ol>
</div>




    </div>
  </body>
</html>
